# ๐ ุชูุซูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (API) - Bazaar

ูุฐุง ุงููุณุชูุฏ ููุฏู ุดุฑุญุงู ุชูููุงู ุดุงููุงู ูุฏูููุงู ููุงูุฉ ุงูุนูููุงุช ุงููุชุงุญุฉ ูู ุงููุธุงูุ ูุน ุชูุถูุญ ุงูููุทู ุงูุจุฑูุฌู ุฎูู ูู ูุณุงุฑ ูุถูุงู ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุทููุฑ.

---

## ๐ฆ 1. ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช (`/api/products`)

ูุชุนุงูู ูุฐุง ุงููุณุงุฑ ูุน ุฌุฏูู `marketplace_products` ููุฏุนู ูุงูุฉ ุนูููุงุช CRUD.

### ๐ ุฌูุจ ุงูููุชุฌุงุช (GET)

#### ูุนุงููุงุช ุงูุจุญุซ ูุงูููุชุฑุฉ

| ุงููุนุงูู | ุงูููุน | ุงููุตู | ุงูููุทู ุงูุจุฑูุฌู |
|:---|:---|:---|:---|
| `product_key` | string | ูุนุฑู ููุชุฌ ูุญุฏุฏ | ูุนูุฏ ููุชุฌ ูุงุญุฏ ููุท (ูุงุฆู JSON) ุจุฏูุงู ูู ูุตูููุฉ |
| `user_key` | string | ูุนุฑู ุงูุจุงุฆุน | ุฌูุจ ููุชุฌุงุช ุจุงุฆุน ูุนูู |
| `searchTerm` | string | ูุต ุงูุจุญุซ | ุจุญุซ ูู `productName` ุจุงุณุชุฎุฏุงู `LIKE %term%` |
| `MainCategory` | integer | ุงูุชุตููู ุงูุฑุฆูุณู | ููุชุฑุฉ ุญุณุจ ุงูุชุตููู ุงูุฑุฆูุณู |
| `SubCategory` | integer | ุงูุชุตููู ุงููุฑุนู | ููุชุฑุฉ ุญุณุจ ุงูุชุตููู ุงููุฑุนู |
| `status` | integer | ุญุงูุฉ ุงูุงุนุชูุงุฏ | `null`: ูุนุชูุฏ ููุท (ุงูุชุฑุงุถู)ุ `0`: ููุฏ ุงููุฑุงุฌุนุฉุ `1`: ูุนุชูุฏ |

#### ุณููุงุฑูููุงุช ุงูุฌูุจ

1. **ุฌูุจ ููุชุฌ ูุงุญุฏ**: ุนูุฏ ุชูุฑูุฑ `product_key`ุ ูุชู ุฌูุจ ุชูุงุตูู ุงูููุชุฌ ูุน ุจูุงูุงุช ุงูุจุงุฆุน (username, phone, location, limitPackage, isDelevred)
2. **ุงูุจุญุซ ุงูุนุงู**: ุนูุฏ ุชูุฑูุฑ `searchTerm` ุฃู `MainCategory`ุ ูุชู ุงูุจุญุซ ูู ุงูููุชุฌุงุช ุงููุนุชูุฏุฉ ููุท (ูุง ูู ูุชู ุชุญุฏูุฏ `status`)
3. **ููุชุฌุงุช ุงูุจุงุฆุน**: ุนูุฏ ุชูุฑูุฑ `user_key` ููุทุ ูุชู ุฌูุจ ุฌููุน ููุชุฌุงุช ุงูุจุงุฆุน
4. **ุนุฑุถ ุงููุดุฑู**: ุนูุฏ ุชูุฑูุฑ `status` ููุทุ ูุชู ุฌูุจ ุงูููุชุฌุงุช ุญุณุจ ุญุงูุฉ ุงูุงุนุชูุงุฏ

> [!IMPORTANT]
> - ุฌููุน ุงูุงุณุชุนูุงูุงุช ุชุณุชุฎุฏู `JOIN` ูุน ุฌุฏูู `users` ูุฌูุจ ุจูุงูุงุช ุงูุจุงุฆุน
> - ุงูุชุฑุชูุจ ุฏุงุฆูุงู ุญุณุจ `id DESC` (ุงูุฃุญุฏุซ ุฃููุงู)
> - ุนูุฏ ุนุฏู ุชูุฑูุฑ ุฃู ูุนุงููุงุช ุตุงูุญุฉุ ูุชู ุฅุฑุฌุงุน ูุตูููุฉ ูุงุฑุบุฉ

### โ ุฅุถุงูุฉ ููุชุฌ (POST)

#### ุงูุญููู ุงููุทููุจุฉ
- `user_key`, `product_key`, `MainCategory`, `productName`

#### ุงูุญููู ุงูุงุฎุชูุงุฑูุฉ
- `product_description`, `product_price`, `original_price`, `realPrice`, `product_quantity`
- `user_message`, `user_note`, `ImageName`, `SubCategory`, `ImageIndex`
- `serviceType` (ุงูุชุฑุงุถู: 0), `heavyLoad` (ุงูุชุฑุงุถู: 0)

> [!NOTE]
> - ูุชู ุชุนููู `is_approved = 0` ุชููุงุฆูุงู (ููุฏ ุงููุฑุงุฌุนุฉ)
> - `product_key` ููุฑุณู ูู ุงูุนููู ููุง ููููุฏ ูู ุงูุฎุงุฏู ูุถูุงู ุงูุชุฒุงูู ูุน ุฃุณูุงุก ุงูุตูุฑ

### โ๏ธ ุชุญุฏูุซ ููุชุฌ (PUT)

- **ุงูููุทู**: ุชุญุฏูุซ ุฏููุงูููู - ูุชู ุชุญุฏูุซ ุงูุญููู ุงูููุฑุณูุฉ ููุท
- **ุงููุทููุจ**: `product_key`
- **ุงูุญููู ุงููุงุจูุฉ ููุชุญุฏูุซ**: ุฌููุน ุญููู ุงูููุชุฌ ุจูุง ูู ุฐูู `is_approved`

### ๐๏ธ ุญุฐู ููุชุฌ (DELETE)

- **ุงููุนุงูู**: `product_key` (ุนุจุฑ Query Parameter)
- **ุงูุงุณุชุฌุงุจุฉ**: ุฑุณุงูุฉ ูุฌุงุญ ุฃู ุฎุทุฃ 404 ุฅุฐุง ูู ููู ููุฌูุฏุงู

---

## ๐ 2. ุฅุฏุงุฑุฉ ุงูุทูุจุงุช (`/api/orders`)

ูุฏูุฑ ูุฐุง ุงููุณุงุฑ ุฌุฏูููู (`orders` ู `order_items`) ููุนุงููุฉ ุฐุฑูุฉ ูุงุญุฏุฉ ุจุงุณุชุฎุฏุงู `db.batch`.

### ๐ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ (POST)

#### ุงูุญููู ุงููุทููุจุฉ
```json
{
  "order_key": "string",
  "user_key": "string",
  "total_amount": number,
  "orderType": number,
  "items": [
    {
      "product_key": "string",
      "quantity": number,
      "seller_key": "string",
      "note": "string"
    }
  ]
}
```

#### ุงูููุทู ุงูุจุฑูุฌู
1. ุงูุชุญูู ูู ุงูุชูุงู ุงูุจูุงูุงุช (ูุณูุญ ุจู `total_amount = 0`)
2. ุฅูุดุงุก ุญุงูุฉ ุงูุชุฑุงุถูุฉ: `0#${ISO_Timestamp}`
3. ุชูููุฐ `db.batch` ูุฅุฏุฎุงู ุงูุทูุจ ูุนูุงุตุฑู ูุนุงู
4. ุฅุฑุฌุงุน `order_key` ูู ุญุงูุฉ ุงููุฌุงุญ

> [!CAUTION]
> ุฅุฐุง ูุดูุช ุฃู ุนูููุฉ ูู ุงูู batchุ ูุชู ุงูุชุฑุงุฌุน ุนู ูุงูู ุงููุนุงููุฉ (Atomic Transaction)

### ๐ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ (PUT)

- **ุงูุญููู ุงููุทููุจุฉ**: `order_key`, `order_status`
- **ุงูุชูุณูู**: ูุชู ุชุญููู `order_status` ุฅูู ูุต (String) ูุจู ุงูุญูุธ
- **ุงูุงุณุชุฎุฏุงู**: ูุชุญุฏูุซ ุงูุญุงูุฉ ุงูุนุงูุฉ ููุทูุจ (ูุซู: `1#2026-01-01T12:00:00.000Z`)

---

## ๐ฐ ุชุญุฏูุซ ุงููููุฉ ุงูุฅุฌูุงููุฉ (`/api/update-order-amount`)

### POST

- **ุงูุญููู ุงููุทููุจุฉ**: `order_key`, `total_amount`
- **ุงูููุทู**: 
  1. ุงูุชุญูู ูู ูุฌูุฏ ุงูุทูุจ
  2. ุชุญุฏูุซ `total_amount` ููุท
- **ุงูุงุณุชุฎุฏุงู**: ุนูุฏ ุชุนุฏูู ุงูุทูุจ ูู ูุจู ุงููุดุฑู ุฃู ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุชูููุฉ

---

## ๐ค 3. ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช (`/api/users`)

### ๐ก๏ธ ุงูุฃุฏูุงุฑ (is_seller)

| ุงููููุฉ | ุงูุฏูุฑ | ุงููุตู |
|:---:|:---|:---|
| 0 | ูุดุชุฑู | ูุณุชุฎุฏู ุนุงุฏู |
| 1 | ุจุงุฆุน | ููููู ุฅุถุงูุฉ ููุชุฌุงุช |
| 2 | ุชูุตูู | ุฎุฏูุฉ ุชูุตูู |
| 3 | ูุดุฑู | ุตูุงุญูุงุช ูุงููุฉ |

### ๐ ุฅูุดุงุก/ุงูุชุญูู (POST)

#### ุณููุงุฑูู 1: ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ
```json
{
  "action": "verify",
  "phone": "string",
  "password": "string"
}
```
- **ุงูููุทู**: ุงุณุชุนูุงู `SELECT * FROM users WHERE phone = ? AND Password = ?`
- **ุงูุงุณุชุฌุงุจุฉ**: ุจูุงูุงุช ุงููุณุชุฎุฏู ุงููุงููุฉ ุฃู ุฎุทุฃ 401

#### ุณููุงุฑูู 2: ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ
- **ุงููุทููุจ**: `username`, `phone`, `user_key`
- **ุงูุงุฎุชูุงุฑู**: `password`, `address`, `location`, `isDelevred`, `limitPackage`
- **ุงูููุทู**: 
  1. ุงูุชุญูู ูู ุนุฏู ุชูุฑุงุฑ ุฑูู ุงููุงุชู
  2. ุฅุฏุฎุงู ุงููุณุชุฎุฏู ุจููู ุงูุชุฑุงุถูุฉ ููุญููู ุงููุงุฑุบุฉ

### ๐ ุฌูุจ ุงููุณุชุฎุฏููู (GET)

| ุงููุนุงูู | ุงููุตู | ุงูุงุณุชุฌุงุจุฉ |
|:---|:---|:---|
| `phone` | ุฑูู ูุงุชู ูุญุฏุฏ | ูุณุชุฎุฏู ูุงุญุฏ ุฃู 404 |
| `role` | ุฏูุฑ ูุญุฏุฏ (is_seller) | ูุตูููุฉ ูุณุชุฎุฏููู + fcm_token |
| ุจุฏูู ูุนุงููุงุช | ุฌููุน ุงููุณุชุฎุฏููู | ูุตูููุฉ ูุน `phone_link` ู fcm_token |

> [!TIP]
> ุนูุฏ ุฌูุจ ุฌููุน ุงููุณุชุฎุฏูููุ ูุชู ุฅุถุงูุฉ ุญูู `phone_link: "tel:${phone}"` ุชููุงุฆูุงู ูุณูููุฉ ุงูุงุชุตุงู ูู ุงููุงุฌูุฉ

### โ๏ธ ุชุญุฏูุซ ุงููุณุชุฎุฏููู (PUT)

#### ุณููุงุฑูู 1: ุชุญุฏูุซ ูุฌูุน (Bulk Update)
- **ุงูุจูุงูุงุช**: ูุตูููุฉ ูู ุงููุงุฆูุงุช `[{phone, is_seller}]`
- **ุงูููุทู**: ุงุณุชุฎุฏุงู `transaction` ูุชุญุฏูุซ ุนุฏุฉ ูุณุชุฎุฏููู ุฏูุนุฉ ูุงุญุฏุฉ
- **ุงูุงุณุชุฎุฏุงู**: ุชุฑููุฉ ูุฌููุนุฉ ุจุงุฆุนูู

#### ุณููุงุฑูู 2: ุชุญุฏูุซ ูุฑุฏู
- **ุงููุทููุจ**: `user_key`
- **ุงูุญููู ุงููุงุจูุฉ ููุชุญุฏูุซ**: `username`, `phone`, `password`, `address`, `location`, `limitPackage`, `isDelevred`
- **ุงูููุทู**: ุจูุงุก SQL ุฏููุงูููู ููุญููู ุงูููุฑุณูุฉ ููุท + ุงูุชุญูู ูู ุนุฏู ุชูุฑุงุฑ ุงููุงุชู

### ๐๏ธ ุญุฐู ูุณุชุฎุฏู (DELETE)

- **ุงููุทููุจ**: `user_key` (ูู ุงูู body)
- **ุงูููุทู**: ูุชู ุญุฐู ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ ุชููุงุฆูุงู ุจูุถู `ON DELETE CASCADE`

---

## ๐ 4. ุงูุฅุดุนุงุฑุงุช ูุงูุชูููุงุช

### ๐ฑ ุฅุฏุงุฑุฉ ุงูุชูููุงุช (`/api/tokens`)

#### ุญูุธ ุงูุชููู (POST)
- **ุงููุทููุจ**: `user_key`, `token`, `platform`
- **ุงูููุทู** (Transaction):
  1. ุญุฐู ุฃู ุชููู ูุฏูู ูููุณ ุงููุณุชุฎุฏู
  2. ุญุฐู ุฃู ุชููู ูุฏูู ูููุณ ุงูุฌูุงุฒ (ุฅุฐุง ูุงู ูุณุฌูุงู ููุณุชุฎุฏู ุขุฎุฑ)
  3. ุฅุฏุฑุงุฌ ุงูุชููู ุงูุฌุฏูุฏ
- **ุงููุฏู**: ุถูุงู ุชููู ูุงุญุฏ ููุท ููู ูุณุชุฎุฏู/ุฌูุงุฒ

#### ุฌูุจ ุงูุชูููุงุช (GET)
- **ุงููุนุงูู**: `userKeys` (ููุตููุฉ ุจูุงุตูุฉ: `key1,key2,key3`)
- **ุงูุงุณุชุฌุงุจุฉ**: `{success: true, tokens: [...]}`
- **ุงูุงุณุชุฎุฏุงู**: ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุฌูุงุนูุฉ

#### ุญุฐู ุงูุชููู (DELETE)
- **ุงููุทููุจ**: `user_key`
- **ุงูุงุณุชุฎุฏุงู**: ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ

### ๐จ ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช (`/api/send-notification`)

> [!WARNING]
> ูุฐุง ุงููุณุงุฑ ูุณุชุฎุฏู Node.js Runtime (ูููุณ Edge) ูุฏุนู Firebase Admin SDK

#### ุงููุทููุจ
```json
{
  "token": "string",
  "title": "string",
  "body": "string"
}
```

#### ุงูููุทู
1. ุงูุชุญูู ูู ุชููุฆุฉ Firebase Admin SDK
2. ุงูุชุญูู ูู ุตุญุฉ ุงูุชููู
3. ุฅุฑุณุงู ุงูุฅุดุนุงุฑ ูู `data payload` ููุท (ุจุฏูู `notification`)
4. ูุนุงูุฌุฉ ุฎุงุตุฉ ููุชูููุงุช ุงูููุชููุฉ (ุฑูุฒ 410)

> [!IMPORTANT]
> ูุชู ุฅุฑุณุงู ุงูุจูุงูุงุช ูู `data: {title, body}` ููุท ูุถูุงู ุงุณุชุฏุนุงุก `onBackgroundMessage` ูู ุฌููุน ุงูุญุงูุงุช

---

## ๐ 5. ุงูุชูุงุฑูุฑ ูุงูุจูุงูุงุช ุงููุฌูุนุฉ

### ๐ ุญุฑูุฉ ุงููุจูุนุงุช (`/api/sales-movement`)

#### ุงููุนุงูู
- `user_key`: ูุนุฑู ุงููุณุชุฎุฏู ุงูุทุงูุจ

#### ุงูููุทู ุงูุจุฑูุฌู
1. ุฌูุจ ุฏูุฑ ุงููุณุชุฎุฏู ูู ุฌุฏูู `users`
2. ุจูุงุก ุดุฑุท WHERE ุฏููุงูููู:
   - `is_seller = 1`: `WHERE oi.seller_key = ?` (ุงูุจุงุฆุน ูุฑู ูุจูุนุงุชู ููุท)
   - `is_seller = 2 ุฃู 3`: ุจุฏูู ุดุฑุท (ุงูุชูุตูู/ุงููุดุฑู ูุฑู ุงููู)
   - `is_seller = 0`: `WHERE 1 = 0` (ูุง ูุชุงุฆุฌ)
3. ุฌูุจ ุงูุจูุงูุงุช ูู 4 ุฌุฏุงูู: `orders`, `users`, `order_items`, `marketplace_products`
4. ุชุฌููุน ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู `Map` ูุชุญููู ุงูุตููู ุฅูู ูููู ูุชุฏุงุฎู

#### ุงูุงุณุชุฌุงุจุฉ
```json
[
  {
    "order_key": "string",
    "total_amount": number,
    "order_status": "string",
    "created_at": "string",
    "customer_name": "string",
    "customer_phone": "string",
    "customer_address": "string",
    "items": [
      {
        "productName": "string",
        "product_price": number,
        "realPrice": number,
        "quantity": number,
        "product_key": "string",
        "seller_key": "string"
      }
    ]
  }
]
```

### ๐ ุฌููุน ุทูุจุงุช ุงููุณุชุฎุฏู (`/api/user-all-orders`)

#### ุงููุนุงููุงุช ุงููุทููุจุฉ
- `user_key`: ูุนุฑู ุงููุณุชุฎุฏู
- `role`: ุงูุฏูุฑ (`purchaser`, `seller`, `delivery`, `admin`)
- `order_key` (ุงุฎุชูุงุฑู): ูุฌูุจ ุทูุจ ูุญุฏุฏ

#### ุงูููุทู ุงูุจุฑูุฌู (3 ูุฑุงุญู)

**ุงููุฑุญูุฉ 1: ุฌูุจ ููุงุชูุญ ุงูุทูุจุงุช**
- `purchaser`: `SELECT order_key FROM orders WHERE user_key = ?`
- `seller`: `SELECT DISTINCT o.order_key FROM orders o JOIN order_items oi WHERE oi.seller_key = ?`
- `delivery`: `SELECT DISTINCT o.order_key ... JOIN suppliers_deliveries sd WHERE sd.delivery_key = ? AND sd.is_active = 1`
- `admin`: `SELECT order_key FROM orders WHERE 1=1`

**ุงููุฑุญูุฉ 2: ุฌูุจ ุชูุงุตูู ุงูุทูุจุงุช ูุงูุนูุงุตุฑ**
- ุฌูุจ ุจูุงูุงุช ุงูุทูุจุงุช ูู `orders` + `users`
- ุฌูุจ ุนูุงุตุฑ ุงูุทูุจุงุช ูู `order_items` + `marketplace_products`
- ุฌูุจ ุฎุฏูุงุช ุงูุชูุตูู ุงูููุนูุฉ ูู `suppliers_deliveries` + `users`

**ุงููุฑุญูุฉ 3: ุจูุงุก ุงููููู ุงูููุงุฆู**
- ุชุญููู `order_status` ูุงุณุชุฎุฑุงุฌ ุญุงูุงุช ุงูุนูุงุตุฑ ุงููุฑุฏูุฉ (JSON ูู ุงูุฌุฒุก ุงูุซุงูุซ)
- ุชุฌููุน ุงูุจูุงูุงุช ูู ูููู ูุชุฏุงุฎู ูุญุชูู ุนูู:
  - ุชูุงุตูู ุงูุทูุจ
  - ูุตูููุฉ ุงูุนูุงุตุฑ (ูุน `item_status` ููู ุนูุตุฑ)
  - ุฎุฏูุงุช ุงูุชูุตูู ุงููุชุงุญุฉ ููู ุจุงุฆุน

> [!TIP]
> ูุฐุง ุงููุณุงุฑ ูููุฑ ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุชูุฏูุฉ ูุน ุฑููุฒ ุญุงูุฉ ูุฎุตุตุฉ (503 ููุดุจูุฉุ 504 ููููุช ุงูููุชูู)

### ๐๏ธ ุณุฌู ุงููุดุชุฑูุงุช (`/api/purchases`)

#### ุงููุนุงูู
- `user_key`: ูุนุฑู ุงููุณุชุฎุฏู

#### ุงูุงุณุชุฌุงุจุฉ
```json
[
  {
    "productName": "string",
    "product_price": number,
    "ImageName": "string",
    "quantity": number,
    "created_at": "string",
    "order_status": "string",
    "order_key": "string"
  }
]
```

> [!NOTE]
> ูุฐุง ูุณุงุฑ ูุจุณุท ูุนุฑุถ ุณุฑูุน ูู ูุณู "ูุดุชุฑูุงุชู" - ูุง ูุญุชูู ุนูู ุชูุงุตูู ุงูุจุงุฆุน ุฃู ุงูุชูุตูู

---

## ๐๏ธ 6. ุงููุธุงุฆู ุงูุฏูููุฉ (Micro-Updates)

### ๐ง ุชุญุฏูุซ ุญุงูุฉ ุนูุตุฑ (`/api/update-item-status`)

#### ุงููุทููุจ (POST)
```json
{
  "order_key": "string",
  "product_key": "string",
  "status": "any"
}
```

#### ุงูููุทู ุงูุจุฑูุฌู
1. ุฌูุจ `order_status` ุงูุญุงูู
2. ุชุญููู ุงููุต: `StepID#Timestamp#JSON_Statuses`
3. ุชุญุฏูุซ ูุงุฆู JSON ุจุญุงูุฉ ุงูููุชุฌ ุงูุฌุฏูุฏุฉ: `itemStatuses[product_key] = status`
4. ุฅุนุงุฏุฉ ุจูุงุก ุงููุต: `${stepId}#${timestamp}#${newJsonStr}`
5. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

> [!IMPORTANT]
> ูุฐุง ุงููุณุงุฑ ูุง ูุบูุฑ `StepID` ุฃู `Timestamp`ุ ุจู ูุญุฏุซ ููุท ุฌุฒุก JSON ุงูุฎุงุต ุจุญุงูุงุช ุงูุนูุงุตุฑ

### ๐ ุงูููุฑุฏูู ูุงูููุฒุนูู (`/api/suppliers-deliveries`)

#### ุฌูุจ ุงูุนูุงูุงุช (GET)

**ุงูุณููุงุฑูู 1: ุนูุงูุงุช ุจุงุฆุน ูุญุฏุฏ**
- `sellerKey`: ูุนุฑู ุงูุจุงุฆุน
- `activeOnly=true`: ุฌูุจ ุงูููุฒุนูู ุงูููุนููู ููุท (ูุน fcm_token)
- `activeOnly=false/null`: ุฌูุจ ุฌููุน ุงูููุฒุนูู ูุน ุญุงูุฉ ุงูุชูุนูู

**ุงูุณููุงุฑูู 2: ุนูุงูุงุช ูุณุชุฎุฏู (ุซูุงุฆูุฉ ุงูุงุชุฌุงู)**
- `relatedTo`: ูุนุฑู ุงููุณุชุฎุฏู
- **ุงูุงุณุชุฌุงุจุฉ**:
```json
{
  "asSeller": [...],  // ุงูููุฒุนูู ุงูุฐูู ูุนูููู ูุนู
  "asDelivery": [...]  // ุงูุจุงุฆุนูู ุงูุฐูู ููุฒุน ููู
}
```

#### ุชุญุฏูุซ/ุฅูุดุงุก ุนูุงูุฉ (PUT - UPSERT)
```json
{
  "sellerKey": "string",
  "deliveryKey": "string",
  "isActive": boolean
}
```

> [!CAUTION]
> ูุชุทูุจ ูุฌูุฏ `UNIQUE INDEX` ุนูู `(seller_key, delivery_key)` ูุนูู UPSERT ุจุดูู ุตุญูุญ

#### ุงูุชุญูู ูู ุงูุฃุฏูุงุฑ (POST)
- **ุงููุทููุจ**: `{userKeys: [...]}`
- **ุงูุงุณุชุฌุงุจุฉ**: ูุตูููุฉ ุชุญุชูู ุนูู `{key, isSeller, isDelivery}` ููู ูุณุชุฎุฏู

### ๐ ุฌุฏูู ุงูุชุญุฏูุซุงุช (`/api/updates`)

#### ุฌูุจ ุขุฎุฑ ุชุญุฏูุซ (GET)
- **ุงูุงุณุชุฌุงุจุฉ**: `{datetime: "ISO_String"}`
- **ุงูููุทู**: `SELECT datetime FROM updates WHERE Id = 1`

#### ุชุญุฏูุซ ุงูุชุงุฑูุฎ (POST)
- **ุงูููุทู**: `UPDATE updates SET datetime = CURRENT_TIMESTAMP WHERE Id = 1`
- **ุงูุงุณุชุฎุฏุงู**: Cache Invalidation - ุฅุฌุจุงุฑ ุงูุชุทุจููุงุช ุนูู ุชุญุฏูุซ ุงูุจูุงูุงุช

---

## ๐ ููุงุญุธุงุช ุชูููุฉ ุนุงูุฉ

### ุงูุจูุฆุฉ ูุงูุชูููุงุช
- **Runtime**: Vercel Edge Functions (ูุง ุนุฏุง `/api/send-notification` ูุณุชุฎุฏู Node.js)
- **ูุงุนุฏุฉ ุงูุจูุงูุงุช**: Turso (LibSQL) ุนุจุฑ `@libsql/client/web`
- **CORS**: ุฌููุน ุงููุณุงุฑุงุช ุชุฏุนู `Access-Control-Allow-Origin: *`

### ุฃููุงุท ุงูุจุฑูุฌุฉ ุงููุณุชุฎุฏูุฉ
- **Atomic Transactions**: ูู `/api/orders` (batch) ู `/api/tokens` (transaction)
- **Dynamic SQL Building**: ูู `/api/products` (PUT) ู `/api/users` (PUT)
- **Nested Data Structures**: ูู `/api/sales-movement` ู `/api/user-all-orders`
- **UPSERT Pattern**: ูู `/api/suppliers-deliveries`

### ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุฌููุน ุงููุณุงุฑุงุช ุชุณุชุฎุฏู `try-catch` ูุน ุฑุณุงุฆู ุฎุทุฃ ุจุงูุนุฑุจูุฉ
- ุฑููุฒ ุงูุญุงูุฉ ุงููุณุชุฎุฏูุฉ: 200, 201, 204, 400, 401, 404, 405, 409, 410, 500, 503, 504
- ุชุณุฌูู ููุตู ุจุงุณุชุฎุฏุงู `console.log` ู `console.error`

### ุฃูุงู ุงูุจูุงูุงุช
- ุงูุชุญูู ูู ุงููุนุงููุงุช ุงููุทููุจุฉ ูุจู ุชูููุฐ ุงูุงุณุชุนูุงูุงุช
- ุงุณุชุฎุฏุงู Prepared Statements (args) ูููุน SQL Injection
- ุงูุชุญูู ูู ุชูุฑุฏ ุฑูู ุงููุงุชู ูู `/api/users`
- ุงูุชุญูู ูู ูุฌูุฏ ุงูุณุฌูุงุช ูุจู ุงูุชุญุฏูุซ/ุงูุญุฐู
