# دليل تطبيق نظام تحديد الموقع (BidStory Location)

هذا المستند يشرح بنية ونظام عمل تطبيق تحديد الموقع الجغرافي، والذي تم إعادة هيكلته ليعمل بنظام الوحدات (Modules) لضمان سهولة الصيانة والتطوير.

## هيكل المجلدات والملفات

تم تقسيم الكود إلى مجلد `js/location/` يحتوي على الملفات التالية:

| الملف | الوصف |
| :--- | :--- |
| `config.js` | يحتوي على تعريف الكائن الرئيسي `location_app` والثوابت (مثل الإحداثيات الافتراضية ومستوى التكبير). |
| `ui.js` | مسؤول عن عناصر الواجهة مثل شاشات التحميل (Loading) والتنبيهات (SweetAlert2). |
| `storage.js` | يدير تخزين الموقع المختار في `localStorage` والتحقق من صحة الإحداثيات. |
| `map.js` | يحتوي على منطق تهيئة خريطة Leaflet، إضافة العلامات (Markers)، والتعامل مع النقر المزدوج والضغط المطول. |
| `gps.js` | يدير خدمة تحديد الموقع عبر GPS والتعامل مع الأذونات والأخطاء الناتجة عنها. |
| `utils.js` | يحتوي على وظائف إضافية مثل مشاركة الإحداثيات (نسخ أو فتح في الخرائط) وإعادة تعيين الموقع. |
| `core.js` | يحتوي على دالة التهيئة الرئيسية `init` التي تربط جميع الوحدات ببعضها. |
| `location_app.js` | هو نقطة الدخول (Entry Point) التي تطلق التطبيق عند تحميل الصفحة وتدير الأخطاء الشاملة. |

## المميزات الرئيسية

1. **تحديد موقع تفاعلي**: اختيار الموقع عبر النقر المزدوج (حاسوب) أو الضغط المطول (هاتف). العملية فورية وبدون رسائل منبثقة مزعجة.
2. **دعم GPS محسّن**: الحصول على الموقع الدقيق بضغطة زر مع عرض دائرة الدقة. تم تحسين وقت الانتظار (30 ثانية) لدعم أفضل على الموبايل والمتصفحات.
3. **تصميم عصري مستجيب**: 
   - أزرار تحكم مرتبة عمودياً (أيقونة فوق النص) بخلفية شفافة ونص أزرق موحد
   - حاوية عائمة (Floating Panel) بزوايا مستديرة وظل عميق
   - تظهر في صف واحد دائماً حتى على الهواتف
4. **تخزين محلي ومعرفات فريدة**: يتم حفظ آخر موقع، وجميع عناصر الواجهة تمتلك معرفات (IDs) فريدة لتسهيل الاختبار والتعرف البرمجي.
5. **خيارات المشاركة المتقدمة**: عند النقر على زر "مشاركة"، يتاح للمستخدم خياران: نسخ الإحداثيات نصياً أو فتح الموقع مباشرة في تطبيق الخرائط (Google Maps).

## المعايير التقنية والمطابقة

- **بدون تأثيرات تمرير (No Hover)**: جميع التفاعلات تعتمد على النقرات أو الضغط المطول، دون الاعتماد على حالة Hover لضمان التوافق مع اللمس.
- **ألوان مسطحة (Flat Colors)**: الالتزام بالألوان الصلبة والابتعاد عن التدرجات اللونية (No Gradients).
- **التوثيق**: جميع الوظائف موثقة باستخدام **JSDoc** باللغة الإنجليزية، بينما نصوص الواجهة باللغة العربية بالكامل.
- **حجم الخط الصغير للحقوق**: تم تصغير نص الحقوق الخاص بالخريطة (`leaflet-control-attribution`) لزيادة المساحة المرئية.

## التوافق مع WebView (Android)

التطبيق مُحسّن للعمل داخل WebView في تطبيقات أندرويد:
- دعم كامل لـ Geolocation API
- timeout محسّن (30 ثانية) للحصول على إشارة GPS في الأماكن الضعيفة
- دعم الأحداث اللمسية (touch events) والضغط المطول
- تصميم مستجيب يتكيف مع جميع أحجام الشاشات

> [!IMPORTANT]
> عند استخدام التطبيق في WebView، تأكد من:
> - إضافة أذونات الموقع في `AndroidManifest.xml`
> - تفعيل JavaScript و Geolocation في إعدادات WebView
> - تطبيق `WebChromeClient` لمعالجة طلبات الموقع

## كيفية الاستخدام البرمجي

يتم تحميل الملفات بالترتيب التالي في `location\LOCATION.html`:
1. `js/location/config.js`
2. `js/location/ui.js`
3. `js/location/storage.js`
4. `js/location/map.js`
5. `js/location/gps.js`
6. `js/location/utils.js`
7. `js/location/core.js`
8. `location_app.js`

> [!IMPORTANT]
> المتطلبات الخارجية: Leaflet JS, SweetAlert2, Material Icons.
