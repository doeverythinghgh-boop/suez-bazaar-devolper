# دليل نظام الترجمة الموحد (Unified Localization Guide)

يعتمد مشروع "بزار" على نظام ترجمة ديناميكي مركزي مصمم ليدعم كافة أجزاء المشروع تدريجياً. يسمح هذا النظام بتبديل اللغة (مثل العربية والإنجليزية) مع التغيير الفوري لاتجاه الواجهة (RTL/LTR) دون الحاجة لإعادة تحميل الموقع.

---

## 1. هيكلية ملفات الترجمة

يتم تنظيم النصوص في مجلد `lang/` وفق هيكلية موديولية (Modular) تعتمد على الدمج التلقائي:

### أ. الملف العام (`general.json`)
هو الملف الأساسي والمستودع المركزي لكافة النصوص التي تتكرر عبر النظام. يهدف هذا الملف إلى منع تكرار نفس المفاتيح في ملفات الترجمة الخاصة بالصفحات الأخرى، ويشمل:
*   عناصر الهيدر والفوتر (Header/Footer).
*   رسائل التنبيهات الموحدة (Alerts & Confirmations).
*   المصطلحات العامة (مثل: "موافق"، "إلغاء"، "حفظ").
*   رسائل حالات الشبكة والوقت.
*   أي نص يظهر في أكثر من مكان داخل التطبيق.

### ب. ملفات الصفحات (`pageName.json`)
لكل صفحة أو موديول جديد (مثل `login`, `profile`, `products`)، يتم إنشاء ملف JSON مستقل يحتوي فقط على النصوص الخاصة بتلك الواجهة. هذا يسهل الصيانة ويمنع تضخم الملفات.

---

## 2. المحرك البرمجي المركزي

يعمل النظام من خلال ثلاث ركائز أساسية في `js/index.js`:

1.  **المخزن العالمي (`window.appTranslations`)**: كائن واحد يتم فيه دمج كافة ملفات الـ JSON المحملة ليصبح "قاموس" التطبيق النشط.
2.  **دالة الجلب (`window.langu(key)`)**: الدالة المسؤولة عن استخراج النص بناءً على مفتاح الترجمة ولغة المستخدم الحالية في الـ `localStorage`.
3.  **دالة التطبيق الشامل (`window.applyAppTranslations()`)**:
    *   تقوم بتحديث اتجاه الصفحة (`dir`) ووسم اللغة (`lang`) في جذر الـ HTML (`#index-html-root`).
    *   تقوم بمسح الـ DOM وترجمة أي عنصر يحمل سمة `data-lkey` تلقائياً.
    *   تعيد مزامنة العناصر الحساسة (مثل اسم المستخدم في الهيدر).

---

## 3. آلية العمل والتكامل (SPA Workflow)

النظام متكامل مع محرك التحميل الديناميكي `mainLoader`:
*   بمجرد تحميل محتوى HTML جديد داخل أي حاوية، يقوم النظام باستدعاء `applyAppTranslations` تلقائياً لتغطية العناصر الجديدة.
*   **قاعدة ذهبية**: أي عنصر HTML يحتاج للترجمة يجب أن يحتوي على سمة `data-lkey="key_name"`.

---

## 4. كيفية البدء بترجمة موديول (صفحة) جديد

عند البدء بترجمة صفحة جديدة، اتبع الخطوات التالية:

1.  **إنشاء الملف**: أضف ملفاً جديداً في مجلد `lang/` باسم الصفحة (مثال: `myPage.json`).
2.  **كتابة المفاتيح**: أضف النصوص بصيغة `{ "ar": "...", "en": "..." }`.
3.  **تحديث التسجيل**: أضف أمر تحميل الملف الجديد في دالة `loadIndexTranslations()` داخل `js/index.js` ليتم دمجه في الكائن العالمي.
4.  **تسمية العناصر**: أضف `data-lkey` للعناصر في ملف الـ HTML الخاص بالصفحة.
5.  **التنسيق المنطقي**: تأكد من أن ملف الـ CSS الخاص بالصفحة يستخدم **Logical Properties** لضمان عمل الاتجاهين:
    *   استخدم `inset-inline-start/end` بدلاً من `left/right`.
    *   استخدم `padding-inline-start` بدلاً من `padding-left`.
    *   استخدم `text-align: start` بدلاً من `text-align: right`.

---

## 5. الحفاظ على التفضيلات

يضمن النظام بقاء لغة المستخدم المختارة حتى في الحالات التالية:
*   **تسجيل الخروج**: يحفظ `SessionManager` اللغة قبل مسح البيانات ويعيد تعيينها فوراً.
*   **تحديث الصفحة**: يتم استرجاع اللغة من الـ `localStorage` فور تشغيل التطبيق.
