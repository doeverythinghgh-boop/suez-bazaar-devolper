# ุชูุซูู ุงูุฌุณุฑ ุงูุจุฑูุฌู ููุธุงู ุฃูุฏุฑููุฏ (Android Interface Bridge)

ูุนุชูุฏ ุชุทุจูู "ุจุงุฒุงุฑ" ุนูู ุฌุณุฑ ุจุฑูุฌู (JavaScript Interface) ููุฑุจุท ุจูู ุจูุฆุฉ ุงูููุจ (WebView) ููุธุงู ุฃูุฏุฑููุฏ ุงูุฃุตูู (Native). ูุชู ุงููุตูู ุฅูู ูุธุงุฆู ุฃูุฏุฑููุฏ ุนุจุฑ ุงููุงุฆู ุงูุนุงููู `window.Android`.

---

## ๐ 1. ูู ุงูููุจ ุฅูู ุฃูุฏุฑููุฏ (Web to Native)
ูุชู ุงุณุชุฏุนุงุก ูุฐู ุงูุฏูุงู ูู ุฏุงุฎู ููุฏ ุฌุงูุง ุณูุฑูุจุช ููุชุฃุซูุฑ ุนูู ุชุทุจูู ุงูุฃูุฏุฑููุฏ. ุฌููุน ุงูุฏูุงู ุชุชุจุน ุงูุจุงุฏุฆุฉ `window.Android.*`.

### `onUserLoggedIn(userKey)`
- **ุงูุบุฑุถ**: ุฅุจูุงุบ ุชุทุจูู ุฃูุฏุฑููุฏ ุจุฃู ุงููุณุชุฎุฏู ูุฏ ุณุฌู ุฏุฎููู ุจูุฌุงุญ.
- **ุงูุชุฃุซูุฑ**: ูููู ุงูุชุทุจูู ุจุจุฏุก ุนูููุฉ ุชูููุฏ ุชููู Firebase (FCM) ูุชุฎุฒููู.
- **ุงูุงุณุชุฏุนุงุก**: ูุชู ุขููุงู ูู `setupFirebaseAndroid` ุฏุงุฎู ููู `notificationSetUp.js`.

### `onUserLoggedOut(userKey)`
- **ุงูุบุฑุถ**: ุฅุจูุงุบ ุงูุชุทุจูู ุจุชุณุฌูู ุงูุฎุฑูุฌ.
- **ุงูุชุฃุซูุฑ**: ูููู ุงูุชุทุจูู ุจูุณุญ ุจูุงูุงุช ุงูุฌูุณุฉ ูุฅููุงู ุงุณุชูุจุงู ุงูุฅุดุนุงุฑุงุช ุงููุฑุชุจุทุฉ ุจูุฐุง ุงููุณุชุฎุฏู.
- **ุงูุงุณุชุฏุนุงุก**: ูุชู ูู ุฏุงูุฉ `onUserLoggedOutAndroid` ุฏุงุฎู `notificationTools.js`.

### `requestNotificationPermission()`
- **ุงูุบุฑุถ**: ุทูุจ ุฅุฐู ุงูุฅุดุนุงุฑุงุช ูู ูุธุงู ุฃูุฏุฑููุฏ (ุฎุงุตุฉ ูุฅุตุฏุงุฑุงุช 13 ููุง ููู).
- **ุงูุงุณุชุฏุนุงุก**: ุฏุงูุฉ `askForNotificationPermission` ูู `notificationTools.js`.

### `sendNotificationsToTokensP2P(tokensJson, title, body)`
- **ุงูุบุฑุถ**: ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูุจุงุดุฑุฉ ูู ุงูุฌูุงุฒ (Direct Push) ุฏูู ุงููุฑูุฑ ุจุงูุฎุงุฏู ูู ุญุงูุงุช ูุนููุฉ.
- **ุงููุนุงููุงุช**: 
  - `tokensJson`: ูุตูููุฉ ุงูุชูููุงุช ุจุชูุณูู JSON String.
  - `title`: ุนููุงู ุงูุฅุดุนุงุฑ.
  - `body`: ูุต ุงูุฅุดุนุงุฑ.
- **ุงูุงุณุชุฏุนุงุก**: ุฏุงูุฉ `sendNotificationsToTokens` ูู `notificationTools.js`.

### `onLanguageChanged(lang)`
- **ุงูุบุฑุถ**: ุฅุจูุงุบ ุชุทุจูู ุฃูุฏุฑููุฏ ุจุชุบููุฑ ูุบุฉ ุงูุชุทุจูู ูุชุญุฏูุซ ูุงุฌูุงุชู ูุชุฎุฒูู ุงูุชูุถูู ูุญููุงู.
- **ุงููุนุงููุงุช**: `lang` (String): ุฑูุฒ ุงููุบุฉ ุงูุฌุฏูุฏ (`'ar'` ุฃู `'en'`).
- **ุงูุงุณุชุฏุนุงุก**: ูุชู ุงุณุชุฏุนุงุคูุง ุชููุงุฆูุงู ุนูุฏ ุชุบููุฑ ุงููุบุฉ ูู ุฏุงูุฉ `toggleAppLanguage` ุฏุงุฎู `index.js`.

### `checkForUpdates()`
- **ุงูุบุฑุถ**: ุทูุจ ูุญุต ูุฌูุฏ ุชุญุฏูุซุงุช ุฌุฏูุฏุฉ ููุชุทุจูู ูู ูุชุฌุฑ Google Play ุฃู ุงูุฎุงุฏู ุงูุฎุงุต.
- **ุงูุชุฃุซูุฑ**: ูููู ุงูุชุทุจูู ุจูุชุญ ูุงุฌูุฉ ุงูุชุญุฏูุซ ุฅุฐุง ุชููุฑ ุฅุตุฏุงุฑ ุฌุฏูุฏ.
- **ุงูุงุณุชุฏุนุงุก**: ูุชู ุนูุฏ ุงูููุฑ ุนูู ุฒุฑ "ุงูุฑุฆูุณูุฉ" ูู ุดุฑูุท ุงูุชููู ุงูุณููู ุนุจุฑ ุฏุงูุฉ `handleHomeButtonClick` ูู `index.js`.

---

## ๐ก 2. ูู ุฃูุฏุฑููุฏ ุฅูู ุงูููุจ (Native to Web)
ูุชู ุงุณุชุฏุนุงุก ูุฐู ุงูุฏูุงู ูู ููุฏ ุฃูุฏุฑููุฏ (Java/Kotlin) ููุชูุงุนู ูุน ูุงุฌูุฉ ุงูููุจ.

### `saveNotificationFromAndroid(notificationJson)`
- **ุงูุบุฑุถ**: ุงุณุชูุจุงู ุจูุงูุงุช ุงูุฅุดุนุงุฑ ุงูุฐู ูุตู ููุฌูุงุฒ ูุญูุธู ูู ุงูุณุฌู ุงููุญูู ูููุชุตูุญ.
- **ุงููุนุงููุงุช**: ุณูุณูุฉ ูุตูุฉ (JSON) ุชุญุชูู ุนูู ุจูุงูุงุช ุงูุฑุณุงูุฉ.
- **ุงููููุน**: ูุนุฑูุฉ ุนุงูููุงู ูู `notificationTools.js`.
- **ุงูููุทู**: ุชููู ุจุชุญููู ุงูู JSON ูุงุณุชุฏุนุงุก `addNotificationLog` ูุญูุธู ูู IndexedDB.

### `showNotificationsModal()`
- **ุงูุบุฑุถ**: ูุชุญ ุดุงุดุฉ ุงูุฅุดุนุงุฑุงุช ุฏุงุฎู ุชุทุจูู ุงูููุจ ูุจุงุดุฑุฉ.
- **ุงูุงุณุชุฎุฏุงู**: ุชูุณุชุฏุนู ุบุงูุจุงู ุนูุฏ ุงูููุฑ ุนูู ุฅุดุนุงุฑ ูู ุดุฑูุท ุงูุชูุจููุงุช ุจุฃูุฏุฑููุฏ ููุชุญ ุงููุงุฌูุฉ ุงูููุงุณุจุฉ ูููุณุชุฎุฏู.

---

## ๐ 3. ุฏูุฑุฉ ุญูุงุฉ ุงูุชููู ูู ุฃูุฏุฑููุฏ (FCM Lifecycle)
1. ููุชุญ ุงููุณุชุฎุฏู ุงูุชุทุจูู -> ูุชู ูุญุต ูุฌูุฏ `android_fcm_key` ูู `localStorage`.
2. ุฅุฐุง ูู ููุฌุฏ -> ูุชู ุงุณุชุฏุนุงุก `window.Android.onUserLoggedIn`.
3. ุชุทุจูู ุฃูุฏุฑููุฏ ูููุฏ ุงูุชููู -> ูููู ุจุญููู ูู ุงูู `localStorage` ูููุชุตูุญ.
4. ุงูููุจ ููุชุธุฑ ุงูุชููู ุนุจุฑ ุฏุงูุฉ `waitForFcmKey`.
5. ุจูุฌุฑุฏ ุงุณุชูุงููุ ูุชู ุฅุฑุณุงูู ููุฎุงุฏู ุนุจุฑ `sendTokenToServer` ูุฑุจุทู ุจุญุณุงุจ ุงููุณุชุฎุฏู.

---

## ๐ก ููุงุญุธุงุช ุชูููุฉ ูููุทูุฑูู
- **ูุญุต ุงููุงุฌูุฉ**: ูุฌุจ ุฏุงุฆูุงู ูุญุต ูุฌูุฏ ุงููุงุฌูุฉ ูุจู ุงูุงุณุชุฏุนุงุก ูุชุฌูุจ ุงูุฃุฎุทุงุก ูู ุงููุชุตูุญุงุช ุงูุนุงุฏูุฉ:
  ```javascript
  if (window.Android && typeof window.Android.functionName === 'function') {
      // Call Android
  }
  ```
- **ุงูุชูุงูููุฉ**: ุชุนุชูุฏ ูุฐู ุงููุธุงุฆู ุนูู ุชุนุฑูู `WebView.addJavascriptInterface` ูู ููุฏ ุฃูุฏุฑููุฏ ุจุงุณู `"Android"`.
- **ุชุตุญูุญ ุงูุฃุฎุทุงุก**: ุชุธูุฑ ุฑุณุงุฆู ุงูุชุตุญูุญ ูู Logcat ุงูุฎุงุต ุจุฃูุฏุฑููุฏ ุจุจุงุฏุฆุฉ `[FCM Android]`.

---

## โ๏ธ 4. ูุชุทูุจุงุช ุงูุฅุนุฏุงุฏุงุช (Configuration)
ูุถูุงู ุนูู ุงูุฌุณุฑ ุงูุจุฑูุฌู ูุงููุตูู ููููุงุฑุฏ ุจุดูู ุตุญูุญุ ูุฌุจ ูุฑุงุนุงุฉ ุงูุขุชู ูู `js/config.js`:
- **ุงููุถูู ุงููุณููุญ**: ูุฌุจ ุฅุถุงูุฉ `appassets.androidplatform.net` ุฅูู ูุตูููุฉ `window.allowedHosts`. ูุฐุง ูู ุงููุทุงู ุงูุงูุชุฑุงุถู ุงูุฐู ูุณุชุฎุฏูู ุฃูุฏุฑููุฏ ูุชุญููู ูููุงุช ุงูููุจ ูุญููุงู.

---

## ๐จ 5. ุชุนุฏููุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู (UI/UX Adjustments)
ุนูุฏ ุงูุชุดุงู ุจูุฆุฉ ุฃูุฏุฑููุฏ (`window.Android` ููุฌูุฏ)ุ ูุชู ุฅุฌุฑุงุก ุงูุชุนุฏููุงุช ุงูุชุงููุฉ ุชููุงุฆูุงู:
- **ุฅุฎูุงุก ุชุซุจูุช PWA**: ูุชู ุชุนุทูู ูุฅุฎูุงุก ููุงูุฐ ุทูุจ ุชุซุจูุช ุงูุชุทุจูู (PWA Install Prompt) ูู `js/install-prompt.js` ูุชุฌูุจ ุฅุฑุจุงู ุงููุณุชุฎุฏู ุงูุฐู ูุณุชุฎุฏู ุงูุชุทุจูู ุงูุฃุตูู ุจุงููุนู.
- **ุฅุฏุงุฑุฉ ุงูุตูุช**: ูุชู ุชุนุทูู ุชุดุบูู ุฃุตูุงุช ุงูุชูุจูู ูู ุฌุงูุจ ุงูููุจ (`playNotificationSound`) ูู `notification/page/notification-global.js` ูุฃู ุชุทุจูู ุงูุฃูุฏุฑููุฏ ูุชููู ุฅุตุฏุงุฑ ุงูุชูุจููุงุช ุงูุตูุชูุฉ ูุงูุงูุชุฒุงุฒ ุจุดูู ุฃุตูู.
