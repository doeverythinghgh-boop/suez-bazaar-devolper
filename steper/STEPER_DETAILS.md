# ุชูุงุตูู ููุงูุฐ ูุฑุงุญู ุงูุทูุจ (Stepper Popups Details)

ููุถุญ ุงูุฌุฏูู ุงูุชุงูู ุชูุงุตูู ุงูุฑุณุงุฆู (ุงูููุงูุฐ ุงูููุจุซูุฉ) ุงูุณุจุนุฉ ุงูุชู ุชุธูุฑ ุฎูุงู ูุฑุงุญู ูุนุงูุฌุฉ ุงูุทูุจุ ุจูุงุกู ุนูู ุงูููุฏ ุงููุตุฏุฑู ุงูุญุงูู (ูุฌูุฏ `steper`).

| # | ุงูุฑุณุงูุฉ / ุงููุฑุญูุฉ | ุงููุญุชูู (Content) | ูู ููููู ุงูุชุนุฏูู (Edit Permission) | ุงูุฏูุฑ / ุงููุธููุฉ (Role/Function) | ูู ููููู ุงููุดุงูุฏุฉ (View Permission) | ูุนุฑู ุงูุญุงููุฉ (Popup ID) | ุนููุงู ุงููุงูุฐุฉ (Popup Title) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **1** | **ูุฑุงุฌุนุฉ ุงูุทูุจ (Review)** | ูุงุฆูุฉ ุจุฌููุน ููุชุฌุงุช ุงูุทูุจ ูุน ูุฑุจุนุงุช ุงุฎุชูุงุฑ (Checkboxes) ููุนูุฉ ุงูุชุฑุงุถูุงู. | **ุงููุญุชูู:** ุงููุดุชุฑู ููุท.<br>**ุงูุฃุฏูู:** ููุชูู ุตูุงุญูุฉ ุชุฌุงูุฒ ููุชุนุฏูู. | **ูููุดุชุฑู:** ูุฑุงุฌุนุฉ ุงูููุชุฌุงุช ูุชุญุฏูุฏ ูุง ูุฑูุฏ ุดุฑุงุคู ูุนููุงูุ ูุฅูุบุงุก ูุง ูุง ูุฑูุฏู (ุจุฅุฒุงูุฉ ุงูุชุญุฏูุฏ).<br>**ููุงุญุธุฉ:** ุฃู ููุชุฌ ูุชู ุฅูุบุงุก ุชุญุฏูุฏู ูุชุญูู ูุญุงูุฉ "ููุบู" (Cancelled). | โข ุงููุดุชุฑู<br>โข ุงูุจุงุฆุน (ูุฑุงุกุฉ ููุท - ูุนุฑุถ ุงูููุชุฌุงุช ุงูุชู ุชุฎุตู)<br>โข ุงูุฃุฏูู | `buyer-review-products-container` | ุงุฎุชุฑ ุงูููุชุฌุงุช / ุนุฑุถ ุงูููุชุฌุงุช |
| **2** | **ุชุฃููุฏ ุงูุทูุจ (Confirmed)** | **ููุจุงุฆุน:** ูุงุฆูุฉ ุจุงูููุชุฌุงุช (ูุฑุจุนุงุช ุงุฎุชูุงุฑ) + ุนุฑุถ ุงุณู ุงูููุฏูุจ ูุฑูู ุงููุงุชู (ูููุฑุงุกุฉ ููุท).<br>**ูููุดุชุฑู:** ูุงุฆูุฉ ุจุงูููุชุฌุงุช ุงููุคูุฏุฉ ููุท (ุงุณู ุงูููุชุฌ + ุงูุญุงูุฉ).<br>**ูููุฏูุจ ุงูุชูุตูู:** ูุงุฆูุฉ ุงูููุชุฌุงุช "ุงููุทููุจ ุชูุตูููุง" ูุฌูุนุฉ ุญุณุจ ุงูุจุงุฆุน ูุน ุนุฑุถ ุจูุงูุงุช ุงูุจุงุฆุน (ุงูุงุณูุ ุงููุงุชูุ ุงูุนููุงู). | **ุงููุญุชูู:** ุงูุจุงุฆุน ููุท.<br>**ุงูุฃุฏูู:** ููุชูู ุตูุงุญูุฉ ุชุฌุงูุฒ ููุชุนุฏูู.<br>**ุงูููู:** ูุชู ููู ุงูุชุนุฏูู ููุงุฆูุงู ููุจุงุฆุน ุจุนุฏ ุงูุญูุธ ุงูุฃูู. | **ููุจุงุฆุน:** ุชุฃููุฏ ุชููุฑ ุงูููุชุฌุงุช (ุชุญุฏูุฏ) ุฃู ุฑูุถูุง (ุนุฏู ุชุญุฏูุฏ).<br>**ูููุดุชุฑู:** ุนุฑุถ ูุง ุชู ุชุฃููุฏู ูู ูุจู ุงูุจุงุฆุน.<br>**ููููุฏูุจ:** ูุนุฑูุฉ ุชูุงุตูู ุงูุงุณุชูุงู ูู ุงูุจุงุฆุนูู. | โข ุงูุจุงุฆุน<br>โข ุงููุดุชุฑู (ูุฑุงุกุฉ ููุท)<br>โข ุงูุฃุฏูู<br>โข ููุฏูุจ ุงูุชูุตูู (ูุฑุงุกุฉ ููุท) | `seller-confirmation-container` (ุงูุจุงุฆุน)<br>`buyer-confirmed-container` (ุงููุดุชุฑู)<br>`courier-confirmed-container` (ุงูููุฏูุจ) | ุชุฃููุฏ ุงูููุชุฌุงุช (ุจุงุฆุน)<br>ุงูููุชุฌุงุช ุงููุคูุฏุฉ (ูุดุชุฑู)<br>ุงูููุชุฌุงุช ุงููุทููุจ ุชูุตูููุง (ููุฏูุจ) |
| **3** | **ุชู ุงูุดุญู (Shipped)** | **ููุจุงุฆุน:** ูุงุฆูุฉ ุจุงูููุชุฌุงุช ูุชุบููุฑ ุญุงูุชูุง ุฅูู "ูุดุญูู" + ุนุฑุถ ุจูุงูุงุช ุงูููุฏูุจ (ุงูุงุณูุ ุงููุงุชู) ุฅู ูุฌุฏุช.<br>**ูููุดุชุฑู:** ูุงุฆูุฉ ุจุงูููุชุฌุงุช ุงูุชู ุชู ุดุญููุง + ุนุฑุถ ุจูุงูุงุช ุงูุชูุตูู. | **ุงููุญุชูู:** ุงูุจุงุฆุนุ ููุฏูุจ ุงูุชูุตูู.<br>**ุงูุฃุฏูู:** ููุชูู ุตูุงุญูุฉ ุชุฌุงูุฒ ููุชุนุฏูู.<br>**ุงูููู:** ูุชู ููู ุงูุชุนุฏูู ููุงุฆูุงู ููุจุงุฆุน/ุงูููุฏูุจ ุจุนุฏ ุงูุชุฃููุฏ ุงูููุงุฆู. | **ููุจุงุฆุน/ุงูููุฏูุจ:** ุชุญููู ุญุงูุฉ ุงูููุชุฌุงุช ูู "ูุคูุฏ" ุฅูู "ูุดุญูู".<br>**ููุงุญุธุฉ:** ูุง ุชูุฌุฏ ุญููู ูุฅุฏุฎุงู ุจูุงูุงุช ุงูููุฏูุจ ููุงุ ูุชู ุนุฑุถ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ูุณุจูุงู ููุท. | โข ุงูุจุงุฆุน<br>โข ููุฏูุจ ุงูุชูุตูู<br>โข ุงููุดุชุฑู (ูุฑุงุกุฉ ููุท)<br>โข ุงูุฃุฏูู | `seller-shipping-container` (ุงูุจุงุฆุน)<br>`buyer-shipping-container` (ุงููุดุชุฑู) | ุดุญู ุงูููุชุฌุงุช (ุจุงุฆุน)<br>ููุชุฌุงุช ููุฏ ุงูุดุญู (ูุดุชุฑู) |
| **4** | **ุชู ุงูุชูุตูู (Delivered)** | ูุงุฆูุฉ ุจุงูููุชุฌุงุช ุงููุดุญููุฉ ูุชุฃููุฏ ุงุณุชูุงููุง. (ุชุธูุฑ ุจูุงูุงุช ุงููุดุชุฑู ููููุฏูุจุ ูุชุฎูู ุนู ุงูุจุงุฆุน). | **ุงููุญุชูู:** ุงููุดุชุฑูุ ููุฏูุจ ุงูุชูุตูู.<br>**ุงูุฃุฏูู:** ููุชูู ุตูุงุญูุฉ ุชุฌุงูุฒ ููุชุนุฏูู.<br>**ุงูููู:** ูุชู ููู ุงูุชุนุฏูู ููุงุฆูุงู ูููุดุชุฑู/ุงูููุฏูุจ ุจุนุฏ ุงูุชุฃููุฏ ุงูููุงุฆู. | **ูููุดุชุฑู/ุงูููุฏูุจ:** ุชุฃููุฏ ุงุณุชูุงู ุงูููุชุฌุงุช (ุชุญููููุง ูู Delivered)ุ ุฃู ุฅุฑุฌุงุนูุง (ุจุฅุฒุงูุฉ ุงูุชุญุฏูุฏ). | โข ุงููุดุชุฑู<br>โข ููุฏูุจ ุงูุชูุตูู<br>โข ุงูุจุงุฆุน (ูุฑุงุกุฉ ููุท)<br>โข ุงูุฃุฏูู | `delivery-confirmation-container` (ุงููุดุชุฑู)<br>`seller-delivery-container` (ุงูุจุงุฆุน) | ุชุฃููุฏ ุงุณุชูุงู ุงูููุชุฌุงุช (ูุดุชุฑู)<br>ุชุฃููุฏ ุงุณุชูุงู ุงูููุชุฌุงุช (ูุฑุงุกุฉ ููุท) (ุจุงุฆุน) |
| **5** | **ููุบู (Cancelled)** | ูุงุฆูุฉ ุจุงูููุชุฌุงุช ุงูุชู ูุงู **ุงููุดุชุฑู** ุจุฅูุบุงุฆูุง ูู ูุฑุญูุฉ "ูุฑุงุฌุนุฉ ุงูุทูุจ". | **ูุง ุฃุญุฏ** (ูุฑุงุกุฉ ููุท).<br>(ูููู ุงูุชุฑุงุฌุน ุนููุง ููุท ุนุจุฑ ุฅุนุงุฏุฉ ุชุญุฏูุฏูุง ูู ูุฑุญูุฉ ุงููุฑุงุฌุนุฉ). | ุณุฌู ููููุชุฌุงุช ุงูุชู ูู ูุฑุบุจ ุงููุดุชุฑู ูู ุฅููุงู ุดุฑุงุฆูุง. | โข ุงููุดุชุฑู<br>โข ุงูุจุงุฆุน<br>โข ุงูุฃุฏูู<br>โข ููุฏูุจ ุงูุชูุตูู (ุงููุฑุชุจุท) | `cancelled-products-container` | ุงูููุชุฌุงุช ุงูููุบุงุฉ |
| **6** | **ูุฑููุถ (Rejected)** | ูุงุฆูุฉ ุจุงูููุชุฌุงุช ุงูุชู ูุงู **ุงูุจุงุฆุน** ุจุฑูุถูุง (ุนุฏู ุชููุฑูุง) ูู ูุฑุญูุฉ "ุชุฃููุฏ ุงูุทูุจ". | **ูุง ุฃุญุฏ** (ูุฑุงุกุฉ ููุท).<br>(ูููู ุงูุชุฑุงุฌุน ุนููุง ููุท ุนุจุฑ ุฅุนุงุฏุฉ ุชุฃููุฏูุง ูู ูุฑุญูุฉ ุงูุชุฃููุฏ - ุฅุฐุง ูู ููู ููููุงู). | ุณุฌู ููููุชุฌุงุช ุงูุชู ุฑูุถูุง ุงูุจุงุฆุน ูุนุฏู ุงูุชููุฑ. | โข ุงูุจุงุฆุน<br>โข ุงููุดุชุฑู<br>โข ุงูุฃุฏูู<br>โข ููุฏูุจ ุงูุชูุตูู (ุงููุฑุชุจุท) | `seller-rejected-container` (ุงูุจุงุฆุน)<br>`buyer-rejected-container` (ุงููุดุชุฑู) | ุงูููุชุฌุงุช ุงููุฑููุถุฉ |
| **7** | **ูุฑุชุฌุน (Returned)** | ูุงุฆูุฉ ุจุงูููุชุฌุงุช ุงูุชู ูุงู **ุงููุดุชุฑู/ุงูููุฏูุจ** ุจุฅูุบุงุก ุชุญุฏูุฏูุง ูู ูุฑุญูุฉ "ุชู ุงูุชูุตูู". | **ูุง ุฃุญุฏ** (ูุฑุงุกุฉ ููุท).<br>(ูููู ุงูุชุฑุงุฌุน ุนููุง ููุท ุนุจุฑ ุฅุนุงุฏุฉ ุชุฃููุฏ ุงุณุชูุงููุง ูู ูุฑุญูุฉ ุงูุชูุตูู). | ุณุฌู ููููุชุฌุงุช ุงูุชู ุฑูุถ ุงููุดุชุฑู ุงุณุชูุงููุง ุนูุฏ ุงูุชูุตูู. | โข ุงููุดุชุฑู<br>โข ุงูุจุงุฆุน<br>โข ููุฏูุจ ุงูุชูุตูู<br>โข ุงูุฃุฏูู | `buyer-returned-container` (ุงููุดุชุฑู)<br>`seller-returned-container` (ุงูุจุงุฆุน) | ุงูููุชุฌุงุช ุงููุฑุชุฌุนุฉ (ูุดุชุฑู)<br>ุงูููุชุฌุงุช ุงููุฑุชุฌุนุฉ (ูุฑุงุกุฉ ููุท) (ุจุงุฆุน) |

## ุฏูุฑุฉ ุญูุงุฉ ุงููุฑุงุญู ูุขููุฉ ุงูุชูุนูู/ุงูุงุณุชุฑุฌุงุน

ููุถุญ ุงูุฌุฏูู ุงูุชุงูู ุงูุชูุงุตูู ุงูุชูููุฉ ูุงููุธูููุฉ ููู ูุฑุญูุฉ ุจูุงุกู ุนูู ููุทู `item_status`:

| ุงููุฑุญูุฉ | ุฑูุฒ ุงูุญุงูุฉ (Status Code) | ุงููุณุคูู | ุขููุฉ ุงูุชุบููุฑ (Action) | ุงูุชุฃุซูุฑ ุงููุจุงุดุฑ (Direct Impact) | ููุงุญุธุงุช ุฎุงุตุฉ ุจุงูููุฏ |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **ูุฑุงุฌุนุฉ (Review)** | `ITEM_STATUS.PENDING` | **ุงููุดุชุฑู** | ุชุญุฏูุฏ Checkbox = `PENDING`<br>ุฅูุบุงุก Checkbox = `CANCELLED` | ุชุญุฏูุฏ ูุง ุณูุธูุฑ ููุจุงุฆุน ูู ุงููุฑุญูุฉ ุงูุชุงููุฉ. | ุงููุดุชุฑู ูู ุงููุญูุฏ ุงูุฐู ูุญุฏุฏ "ูุทุงู" ุงูุทูุจ ุงููุนูู ููุง. |
| **ุชุฃููุฏ (Confirmed)** | `ITEM_STATUS.CONFIRMED` | **ุงูุจุงุฆุน** | ุชุญุฏูุฏ Checkbox = `CONFIRMED`<br>ุฅูุบุงุก Checkbox = `REJECTED` | ุงูููุชุฌุงุช ุงููุคูุฏุฉ ููุท ุชูุชูู ููุฑุญูุฉ ุงูุดุญู. | **ุขููุฉ ุงูููู:** ุจุนุฏ ุงูุญูุธ ุงูุฃูู ููุจุงุฆุนุ ูุชู ุฅูุดุงุก ููู ุฏุงุฆู ุฎุงุต ุจูุฐุง ุงูุจุงุฆุน (`__confirmation_locked_{sellerId}__`) ูููุน ุชุนุฏููุงุชู ุงููุณุชูุจููุฉ ููุทุ ุฏูู ุงูุชุฃุซูุฑ ุนูู ุจุงุฆุนูู ุขุฎุฑูู ูู ููุณ ุงูุทูุจ. |
| **ุงูุดุญู (Shipped)** | `ITEM_STATUS.SHIPPED` | **ุงูุจุงุฆุน/ุงูููุฏูุจ** | ุชุญุฏูุฏ Checkbox = `SHIPPED`<br>ุฅูุบุงุก Checkbox = `CONFIRMED` | ุงูููุชุฌุงุช ุงููุดุญููุฉ ุชุธูุฑ ูู ูุงุฆูุฉ ุงูุชูุตูู ูููุดุชุฑู. | **ุขููุฉ ุงูููู:** ุจุนุฏ ุงูุชุฃููุฏ ุงูููุงุฆูุ ูุชู ุฅูุดุงุก ููู ุฏุงุฆู ุฎุงุต ุจุงูุจุงุฆุน/ุงูููุฏูุจ (`__shipping_locked_{userId}__`) ูููุน ุชุนุฏููุงุชู ุงููุณุชูุจููุฉ. |
| **ุงูุชูุตูู (Delivered)** | `ITEM_STATUS.DELIVERED` | **ุงููุดุชุฑู/ุงูููุฏูุจ** | ุชุญุฏูุฏ Checkbox = `DELIVERED`<br>ุฅูุบุงุก Checkbox = `SHIPPED` (ุชุฑุงุฌุน) | ุงุณุชููุงู ุฏูุฑุฉ ุงูุทูุจ ููููุชุฌ. | **ุขููุฉ ุงูููู:** ุจุนุฏ ุงูุชุฃููุฏ ุงูููุงุฆูุ ูุชู ุฅูุดุงุก ููู ุฏุงุฆู ุฎุงุต ุจุงููุดุชุฑู/ุงูููุฏูุจ (`__delivery_locked_{userId}__`) ูููุน ุชุนุฏููุงุชู ุงููุณุชูุจููุฉ. |
| **ููุบู (Cancelled)** | `ITEM_STATUS.CANCELLED` | **ุชููุงุฆู** | ูุงุชุฌ ุนู ุฅูุบุงุก ุงูุชุญุฏูุฏ ูู ูุฑุญูุฉ "ุงููุฑุงุฌุนุฉ". | ุฎุฑูุฌ ุงูููุชุฌ ูู ุงูุฏูุฑุฉ ุชูุงูุงู. | - |
| **ูุฑููุถ (Rejected)** | `ITEM_STATUS.REJECTED` | **ุชููุงุฆู** | ูุงุชุฌ ุนู ุฅูุบุงุก ุงูุชุญุฏูุฏ ูู ูุฑุญูุฉ "ุงูุชุฃููุฏ". | ุฎุฑูุฌ ุงูููุชุฌ ูู ุงูุฏูุฑุฉุ ูุธูุฑ ูู ูุงุฆูุฉ ุงูุฑูุถ. | - |
| **ูุฑุชุฌุน (Returned)** | `ITEM_STATUS.RETURNED` | **ุชููุงุฆู/ูุฏูู** | ุงูุญุงูุฉ `RETURNED` ููุฌูุฏุฉ ูู `config.js` ูุชุณุชุฎุฏู ููุชุตููุฉ. | ููุชุฌ ูุตู ูููุดุชุฑู ููู ูุณุชููู. | - |

---

## ุขููุฉ ุงูููู (Lock Mechanisms) - ุชูุงุตูู ุงูููุฏ

### 1. ููู ุชุฃููุฏ ุงูุจุงุฆุน (Seller Confirmation Lock)

ุชู ุชุทุจูู ุขููุฉ ุงูููู ูู ุงููููุงุช ุงูุชุงููุฉ:
1.  **`steper/dataFetchers.js`**:
    *   `saveConfirmationLock(orderKey, isLocked, ordersData, sellerId)`: ุชุญูุธ ุญุงูุฉ ุงูููู ูู ุงูุณูุฑูุฑ ูุชุญุฏุซ ุงูุฐุงูุฑุฉ ุงููุญููุฉ.
    *   `getConfirmationLockStatus(ordersData, orderKey, sellerId)`: ุชูุฑุฃ ุญุงูุฉ ุงูููู ูู `order_status` ุงููุญูู.
2.  **`steper/sellerPopups.js`**:
    *   `showSellerConfirmationProductsAlert`: ุชูุญุต ุงูููู ูุจู ูุชุญ ุงููุงูุฐุฉ. ุฅุฐุง ูุงู ูุบููุงู (Locked) ูุงููุณุชุฎุฏู ููุณ `admin`ุ ูุชู:
        *   ุชุนุทูู ุฌููุน ูุฑุจุนุงุช ุงูุงุฎุชูุงุฑ (`disabled = true`).
        *   ุฅุฎูุงุก ุฒุฑ ุงูุญูุธ.
        *   ุนุฑุถ ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ "๐ ุชู ููู ุงูุชุฃููุฏ ุจุดูู ุฏุงุฆู".
    *   `handleConfirmationSave`: ุนูุฏ ุงูุญูุธุ ุชุธูุฑ ุฑุณุงูุฉ ุชุญุฐูุฑ "ูุง ูููู ุงูุชุนุฏูู ูุฑุฉ ุฃุฎุฑู"ุ ูุนูุฏ ุงูููุงููุฉ ูุชู ุงุณุชุฏุนุงุก `saveConfirmationLock`.

### 2. ููู ุงูุดุญู (Shipping Lock)

ุชู ุชุทุจูู ุขููุฉ ุงูููู ูู ุงููููุงุช ุงูุชุงููุฉ:
1.  **`steper/dataFetchers.js`**:
    *   `saveShippingLock(orderKey, isLocked, ordersData, sellerId)`: ุชุญูุธ ุญุงูุฉ ุงูููู ูู ุงูุณูุฑูุฑ ูุชุญุฏุซ ุงูุฐุงูุฑุฉ ุงููุญููุฉ.
    *   `getShippingLockStatus(ordersData, orderKey, sellerId)`: ุชูุฑุฃ ุญุงูุฉ ุงูููู ูู `order_status` ุงููุญูู.
2.  **`steper/sellerPopups.js`**:
    *   `showShippingInfoAlert`: ุชูุญุต ุงูููู ูุจู ูุชุญ ุงููุงูุฐุฉ. ุฅุฐุง ูุงู ูุบููุงู (Locked) ูุงููุณุชุฎุฏู ููุณ `admin`ุ ูุชู:
        *   ุชุนุทูู ุฌููุน ูุฑุจุนุงุช ุงูุงุฎุชูุงุฑ (`disabled = true`).
        *   ุฅุฎูุงุก ุฒุฑ ุงูุญูุธ.
        *   ุนุฑุถ ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ "๐ ุชู ููู ุงูุดุญู ุจุดูู ุฏุงุฆู".
    *   `handleShippingSave`: ุนูุฏ ุงูุญูุธุ ุชุธูุฑ ุฑุณุงูุฉ ุชุญุฐูุฑ "ูุง ูููู ุงูุชุนุฏูู ูุฑุฉ ุฃุฎุฑู"ุ ูุนูุฏ ุงูููุงููุฉ ูุชู ุงุณุชุฏุนุงุก `saveShippingLock`.

### 3. ููู ุงูุชุณููู (Delivery Lock)

ุชู ุชุทุจูู ุขููุฉ ุงูููู ูู ุงููููุงุช ุงูุชุงููุฉ:
1.  **`steper/dataFetchers.js`**:
    *   `saveDeliveryLock(orderKey, isLocked, ordersData, buyerId)`: ุชุญูุธ ุญุงูุฉ ุงูููู ูู ุงูุณูุฑูุฑ ูุชุญุฏุซ ุงูุฐุงูุฑุฉ ุงููุญููุฉ.
    *   `getDeliveryLockStatus(ordersData, orderKey, buyerId)`: ุชูุฑุฃ ุญุงูุฉ ุงูููู ูู `order_status` ุงููุญูู.
2.  **`steper/buyerPopups.js`**:
    *   `showDeliveryConfirmationAlert`: ุชูุญุต ุงูููู ูุจู ูุชุญ ุงููุงูุฐุฉ. ุฅุฐุง ูุงู ูุบููุงู (Locked) ูุงููุณุชุฎุฏู ููุณ `admin`ุ ูุชู:
        *   ุชุนุทูู ุฌููุน ูุฑุจุนุงุช ุงูุงุฎุชูุงุฑ (`disabled = true`).
        *   ุฅุฎูุงุก ุฒุฑ ุงูุญูุธ.
        *   ุนุฑุถ ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ "๐ ุชู ููู ุงูุชุณููู ุจุดูู ุฏุงุฆู".
    *   `handleDeliverySave`: ุนูุฏ ุงูุญูุธุ ุชุธูุฑ ุฑุณุงูุฉ ุชุญุฐูุฑ "ูุง ูููู ุงูุชุนุฏูู ูุฑุฉ ุฃุฎุฑู"ุ ูุนูุฏ ุงูููุงููุฉ ูุชู ุงุณุชุฏุนุงุก `saveDeliveryLock`.

### ุงูููุงุชูุญ ุงููุณุชุฎุฏูุฉ ูู order_status:
- **ุงูุชุฃููุฏ:** `__confirmation_locked_{sellerId}__`
- **ุงูุดุญู:** `__shipping_locked_{userId}__` (ุจุงุฆุน ุฃู ููุฏูุจ)
- **ุงูุชุณููู:** `__delivery_locked_{userId}__` (ูุดุชุฑู ุฃู ููุฏูุจ)

---

## ููุงุญุธุงุช ุชูููุฉ ุฅุถุงููุฉ

*   **ุชุญุฏูุฏ ุงูููุชุฌุงุช**: ูุชู ุงูุงุนุชูุงุฏ ุจุดูู ููู ุนูู `product_key` ูุฑุจุท ุงูุญุงูุฉ.
*   **ุชุฒุงูู ุงูุจูุงูุงุช**: ูุชู ุงูุชุญุฏูุซ ุงููุญูู ุงูููุฑู (`uiUpdates.js`) ุจุงูุชูุงุฒู ูุน ุงูุชุญุฏูุซ ููุณูุฑูุฑ ูุถูุงู ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ.
*   **ุนุฑุถ ุงูููุงุชูุญ**: ุชูุฌุฏ ุฃุฒุฑุงุฑ `Product` ุตุบูุฑุฉ ุจุฌุงูุจ ูู ุนูุตุฑ ูุทุจุงุนุฉ `product_key` ูู ุงููููุณูู ูุฃุบุฑุงุถ ุงูุชุทููุฑ (`btn-show-key`).

---

# ุจูุงุก ูุชุฏูู ุจูุงูุงุช Steper (Server Data Structure & Flow)

ูุตู ูุฐุง ุงูุชูุฑูุฑ ููููุฉ ุญูุธ ูุงุณุชุฑุฌุงุน ุจูุงูุงุช ูุธุงู ุงูู Steper ูู ุงูุฎุงุฏู (Server)ุ ูุน ุชูุตูู ูููููุฉ ุงูุจูุงูุงุช ูู ุฌููุน ุงูุณููุงุฑูููุงุช ุงููุชููุนุฉ ุจุนุฏ ุงูุชุญุฏูุซ ููุธุงู "ุงูุชูุงูู ุงูุชุงู" (Total Consistency).

## 1. ูุจุฏุฃ ุงูุนูู ุงูุนุงู
ูุนุชูุฏ ุงููุธุงู ุญุงููุงู ุนูู ูุจุฏุฃ **"ุงูุฎุงุฏู ูู ุงููุตุฏุฑ ุงููุญูุฏ ููุญูููุฉ" (Single Source of Truth)**.
- **ุชู ุฅูุบุงุก** ุงูุชุฎุฒูู ุงููุญูู (LocalStorage) ุจุงููุงูู.
- **ุชู ุงุนุชูุงุฏ** ุขููุฉ ุงูุชุญุฏูุซ ุงูุงูุชุธุงุฑู (Blocking Update): ูุง ุชุชุบูุฑ ุญุงูุฉ ุงููุงุฌูุฉ ุฅูุง ุจุนุฏ ุงุณุชูุงู ุฑุฏ `200 OK` ูู ุงูุณูุฑูุฑ.

---

## 2. ูููููุฉ ุญูุธ ุงูุจูุงูุงุช (Data Structure)

ูุชู ุชุฎุฒูู ุฌููุน ุญุงูุงุช Steper ุฏุงุฎู ุญูู `order_status` ูู ุฌุฏูู ุงูุทูุจุงุช. ูุฐุง ุงูุญูู ุนุจุงุฑุฉ ุนู ูุต (String) ูุฑูุจุ ููุง ูุณูุญ ุจุญูุธ ุจูุงูุงุช ูุนูุฏุฉ ุฏูู ุงูุญุงุฌุฉ ูุชุบููุฑ ูููููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database Schema).

### ุตูุบุฉ `order_status`
```text
StepID # Timestamp # JSON_Blob
```

| ุงููููู | ุงููุตู | ูุซุงู |
| :--- | :--- | :--- |
| **StepID** | ูุนุฑู ุขุฎุฑ ูุฑุญูุฉ ุฑุฆูุณูุฉ ูุตู ููุง ุงูุทูุจ (ููุฑุฌูุน ููุฎูู). | `step-confirmed` |
| **Timestamp** | ุชูููุช ุขุฎุฑ ุชุญุฏูุซ (ISO String). | `2024-12-15T21:00:00.000Z` |
| **JSON_Blob** | ูุงุฆู ูุถุบูุท ูุญุชูู ุนูู ุชูุงุตูู ุงูุญุงูุงุช ูุงูุชูุงุฑูุฎ. | `{ "item_123": "rejected", "__confirmation_locked__": "locked" ... }` |

### ูุญุชููุงุช `JSON_Blob`
ูุณุชุฎุฏู ุงูู JSON ุงูุฏุงุฎูู ููุฎุฒู ูุฑู (Key-Value Store) ูุญุชูู ุนูู ุซูุงุซุฉ ุฃููุงุน ูู ุงูุจูุงูุงุช:

1.  **ุญุงูุงุช ุงูููุชุฌุงุช (Item Statuses):**
    *   **ุงูููุชุงุญ user:** `product_key` (ูุซู `1734057973789`)
    *   **ุงููููุฉ:** ุญุงูุฉ ุงูููุชุฌ (`confirmed`, `rejected`, `shipped`, `delivered`, `pending`)
    *   *ููุงุญุธุฉ:* ูุชู ุชุฎุฒูู ุญุงูุฉ ุงูููุชุฌ ุฃูุถุงู ูู ุฌุฏูู `order_items` ุจุดูู ูููุตู ูู ุงูุจุงู-ุฅูุฏุ ูููู ุงูู Blob ูุณุชุฎุฏู ููุชุฒุงูู ุงูุณุฑูุน.

2.  **ุฃููุงู ุงููุธุงู (System Locks):**
    *   **ุงูููุชุงุญ:** `__confirmation_locked_{sellerId}__` (ูุซุงู `__confirmation_locked_12345__`)
    *   **ุงููููุฉ:** `locked` ุฃู `unlocked`
    *   *ุงููุฏู:* ููุน ุงูุจุงุฆุน ุงููุญุฏุฏ ูู ุชุนุฏูู ุงูููุชุฌุงุช ุจุนุฏ ุชุฃููุฏูุง ููุงุฆูุงูุ ูุน ุงูุณูุงุญ ูุจุงุฆุนูู ุขุฎุฑูู ุจุงูุนูู.

3.  **ุชูุงุฑูุฎ ุชูุนูู ุงููุฑุงุญู (Step Activation Dates):**
    *   **ุงูููุชุงุญ:** `__date_{step_id}__` (ูุซู `__date_step-shipped__`)
    *   **ุงููููุฉ:** ุงูุชูููุช ููุต (e.g., `2024-12-15 09:30 PM`)
    *   *ุงููุฏู:* ุญูุธ ุชุงุฑูุฎ ูุตูู ุงูุทูุจ ููู ูุฑุญูุฉ ูุนุฑุถู ูู ุดุฑูุท ุงูุชุชุจุน (Timeline).

---

## 3. ุณููุงุฑูููุงุช ุชุฏูู ุงูุจูุงูุงุช (Data Flow Scenarios)

### ุงูุณููุงุฑูู 1: ุชุญููู ุงูุตูุญุฉ (Initialization)
1.  ูููู ุงููุชุตูุญ ุจุทูุจ `fetchOrdersData`.
2.  ูุณุชูุจู `ordersData` ุงูุฐู ูุญุชูู ุนูู `order_status`.
3.  ุฏุงูุฉ `initializeState`:
    *   ุชูุฑุฃ `order_status`.
    *   ุชููู ุงููุต ูุชุณุชุฎุฑุฌ ุงูู JSON.
    *   **ุงูููุชุฌุงุช:** ุชูุญุฏูุซ ุญุงูุฉ ูู ููุชุฌ ูู ุงูุฐุงูุฑุฉ.
    *   **ุงูุชูุงุฑูุฎ:** ุชุจุญุซ ุนู ุงูููุงุชูุญ ุงูุชู ุชุจุฏุฃ ุจู `__date_` ูุชูุนุจุฆ ุชูุงุฑูุฎ ุงูู Timeline.
4.  ูุชู ุจูุงุก ุงููุงุฌูุฉ ุจูุงุกู ุนูู ูุฐู ุงูุจูุงูุงุช ุงูุญูุฉ.

### ุงูุณููุงุฑูู 2: ุจุงุฆุน ูุญูุธ ุชุฃููุฏ ุงูุทูุจ (Confirm Order)
1.  ูููู ุงูุจุงุฆุน (ID: 123) ุจุงุฎุชูุงุฑ ููุชุฌุงุช "ููุจููุฉ" ูุฃุฎุฑู "ูุฑููุถุฉ".
2.  ูุถุบุท "ุญูุธ".
3.  **ุงููุธุงู (Client):** ูุฑุณู ุทูุจุงุช `POST /api/update-item-status` ููู ููุชุฌ (Blocking).
    *   ูุซุงู: `Key: item_123, Status: confirmed`
    *   ูุซุงู: `Key: item_456, Status: rejected`
4.  **ุงููุธุงู (Client):** ุจุนุฏ ูุฌุงุญ ุญูุธ ุงูููุชุฌุงุชุ ูุฑุณู ุทูุจ "ููู" ุฎุงุต ุจุงูุจุงุฆุน:
    *   `Key: __confirmation_locked_123__, Status: locked`
5.  **ุงูุณูุฑูุฑ:** ูุญุฏูุซ ุงูู JSON Blob ุจุฏูุฌ ุงูููู ุงูุฌุฏูุฏุฉ.
6.  **ุงููุงุฌูุฉ:** ุชุธูุฑ ุฑุณุงูุฉ "ุชู ุงูุญูุธ" ูุชุบูู ุงููุงูุฐุฉ.

### ุงูุณููุงุฑูู 3: ุชูุนูู ูุฑุญูุฉ ุฌุฏูุฏุฉ (Step Activation)
*ูุซุงู: ุชูุนูู ูุฑุญูุฉ "ุชู ุงูุดุญู" (Shipped)*
1.  ูุถุบุท ุงูุจุงุฆุน ุนูู "ุชูุนูู ุงููุฑุญูุฉ".
2.  **ุงููุธุงู:** ูููุฏ ุงูุชุงุฑูุฎ ุงูุญุงูู (e.g., `2024-12-16...`).
3.  **ุงููุธุงู:** ูุฑุณู `POST` ููุณูุฑูุฑ:
    *   `Key: __date_step-shipped__`
    *   `Value: 2024-12-16...`
4.  **ุงูุณูุฑูุฑ:** ูุถูู ูุฐุง ุงูููุชุงุญ ููู JSON Blob.
5.  **ุงููุชูุฌุฉ:** ุนูุฏ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉุ ุณูุธูุฑ ุงูุชุงุฑูุฎ ุชุญุช ุงุณู ุงููุฑุญูุฉ ูู ุงูู UI.

### ุงูุณููุงุฑูู 4: ูุดู ุงูุงุชุตุงู (Error Handling)
1.  ูุญุงูู ุงููุณุชุฎุฏู ุชุบููุฑ ุญุงูุฉ.
2.  ุงููุธุงู ูุฑุณู `fetch`.
3.  ุงูุฅูุชุฑูุช ููุตูู -> `fetch` ูุฑูู `Error`.
4.  **ุงููุงุฌูุฉ:** ุชุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ `Swal.fire("ูุดู ุงูุญูุธ")`.
5.  **ุงูุจูุงูุงุช:** ูุง ุชุชุบูุฑ ูู ุงูุฐุงูุฑุฉ ููุง ูู ุงููุงุฌูุฉ (ุชุทุงุจู ุชุงู ูุน ูุดู ุงูุณูุฑูุฑ).

---

## 4. ููุฎุต ุดูู ุงูู JSON ุงููุชููุน ูู `order_status`

```json
{
  "1734057973789": "confirmed",
  "1734057973790": "rejected",
  "__confirmation_locked_1024182175__": "locked",
  "__confirmation_locked_5502654655__": "locked",
  "__date_step-confirmed__": "2024-12-15 10:00 PM",
  "__date_step-shipped__": "2024-12-16 09:30 AM"
}
```

ูุฐุง ุงูุชุตููู ูุถูู:
1.  **ุงููุฑููุฉ:** ูููู ุฅุถุงูุฉ ุฃู ุจูุงูุงุช ูุณุชูุจููุฉ (ูุซู ุงุณู ุงูุณุงุฆู) ุจููุณ ุงูุทุฑููุฉ.
2.  **ุงูุชูุงูู:** ูุง ุชุนุงุฑุถ ุจูู ูุง ูุฑุงู ุงููุณุชุฎุฏู ููุง ูู ูุญููุธ.
3.  **ุงูุฃูุงู:** ูุง ูููู ุงูุชูุงุนุจ ุจุงูุจูุงูุงุช ุนุจุฑ ุฃุฏูุงุช ุงููุชุตูุญ (Console) ููุชุฃุซูุฑ ุงููุณุชูุจููุ ูุฃู ุงููุตุฏุฑ ูู ุงูุณูุฑูุฑ ุฏุงุฆูุงู.
