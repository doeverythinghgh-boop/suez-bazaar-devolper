# دليل أدوار وصلاحيات نظام التتبع (Stepper System Roles & Permissions)

يوضح هذا الجدول الصلاحيات المتاحة لكل دور، البيانات المتأثرة، وتفاصيل النوافذ المنبثقة (Popups).

| المرحلة (Stage) | الدور (Role) | الصلاحيات (Permissions) | البيانات (Data Fetch/Save) | النافذة المنبثقة (Popup Window) |
| :--- | :--- | :--- | :--- | :--- |
| **1. مراجعة الطلب (Review)** | **المشتري (Buyer)** | • مشاهدة وتعديل (إلغاء) المنتجات.<br>• تفعيل المرحلة. | • **جلب:** كل منتجات الطلب.<br>• **حفظ:** حالة `cancelled` للمنتجات غير المحددة. | **المحتوى:** قائمة منتجات مع مربعات اختيار (Checkboxes) مفعلة افتراضياً.<br>**الإجراءات:**<br>• `إلغاء تحديد`: لتحويل المنتج إلى "ملغي".<br>• `زر حفظ/تفعيل`: يحفظ الحالة وينقل الطلب للمرحلة التالية. |
| | **البائع (Seller)** | • مشاهدة المنتجات الخاصة به (للقراءة فقط). | • **جلب:** منتجات البائع.<br>• **عرض:** المنتجات الملغاة الخاصة به. | **المحتوى:** قائمة منتجات للقراءة فقط (Read-only).<br>**الإجراءات:** زر إغلاق فقط. |
| | **الأدمن (Admin)** | • تحكم كامل. | • تعديل مباشر. | **المحتوى:** نفس نافذة المشتري مع صلاحية التجاوز. |
| **2. تأكيد الطلب (Confirmed)** | **البائع (Seller)** | • قبول/رفض المنتجات.<br>• تأكيد التجهيز. | • **جلب:** المنتجات غير الملغاة.<br>• **حفظ:** حالة `confirmed` أو `pending`. | **المحتوى:** جدول منتجات مع مفتاح تبديل (Toggle) لكل منتج (متوفر/غير متوفر).<br>**الإجراءات:**<br>• `تبديل`: لإلغاء التأكيد (إعادته لـ Pending).<br>• `زر تفعيل`: يؤكد المنتجات المتوفرة. |
| | **المشتري (Buyer)** | • مشاهدة فقط. | • **جلب:** المنتجات المؤكدة. | **المحتوى:** قائمة للقراءة فقط (Read-only) تعرض المنتجات التي أكدها البائع.<br>**الإجراءات:** زر إغلاق فقط. |
| | **الأدمن** | • تأكيد نيابة عن البائع. | • مثل البائع. | **المحتوى:** نفس نافذة البائع. |
| **3. الشحن (Shipped)** | **البائع (Seller)** | • تسليم للمندوب. | • **جلب:** المنتجات المؤكدة.<br>• **حفظ:** حالة `shipped`. | **المحتوى:** قائمة منتجات مع مربعات اختيار لتأكيد التسليم للمندوب.<br>**الإجراءات:** `زر تفعيل` (يؤكد الشحن). |
| | **المندوب (Courier)** | • استلام للتوصيل. | • **جلب/حفظ:** حالة الشحن. | **المحتوى:** قائمة المنتجات المسندة إليه.<br>**الإجراءات:** `زر تفعيل` (يؤكد الاستلام من البائع). |
| **4. التوصيل (Delivered)** | **المشتري (Buyer)** | • تأكيد الاستلام.<br>• إرجاع منتجات. | • **جلب:** المنتجات المشحونة.<br>• **حفظ:** `delivered` أو `shipped`. | **المحتوى:** قائمة منتجات مع مربعات اختيار (محددة = استلام، غير محددة = لم يتم الاستلام).<br>**الإجراءات:**<br>• `إلغاء تحديد`: التراجع عن الاستلام (Revert to Shipped).<br>• `زر تفعيل`: يغلق الطلب كـ "تم التوصيل". |
| | **المندوب (Courier)** | • متابعة. | • عرض حالة التوصيل. | **المحتوى:** قائمة للقراءة فقط للمنتجات التي تم توصيلها. |
| **المراحل الفرعية** | | | | |
| **(Cancelled / Rejected / Returned)** | **الجميع** | • عرض فقط. | • عرض الحالات الخاصة. | **المحتوى:** نوافذ تعرض جداول بالمنتجات التي تندرج تحت هذه الحالة فقط.<br>**الإجراءات:** زر إغلاق فقط (لا يوجد تعديل). |

## ملخص التفاعل (Interaction Summary)
*   **مربعات الاختيار (Checkboxes):** تستخدم من قبل **المشتري** في مرحلتي (المراجعة والتوصيل) لتحديد القبول/الرفض.
*   **مفاتيح التبديل (Toggles):** تستخدم من قبل **البائع** في مرحلة (التأكيد) لتحديد التوفر.
*   **زر التفعيل (Activate Button):** هو المسؤول عن **الحفظ (Save)** و **تغيير حالة المرحلة** في آن واحد. لا يتم حفظ التغييرات المؤقتة إلا بالضغط عليه.
