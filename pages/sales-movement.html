<style>
    .salesMovement_container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }

    .salesMovement_filterContainer {
        margin-bottom: 20px;
    }

    .salesMovement_radioGroup {
        width: 100%;
        border-collapse: separate;
        border-spacing: 12px 0;
        table-layout: fixed;
    }

    .salesMovement_radioGroup tr {
        width: 100%;
    }

    .salesMovement_radioOption {
        position: relative;
        width: 33.333%;
        padding: 0;
    }

    .salesMovement_radioOption input[type="radio"] {
        position: absolute;
        opacity: 0;
        cursor: pointer;
    }

    .salesMovement_radioLabel {
        display: block;
        padding: 15px 20px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 16px;
        font-weight: 500;
        color: #333;
        text-align: center;
        position: relative;
        overflow: hidden;
        box-sizing: border-box;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .salesMovement_radioLabel::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        transition: width 0.3s ease;
        z-index: 0;
    }

    .salesMovement_radioLabel span {
        position: relative;
        z-index: 1;
    }

    .salesMovement_radioOption input[type="radio"]:checked+.salesMovement_radioLabel {
        border-color: #667eea;
        color: white;
        font-weight: 600;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        transform: translateY(-2px);
    }

    .salesMovement_radioOption input[type="radio"]:checked+.salesMovement_radioLabel::before {
        width: 100%;
    }

    .salesMovement_radioLabel:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    .salesMovement_radioOption input[type="radio"]:checked+.salesMovement_radioLabel:hover {
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    /* ========================================
       Orders Container & Cards Styling
       ======================================== */

    .salesMovement_ordersContainer {
        margin-top: 30px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        width: 100%;
    }

    .salesMovement_orderCard {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        border: 2px solid transparent;
    }

    .salesMovement_orderCard::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }

    .salesMovement_orderCard:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        border-color: #667eea;
    }

    .salesMovement_orderCard:active {
        transform: translateY(-2px);
    }

    .salesMovement_cardHeader {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e0e0e0;
    }

    .salesMovement_cardIcon {
        font-size: 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .salesMovement_cardTitle {
        font-size: 16px;
        font-weight: 600;
        color: #333;
    }

    .salesMovement_cardBody {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .salesMovement_cardInfo {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #666;
    }

    .salesMovement_cardInfo span:first-child {
        font-weight: 500;
        color: #667eea;
    }

    .salesMovement_cardInfo span:last-child {
        color: #333;
    }

    /* Loading state */
    .salesMovement_loading {
        text-align: center;
        padding: 40px;
        font-size: 18px;
        color: #667eea;
        animation: salesMovement_pulse 1.5s ease-in-out infinite;
    }

    @keyframes salesMovement_pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.5;
        }
    }

    /* Empty state */
    .salesMovement_emptyState {
        text-align: center;
        padding: 60px 20px;
        color: #999;
    }

    .salesMovement_emptyState .salesMovement_emptyIcon {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.5;
    }

    .salesMovement_emptyState .salesMovement_emptyText {
        font-size: 18px;
        font-weight: 500;
    }

    /* ========================================
       Modal/Popup Styling
       ======================================== */

    .salesMovement_modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
        animation: salesMovement_fadeIn 0.3s ease;
    }

    .salesMovement_modal.salesMovement_show {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    @keyframes salesMovement_fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .salesMovement_modalContent {
        background: white;
        border-radius: 20px;
        /*padding: 25px;*/
        max-width: 90%;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
        animation: salesMovement_slideUp 0.3s ease;
    }

    @keyframes salesMovement_slideUp {
        from {
            transform: translateY(50px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .salesMovement_closeBtn {
        position: relative;
        top: auto;
        right: auto;
        margin: 0 auto 10px auto;
        display: flex;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 28px;
        color: white;
        cursor: pointer;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
    }

    .salesMovement_closeBtn:hover {
        transform: rotate(90deg) scale(1.1);
        box-shadow: 0 6px 15px rgba(102, 126, 234, 0.5);
    }

    .salesMovement_closeBtn:active {
        transform: rotate(90deg) scale(0.95);
    }

    .salesMovement_modalBody {
        margin-top: 0;
        min-height: 70vh;
        /*max-height: min-content;*/
    }

    .salesMovement_modalTitle {
        font-size: 24px;
        font-weight: 700;
        color: #333;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 3px solid #667eea;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .salesMovement_modalSection {
        margin-bottom: 25px;
    }

    .salesMovement_modalSectionTitle {
        font-size: 18px;
        font-weight: 600;
        color: #667eea;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .salesMovement_modalInfo {
        display: flex;
        justify-content: space-between;
        padding: 10px 15px;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 8px;
        transition: all 0.2s ease;
    }

    .salesMovement_modalInfo:hover {
        background: #e9ecef;
        transform: translateX(5px);
    }

    .salesMovement_modalInfoLabel {
        font-weight: 500;
        color: #666;
    }

    .salesMovement_modalInfoValue {
        font-weight: 600;
        color: #333;
    }

    .salesMovement_productItem {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 12px;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
    }

    .salesMovement_productItem:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .salesMovement_productName {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }

    .salesMovement_productDetails {
        display: flex;
        gap: 15px;
        font-size: 14px;
        color: #666;
    }

    .salesMovement_productDetails span {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    /* ========================================
       Responsive Design - Media Queries
       ======================================== */

    /* Very small screens (small phones) - less than 360px */
    @media screen and (max-width: 359px) {
        .salesMovement_container {
            padding: 15px;
            border-radius: 10px;
        }

        .salesMovement_filterContainer {
            margin-bottom: 15px;
        }

        .salesMovement_radioGroup {
            border-spacing: 6px 0;
        }

        .salesMovement_radioOption {
            width: 33.333%;
        }

        .salesMovement_radioLabel {
            padding: 10px 8px;
            font-size: 13px;
            border-radius: 8px;
            min-height: 45px;
        }

        .salesMovement_radioLabel span {
            font-size: 13px;
        }

        .salesMovement_ordersContainer {
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .salesMovement_orderCard {
            padding: 15px;
        }

        .salesMovement_modalContent {
            width: 95%;
            padding: 20px;
        }
    }

    /* Small mobile phones - 360px to 479px */
    @media screen and (min-width: 360px) and (max-width: 479px) {
        .salesMovement_container {
            padding: 18px;
            border-radius: 12px;
        }

        .salesMovement_filterContainer {
            margin-bottom: 16px;
        }

        .salesMovement_radioGroup {
            border-spacing: 8px 0;
        }

        .salesMovement_radioOption {
            width: 33.333%;
        }

        .salesMovement_radioLabel {
            padding: 11px 10px;
            font-size: 14px;
            border-radius: 10px;
            min-height: 48px;
        }

        .salesMovement_ordersContainer {
            grid-template-columns: 1fr;
            gap: 18px;
        }
    }

    /* Medium mobile phones - 480px to 767px */
    @media screen and (min-width: 480px) and (max-width: 767px) {
        .salesMovement_container {
            padding: 22px;
            border-radius: 13px;
        }

        .salesMovement_filterContainer {
            margin-bottom: 18px;
        }

        .salesMovement_radioGroup {
            border-spacing: 8px 0;
        }

        .salesMovement_radioOption {
            width: 33.333%;
        }

        .salesMovement_radioLabel {
            padding: 12px 10px;
            font-size: 14px;
            border-radius: 11px;
            min-height: 50px;
        }

        .salesMovement_ordersContainer {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 18px;
        }
    }

    /* Small tablets (Portrait) - 768px to 991px */
    @media screen and (min-width: 768px) and (max-width: 991px) {
        .salesMovement_container {
            padding: 25px;
            border-radius: 14px;
        }

        .salesMovement_filterContainer {
            margin-bottom: 19px;
        }

        .salesMovement_radioGroup {
            gap: 12px;
        }

        .salesMovement_radioLabel {
            padding: 15px 20px;
            font-size: 16px;
            border-radius: 12px;
            min-height: 54px;
        }

        .salesMovement_ordersContainer {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
    }

    /* Large tablets and small screens - 992px to 1199px */
    @media screen and (min-width: 992px) and (max-width: 1199px) {
        .salesMovement_container {
            padding: 28px;
        }

        .salesMovement_radioLabel {
            font-size: 16.5px;
            min-height: 56px;
        }
    }

    /* Large screens - 1200px to 1599px */
    @media screen and (min-width: 1200px) and (max-width: 1599px) {
        .salesMovement_container {
            padding: 30px;
        }

        .salesMovement_radioLabel {
            font-size: 17px;
            min-height: 58px;
        }
    }

    /* Very large screens - larger than 1600px */
    @media screen and (min-width: 1600px) {
        .salesMovement_container {
            padding: 35px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .salesMovement_radioLabel {
            padding: 18px 25px;
            font-size: 18px;
            min-height: 60px;
        }

        .salesMovement_radioGroup {
            gap: 15px;
        }
    }

    /* Improvements for touch devices */
    @media (hover: none) and (pointer: coarse) {
        .salesMovement_radioLabel {
            min-height: 50px;
            padding: 15px 20px;
        }

        .salesMovement_radioLabel:active {
            transform: scale(0.98);
        }
    }

    /* Landscape mode for phones */
    @media screen and (max-width: 767px) and (orientation: landscape) {
        .salesMovement_container {
            padding: 15px 25px;
        }

        .salesMovement_radioGroup {
            border-spacing: 8px 0;
        }

        .salesMovement_radioOption {
            width: 33.333%;
        }

        .salesMovement_radioLabel {
            padding: 10px 12px;
            min-height: 42px;
            font-size: 13px;
        }
    }

    /* Refresh Button Style */
    .salesMovement_refreshBtn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
        padding: 10px 20px;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 15px;
        width: 100%;
        font-size: 16px;
    }

    .salesMovement_refreshBtn:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .salesMovement_refreshBtn:active {
        transform: translateY(0);
    }

    .salesMovement_refreshIcon {
        font-size: 18px;
        transition: transform 0.5s ease;
    }

    .salesMovement_refreshBtn:hover .salesMovement_refreshIcon {
        transform: rotate(180deg);
    }
</style>


<body>
    <div class="salesMovement_container">

        <div class="salesMovement_filterContainer">
            <table class="salesMovement_radioGroup">
                <tr>
                    <td class="salesMovement_radioOption">
                        <input type="radio" id="salesMovement_buyer" name="salesMovement_userType" value="buyer">
                        <label for="salesMovement_buyer" class="salesMovement_radioLabel">
                            <span>ğŸ›’ Ù…Ø´ØªØ±ÙŠ</span>
                        </label>
                    </td>
                    <td class="salesMovement_radioOption">
                        <input type="radio" id="salesMovement_seller" name="salesMovement_userType" value="seller">
                        <label for="salesMovement_seller" class="salesMovement_radioLabel">
                            <span>ğŸª Ø¨Ø§Ø¦Ø¹</span>
                        </label>
                    </td>
                    <td class="salesMovement_radioOption">
                        <input type="radio" id="salesMovement_delivery" name="salesMovement_userType" value="delivery">
                        <label for="salesMovement_delivery" class="salesMovement_radioLabel">
                            <span>ğŸšš ØªÙˆØµÙŠÙ„</span>
                        </label>
                    </td>
                </tr>
            </table>
            
            <button id="salesMovement_refreshButton" class="salesMovement_refreshBtn">
                <span class="salesMovement_refreshIcon">â†»</span>
                <span>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
            </button>
        </div>

        <!-- Orders display container -->
        <div id="salesMovement_ordersContainer" class="salesMovement_ordersContainer">
            <!-- Order cards will be added here dynamically -->
        </div>
    </div>

    <!-- Modal for displaying order details -->
    <div id="salesMovement_orderModal" class="salesMovement_modal">
        <div class="salesMovement_modalContent">
            <button class="salesMovement_closeBtn" id="salesMovement_closeModal">
                <span>Ã—</span>
            </button>
            <div id="salesMovement_modalBody" class="salesMovement_modalBody">
                <!-- Order details will be added here dynamically -->
            </div>
        </div>
    </div>

    <script>
        const salesMovement_STORAGE_KEY = 'sales_movement_user_type';
        const salesMovement_radioButtons = document.querySelectorAll('input[name="salesMovement_userType"]');

        // Function to fetch orders based on user type
        async function salesMovement_fetchOrders(salesMovement_userType) {
            try {
                // Show loading state
                salesMovement_showLoading();

                let salesMovement_url = '';
                let salesMovement_userKey = userSession.user_key;
                let salesMovement_role = '';

                // Determine parameters based on user type
                switch (salesMovement_userType) {
                    case 'buyer':
                        salesMovement_role = 'purchaser';
                        salesMovement_url = `${baseURL}/api/user-all-orders?user_key=${salesMovement_userKey}&role=${salesMovement_role}`;
                        console.log('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠ...');
                        break;
                    case 'seller':
                        salesMovement_role = 'seller';
                        salesMovement_url = `${baseURL}/api/user-all-orders?user_key=${salesMovement_userKey}&role=${salesMovement_role}`;
                        console.log('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹...');
                        break;
                    case 'delivery':
                        salesMovement_role = 'delivery';
                        salesMovement_url = `${baseURL}/api/user-all-orders?user_key=${salesMovement_userKey}&role=${salesMovement_role}`;
                        console.log('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„...');
                        break;
                    default:
                        console.log('Ù†ÙˆØ¹ Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± ØµØ§Ù„Ø­');
                        return;
                }

                try {
                    console.log('Ø§Ù„Ø±Ø§Ø¨Ø·:', salesMovement_url);
                    const salesMovement_response = await fetch(salesMovement_url);

                    if (!salesMovement_response.ok) {
                        throw new Error(`Ø®Ø·Ø£ HTTP! Ø§Ù„Ø­Ø§Ù„Ø©: ${salesMovement_response.status}`);
                    }

                    const salesMovement_data = await salesMovement_response.json();
                    console.log('ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­:', salesMovement_data);
                    if (salesMovement_data && salesMovement_data.length > 0) {
                        console.log('Ø¹ÙŠÙ†Ø© Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø£ÙˆÙ„:', salesMovement_data[0].order_items);
                    }

                    // You can process and display data here
                    salesMovement_displayOrders(salesMovement_data);

                } catch (salesMovement_error) {
                    console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', salesMovement_error);
                }
            } catch (salesMovement_error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¯Ø§Ù„Ø© fetchOrders:', salesMovement_error);
            }
        }

        // Function to display orders
        function salesMovement_displayOrders(salesMovement_data) {
            try {
                const salesMovement_container = document.getElementById('salesMovement_ordersContainer');

                // Hide loading state
                salesMovement_hideLoading();

                // Check for data existence
                if (!salesMovement_data || salesMovement_data.length === 0) {
                    salesMovement_container.innerHTML = `
                        <div class="salesMovement_emptyState">
                            <div class="salesMovement_emptyIcon">ğŸ“¦</div>
                            <div class="salesMovement_emptyText">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>
                        </div>
                    `;
                    return;
                }

                // Sort orders by date (newest first)
                const salesMovement_sortedOrders = [...salesMovement_data].sort((a, b) => {
                    return new Date(b.created_at) - new Date(a.created_at);
                });

                console.log('Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', salesMovement_sortedOrders);

                // Create HTML for orders
                let salesMovement_cardsHTML = '';

                salesMovement_sortedOrders.forEach((salesMovement_order, salesMovement_index) => {
                    const salesMovement_productCount = salesMovement_order.order_items ? salesMovement_order.order_items.length : 0;
                    const salesMovement_formattedDate = salesMovement_formatDate(salesMovement_order.created_at);

                    salesMovement_cardsHTML += `
                        <div class="salesMovement_orderCard" data-order-index="${salesMovement_index}">
                            <div class="salesMovement_cardHeader">
                                <span class="salesMovement_cardIcon">ğŸ“‹</span>
                                <span class="salesMovement_cardTitle">Ø·Ù„Ø¨ #${salesMovement_order.order_key}</span>
                            </div>
                            <div class="salesMovement_cardBody">
                                <div class="salesMovement_cardInfo">
                                    <span>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                                    <span>${salesMovement_formattedDate}</span>
                                </div>
                                <div class="salesMovement_cardInfo">
                                    <span>ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span>
                                    <span>${salesMovement_productCount}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });

                salesMovement_container.innerHTML = salesMovement_cardsHTML;

                // Add event listeners to cards
                const salesMovement_cards = document.querySelectorAll('.salesMovement_orderCard');
                salesMovement_cards.forEach((salesMovement_card) => {
                    salesMovement_card.addEventListener('click', async function () {
                        try {
                            // 1. Reset default values
                            localStorage.setItem('productKeyFromStepReview', '');
                            if (window.globalStepperAppData) window.globalStepperAppData = null;

                            const salesMovement_orderIndex = parseInt(this.getAttribute('data-order-index'));
                            let salesMovement_orderData = salesMovement_sortedOrders[salesMovement_orderIndex];

                            if (!salesMovement_orderData) return;

                            // 2. Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± ØªØ­Ù…ÙŠÙ„ Ø¨Ø³ÙŠØ· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡ UI)
                            const originalCursor = document.body.style.cursor;
                            document.body.style.cursor = 'wait';

                            console.log(`[SalesMovement] Fetching fresh data for order: ${salesMovement_orderData.order_key} `);

                            // 3. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ø²Ø¬Ø©
                            const userKey = userSession.user_key;
                            // Ù†Ø­ØªØ§Ø¬ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ (buyer, seller, delivery)
                            // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªÙ†ØªØ§Ø¬Ù‡ Ù…Ù† Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ø¯Ø¯
                            const selectedRoleRadio = document.querySelector('input[name="salesMovement_userType"]:checked');
                            const roleType = selectedRoleRadio ? selectedRoleRadio.value : 'buyer'; // default

                            // ØªØ­ÙˆÙŠÙ„ roleType Ø¥Ù„Ù‰ Role API Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
                            let apiRole = 'purchaser';
                            if (roleType === 'seller') apiRole = 'seller';
                            if (roleType === 'delivery') apiRole = 'delivery';

                            // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø·
                            const fetchUrl = `${baseURL}/api/user-all-orders?user_key=${userKey}&role=${apiRole}&order_key=${salesMovement_orderData.order_key}`;

                            const response = await fetch(fetchUrl);
                            if (response.ok) {
                                const freshDataArray = await response.json();
                                if (freshDataArray && freshDataArray.length > 0) {
                                    console.log('[SalesMovement] Fresh data received:', freshDataArray[0]);
                                    salesMovement_orderData = freshDataArray[0]; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ø­Ø¯Ø«
                                } else {
                                    console.warn('[SalesMovement] No fresh data found, using cached.');
                                }
                            } else {
                                console.error('[SalesMovement] Failed to fetch fresh data:', response.status);
                            }

                            document.body.style.cursor = originalCursor;

                            // 4. Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø£Ùˆ Ø§Ù„Ù…ØªØ§Ø­Ø©)
                            salesMovement_showOrderDetails(salesMovement_orderData);

                        } catch (e) {
                            console.error('[SalesMovement] Error handling card click:', e);
                            document.body.style.cursor = 'default';
                            // Fallback to existing data if fetch fails critically
                            const idx = parseInt(this.getAttribute('data-order-index'));
                            if (salesMovement_sortedOrders[idx]) {
                                salesMovement_showOrderDetails(salesMovement_sortedOrders[idx]);
                            }
                        }
                    });
                });

            } catch (salesMovement_error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¯Ø§Ù„Ø© displayOrders:', salesMovement_error);
                const salesMovement_container = document.getElementById('salesMovement_ordersContainer');
                salesMovement_container.innerHTML = `
                    <div class="salesMovement_emptyState">
                        <div class="salesMovement_emptyIcon">âš ï¸</div>
                        <div class="salesMovement_emptyText">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                    </div>
                `;
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ÙÙŠ localStorage
        function salesMovement_saveUserTypeSelection(salesMovement_userType) {
            try {
                localStorage.setItem(salesMovement_STORAGE_KEY, salesMovement_userType);
                console.log(`ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±: ${salesMovement_userType} `);
            } catch (salesMovement_error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¯Ø§Ù„Ø© saveUserTypeSelection:', salesMovement_error);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† localStorage
        function salesMovement_loadUserTypeSelection() {
            try {
                const salesMovement_savedType = localStorage.getItem(salesMovement_STORAGE_KEY);
                if (salesMovement_savedType) {
                    console.log(`ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸: ${salesMovement_savedType} `);
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø¨ÙˆØªÙ† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
                    const salesMovement_radioToCheck = document.getElementById(`salesMovement_${salesMovement_savedType} `);
                    if (salesMovement_radioToCheck) {
                        salesMovement_radioToCheck.checked = true;
                    }
                    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    salesMovement_fetchOrders(salesMovement_savedType);
                } else {
                    console.log('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙÙˆØ¸');
                }
            } catch (salesMovement_error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¯Ø§Ù„Ø© loadUserTypeSelection:', salesMovement_error);
            }
        }

        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø¨ÙˆØªÙ†
        try {
            salesMovement_radioButtons.forEach(salesMovement_radio => {
                salesMovement_radio.addEventListener('change', function () {
                    try {
                        if (this.checked) {
                            const salesMovement_selectedValue = this.value;
                            console.log('ØªÙ… Ø§Ø®ØªÙŠØ§Ø±:', salesMovement_selectedValue);

                            // Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
                            salesMovement_saveUserTypeSelection(salesMovement_selectedValue);

                            // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
                            salesMovement_fetchOrders(salesMovement_selectedValue);
                        }
                    } catch (salesMovement_error) {
                        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬ ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ:', salesMovement_error);
                    }
                });
            });
        } catch (salesMovement_error) {
            console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:', salesMovement_error);
        }

        // Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«
        const salesMovement_refreshBtn = document.getElementById('salesMovement_refreshButton');
        if (salesMovement_refreshBtn) {
            salesMovement_refreshBtn.addEventListener('click', function() {
                try {
                    const selectedRadio = document.querySelector('input[name="salesMovement_userType"]:checked');
                    if (selectedRadio) {
                        console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§...');
                        
                        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ (Ù„Ù Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©)
                        const icon = this.querySelector('.salesMovement_refreshIcon');
                        if(icon) icon.style.transform = 'rotate(360deg)';
                        
                        salesMovement_fetchOrders(selectedRadio.value);

                        // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø¹Ø¯ ÙˆÙ‚Øª Ù‚ØµÙŠØ±
                        setTimeout(() => {
                            if(icon) icon.style.transform = '';
                        }, 500);
                    } else {
                         // Default fallback if nothing selected
                         salesMovement_fetchOrders('buyer');
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«:', error);
                }
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        salesMovement_loadUserTypeSelection();

        // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        function salesMovement_formatDate(salesMovement_dateString) {
            try {
                // Ensure the date string is treated as UTC if it comes from SQLite (standard 'YYYY-MM-DD HH:MM:SS')
                let dateStr = salesMovement_dateString;
                if (dateStr && !dateStr.includes('Z') && !dateStr.includes('+')) {
                    // Replace space with T and add Z to force UTC parsing
                    dateStr = dateStr.replace(' ', 'T') + 'Z';
                }

                const salesMovement_date = new Date(dateStr);

                // Check validity
                if (isNaN(salesMovement_date.getTime())) {
                    // Fallback to original string parsing if modification failed
                    return new Date(salesMovement_dateString).toLocaleString('ar-EG');
                }

                return salesMovement_date.toLocaleString('ar-EG', {
                    timeZone: 'Africa/Cairo', // Explicitly target Egypt time
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: 'numeric',
                    hour12: true
                });
            } catch (salesMovement_error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®:', salesMovement_error);
                return salesMovement_dateString;
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ ØµÙØ­Ø© stepper ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        function salesMovement_showOrderDetails(salesMovement_orderData) {
            try {
                const salesMovement_modal = document.getElementById('salesMovement_orderModal');
                const salesMovement_modalBody = document.getElementById('salesMovement_modalBody');

                // ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ config.js
                const salesMovement_convertedOrder = {
                    order_key: salesMovement_orderData.order_key,
                    user_key: salesMovement_orderData.user_key,
                    user_name: salesMovement_orderData.user_name || '',
                    user_phone: salesMovement_orderData.user_phone || '',
                    user_address: salesMovement_orderData.user_address || '',
                    order_status: salesMovement_orderData.order_status || '',
                    created_at: salesMovement_orderData.created_at,
                    total_amount: salesMovement_orderData.total_amount, // Added missing field
                    order_items: []
                };

                // ØªØ­ÙˆÙŠÙ„ order_items Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© supplier_delivery
                if (salesMovement_orderData.order_items && salesMovement_orderData.order_items.length > 0) {
                    salesMovement_orderData.order_items.forEach((salesMovement_item) => {
                        const salesMovement_convertedItem = {
                            product_key: salesMovement_item.product_key,
                            product_name: salesMovement_item.product_name,
                            quantity: salesMovement_item.quantity,
                            seller_key: salesMovement_item.seller_key,
                            note: salesMovement_item.note || '',
                            item_status: salesMovement_item.item_status || null, // Pass Item Status
                            supplier_delivery: null
                        };

                        // Ù…Ø¹Ø§Ù„Ø¬Ø© supplier_delivery
                        if (salesMovement_item.supplier_delivery) {
                            if (Array.isArray(salesMovement_item.supplier_delivery)) {
                                if (salesMovement_item.supplier_delivery.length === 1) {
                                    // Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯: ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Object
                                    salesMovement_convertedItem.supplier_delivery = salesMovement_item.supplier_delivery[0];
                                } else if (salesMovement_item.supplier_delivery.length > 1) {
                                    // Ø£ÙƒØ«Ø± Ù…Ù† Ø¹Ù†ØµØ±: Ø¥Ø¨Ù‚Ø§Ø¡ ÙƒÙ€ Array
                                    salesMovement_convertedItem.supplier_delivery = salesMovement_item.supplier_delivery;
                                } else {
                                    // Array ÙØ§Ø±Øº
                                    salesMovement_convertedItem.supplier_delivery = {};
                                }
                            } else {
                                // Ø¥Ø°Ø§ ÙƒØ§Ù† Object Ø¨Ø§Ù„ÙØ¹Ù„
                                salesMovement_convertedItem.supplier_delivery = salesMovement_item.supplier_delivery;
                            }
                        } else {
                            salesMovement_convertedItem.supplier_delivery = {};
                        }

                        salesMovement_convertedOrder.order_items.push(salesMovement_convertedItem);
                    });
                }

                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„ØªÙ…Ø±ÙŠØ±Ù‡Ø§ Ø¥Ù„Ù‰ config.js
                window.globalStepperAppData = {
                    idUser: userSession.user_key,
                    ordersData: [salesMovement_convertedOrder],
                    baseURL: baseURL  // Ø¥Ø¶Ø§ÙØ© baseURL
                };

                console.log('ØªÙ… ØªØ¹ÙŠÙŠÙ† globalStepperAppData Ù…Ù† ØµÙØ­Ø©  pages_sales-movement.html   :', window.globalStepperAppData);
                console.log('Sample item from globalStepperAppData:', window.globalStepperAppData.ordersData[0].order_items[0]);

                // Ø¥Ù†Ø´Ø§Ø¡ iframe Ù„Ø¹Ø±Ø¶ ØµÙØ­Ø© stepper
                // Ø¥Ù†Ø´Ø§Ø¡ iframe Ù„Ø¹Ø±Ø¶ ØµÙØ­Ø© stepper
                salesMovement_modalBody.innerHTML = `
                    <iframe 
                        src="./steper/stepper-only.html" 
                        style="width: 100%; height: 70vh; border: none; border-radius: 10px;"
                        id="salesMovement_stepperIframe"
                    ></iframe>
                `;

                // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
                salesMovement_modal.classList.add('salesMovement_show');

            } catch (salesMovement_error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ ØµÙØ­Ø© stepper:', salesMovement_error);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function salesMovement_showLoading() {
            try {
                const salesMovement_container = document.getElementById('salesMovement_ordersContainer');
                salesMovement_container.innerHTML = `
                    <div class="salesMovement_loading">
                        â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...
                    </div>
                `;
            } catch (salesMovement_error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„:', salesMovement_error);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø®ÙØ§Ø¡ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function salesMovement_hideLoading() {
            try {
                const salesMovement_container = document.getElementById('salesMovement_ordersContainer');
                const salesMovement_loadingElement = salesMovement_container.querySelector('.salesMovement_loading');
                if (salesMovement_loadingElement) {
                    salesMovement_loadingElement.remove();
                }
            } catch (salesMovement_error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø®ÙØ§Ø¡ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„:', salesMovement_error);
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        const salesMovement_closeModalBtn = document.getElementById('salesMovement_closeModal');
        const salesMovement_modal = document.getElementById('salesMovement_orderModal');

        salesMovement_closeModalBtn.addEventListener('click', function () {
            salesMovement_modal.classList.remove('salesMovement_show');
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        salesMovement_modal.addEventListener('click', function (salesMovement_event) {
            if (salesMovement_event.target === salesMovement_modal) {
                salesMovement_modal.classList.remove('salesMovement_show');
            }
        });

        // ========================================
        // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ±Ø§Øª localStorage Ù„Ù„Ù…ÙØªØ§Ø­ productKeyFromStepReview
        // ========================================

        // Ù…ØªØºÙŠØ± Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…ØªÙƒØ±Ø±
        let salesMovement_isProcessingProductKey = false;

        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        async function salesMovement_checkProductKeyChanges() {
            try {
                // Ù…Ù†Ø¹ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…ØªÙƒØ±Ø±
                if (salesMovement_isProcessingProductKey) {
                    return;
                }

                const salesMovement_currentProductKey = localStorage.getItem('productKeyFromStepReview');

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ…Ø© ØµØ§Ù„Ø­Ø©
                if (salesMovement_currentProductKey !== null &&
                    salesMovement_currentProductKey !== "" &&
                    salesMovement_currentProductKey !== undefined) {

                    console.log('ğŸ”” ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù‚ÙŠÙ…Ø© productKeyFromStepReview:', salesMovement_currentProductKey);

                    // ØªÙØ¹ÙŠÙ„ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                    salesMovement_isProcessingProductKey = true;

                    // Ù…Ø³Ø­ Ø§Ù„Ù‚ÙŠÙ…Ø© ÙÙˆØ±Ø§Ù‹ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
                    localStorage.setItem('productKeyFromStepReview', "");

                    try {
                        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
                        const salesMovement_response = await fetch(`${baseURL}/api/products?product_key=${salesMovement_currentProductKey}`);

                        if (!salesMovement_response.ok) {
                            throw new Error(`HTTP error! status: ${salesMovement_response.status}`);
                        }

                        const product = await salesMovement_response.json();
                        console.log('âœ… ØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬:', product);

                        // ØªØ­Ø¶ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
                        const productDataForModal = {
                            product_key: product.product_key,
                            productName: product.productName,
                            user_key: product.user_key,
                            pricePerItem: product.product_price,
                            original_price: product.original_price,
                            imageSrc: product.ImageName
                                ? product.ImageName.split(",").map(
                                    (name) => `https://pub-e828389e2f1e484c89d8fb652c540c12.r2.dev/${name}`
                                )
                                : [],
                            availableQuantity: product.product_quantity,
                            sellerMessage: product.user_message,
                            description: product.product_description,
                            sellerName: product.seller_username,
                            sellerPhone: product.seller_phone,
                            MainCategory: product.MainCategory,
                            SubCategory: product.SubCategory,
                            type: product.serviceType,
                        };

                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ù„Ø³Ø©
                        if (typeof productSession !== 'undefined') {
                            productSession = [productDataForModal, { showAddToCart: false }];
                            console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« productSession Ù…Ù† salesMovement');
                        }

                        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬
                        if (typeof productViewLayout === 'function') {
                            productViewLayout(productDataForModal.type);
                            console.log('âœ… ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ productViewLayout');
                        } else {
                            console.warn('âš ï¸ Ø§Ù„Ø¯Ø§Ù„Ø© productViewLayout ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                        }

                    } catch (fetchError) {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬:', fetchError);
                    } finally {
                        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
                        setTimeout(() => {
                            salesMovement_isProcessingProductKey = false;
                        }, 1000);
                    }
                }
            } catch (salesMovement_error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø±Ø§Ù‚Ø¨Ø© productKeyFromStepReview:', salesMovement_error);
                salesMovement_isProcessingProductKey = false;
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙƒÙ„ 100 Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
        const salesMovement_productKeyWatcher = setInterval(salesMovement_checkProductKeyChanges, 100);

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        window.addEventListener('beforeunload', function () {
            clearInterval(salesMovement_productKeyWatcher);
        });

        console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨Ø© productKeyFromStepReview ÙÙŠ localStorage');


    </script>
</body>