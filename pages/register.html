<style>
  /* Extracted from register-page.css */
  .register_password-container {
    position: relative;
  }

  .register_password-container input {
    padding-left: 40px;
    /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± (Ù„Ù€ RTL) */
  }

  .register_toggle-password {
    position: absolute;
    left: 15px;
    /* Ù„Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ RTL */
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
  }

  /* Extracted from login.css */
  @keyframes gradient-animation {
    0% {
      background-position: 0% 50%;
    }

    50% {
      background-position: 100% 50%;
    }

    100% {
      background-position: 0% 50%;
    }
  }

  .register_page-wrapper {
    font-family: "Tajawal", sans-serif;
    /* Ø¬Ø¯ÙŠØ¯: Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ø¬Ø°Ø§Ø¨Ø© */
    background-size: 400% 400%;
    animation: gradient-animation 15s ease infinite;
    min-height: 100vh;
    display: flex;
    /* âœ… ØªØ¹Ø¯ÙŠÙ„: ØªØºÙŠÙŠØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© */
    align-items: flex-start;
    /* Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
    justify-content: center;
    padding: 20px;
    /* âœ… ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¶Ø§ÙØ© Ø­Ø´Ùˆ Ø¹Ù„ÙˆÙŠ Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ù„Ø£Ø³ÙÙ„ Ù‚Ù„ÙŠÙ„Ù‹Ø§ */

    box-sizing: border-box;
  }

  .register_container {
    background-color: var(--bg-color-white);
    width: 100%;
    /* ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ø«Ø§Ø¨Øª Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 0;
    /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
    background: none;
    /* Ø¬Ø¹Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø´ÙØ§ÙØ© */
  }

  .register_container h2 {
    margin-top: 0;
    margin-bottom: 40px;
    /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© */
    color: var(--dark-blue);
    /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ ÙˆØ£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ù‹Ø§ */
    font-size: clamp(28px, 6vw, 36px);
    /* ØªÙƒØ¨ÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
    font-weight: 700;
    text-align: center;
  }

  .register_container form {
    width: 100%;
    max-width: 420px;
    /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚ØµÙ‰ */
    /* Ø¬Ø¯ÙŠØ¯: ØªØ£Ø«ÙŠØ± Ø²Ø¬Ø§Ø¬ÙŠ Ø´ÙØ§Ù Ù…Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØºÙŠØ±Ø§Øª */
    background-color: var(--bg-color-glass);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 40px;
    border-radius: 20px;
    /* Ø­ÙˆØ§Ù Ø£ÙƒØ«Ø± Ø¯Ø§Ø¦Ø±ÙŠØ© */
    /* Ø¬Ø¯ÙŠØ¯: Ø¸Ù„ Ø£ÙƒØ«Ø± Ù†Ø¹ÙˆÙ…Ø© ÙˆØ¹Ù…Ù‚Ù‹Ø§ */
    box-shadow: var(--shadow-interactive);
    border: 1px solid var(--border-color-soft);
  }

  .register_form-group {
    margin-bottom: 20px;
    text-align: right;
  }

  .register_form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: var(--dark-blue);
    /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ø¯Ø§ÙƒÙ† */
    font-size: 0.9rem;
  }

  .register_form-group input {
    width: 100%;
    /* ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø­Ø§ÙˆÙŠØ© */
    padding: 14px 45px 14px 15px;
    /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
    border: 1px solid var(--border-color-input);
    /* Ù„ÙˆÙ† Ø¥Ø·Ø§Ø± Ø£ÙØªØ­ */
    border-radius: 10px;
    /* Ø²ÙŠØ§Ø¯Ø© Ø¯Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø­ÙˆØ§Ù */
    box-sizing: border-box;
    font-family: "Tajawal", sans-serif;
    font-size: 16px;
    transition: border-color 0.3s, box-shadow 0.3s;
    background-color: var(--bg-color-white);
    /* ØªØ¹Ø¯ÙŠÙ„: Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ù†Ù‚ÙŠØ© */
  }

  .register_form-group {
    position: relative;
  }

  .register_form-group .fa-phone,
  .register_form-group .fa-user {
    /* ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ø³ÙŠÙ† Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    position: absolute;
    top: 50%;
    right: 15px;
    /* Ù„Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ RTL */
    transform: translateY(calc(-50% + 14px));
    /* Ø¶Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© Ø¨Ø¯Ù‚Ø© */
    color: var(--icon-color);
    cursor: pointer;
  }

  .register_btn {
    width: 100%;
    padding: 15px;
    font-size: clamp(16px, 4vw, 18px);
    /* Responsive font size */
    margin-top: 10px;
    border: none;
    color: var(--bg-color-white);
    /* ØªØ¹Ø¯ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØºÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø®Ù„ÙÙŠØ© */
    background-color: var(--primary-color);
    /* ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù„ÙˆÙ†ÙŠ Ø¨Ù…ØªØºÙŠØ± Ù…ÙˆØ­Ø¯ */
    box-shadow: var(--shadow-interactive),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
    border-radius: 10px;
    /* âœ… Ø¬Ø¯ÙŠØ¯: Ø¥Ø¶Ø§ÙØ© Ø­ÙˆØ§Ù Ø¯Ø§Ø¦Ø±ÙŠØ© Ù„Ù„Ø²Ø± */
  }

  .register_form-footer {
    margin-top: 25px;
    font-size: 14px;
    text-align: center;
    /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨Ø§Ù„Ø¯Ø§Ø®Ù„ */
  }

  .register_error-message {
    color: var(--danger-color);
    font-size: 12px;
    margin-top: 5px;
    min-height: 15px;
    /* Ø­Ø¬Ø² Ù…Ø³Ø§Ø­Ø© Ù„Ù…Ù†Ø¹ Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„ØªØµÙ…ÙŠÙ… */
  }
</style>

<body>
  <div id="header-container1Xx" style="height: 70px"></div>
  <div class="register_page-wrapper">

    <div class="register_container">

      <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
      <form id="register_form" novalidate>
        <div class="register_form-group">
          <label for="register_username"><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù…</label>
          <input type="text" id="register_username" name="username" required autocomplete="off" />
          <div id="register_username-error" class="register_error-message"></div>
        </div>
        <div class="register_form-group">
          <label for="register_phone"><i class="fa fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input type="tel" id="register_phone" name="phone" required autocomplete="tel" />
          <div id="register_phone-error" class="register_error-message"></div>
        </div>
        <div class="register_form-group">
          <label for="register_password"><i class="fas fa-lock"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <div class="register_password-container">
            <input type="password" id="register_password" name="password" required autocomplete="new-password" />
            <i class="fa fa-eye register_toggle-password" id="register_toggle-password-icon"></i>
          </div>
          <div id="register_password-error" class="register_error-message"></div>
          <small class="register_form-hint">ÙŠØ¬Ø¨ Ø£Ù† ØªØªÙƒÙˆÙ† Ù…Ù† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø­Ù…Ø§ÙŠØ© Ø­Ø³Ø§Ø¨Ùƒ.</small>
        </div>
        <div class="register_form-group">
          <label for="register_address"><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input type="text" id="register_address" name="address" autocomplete="off" />
          <div id="register_address-error" class="register_error-message"></div>
          <small class="register_form-hint">Ø§Ø®ØªÙŠØ§Ø±ÙŠ. ÙŠÙØ³ØªØ®Ø¯Ù… Ù„ØªØ³Ù‡ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„ÙŠÙƒ.</small>
        </div>

        <button type="submit" class="button register_btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <div class="register_form-footer">
          <a href="#" id="register_goToLoginLink">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <strong>Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</strong></a>
        </div>
      </form>
    </div>
  </div>

  <script>
    /**
     * @file pages/register.html
     * @description Handles new user registration functionality, including form validation, password confirmation, and serial number generation for user keys.
     */

    const register_form = document.getElementById("register_form");
    const register_username = document.getElementById("register_username");
    const register_phone = document.getElementById("register_phone");
    const register_password = document.getElementById("register_password");
    const register_address = document.getElementById("register_address");

    // Clear input fields on page load to ensure they are always empty.
    if (register_username) register_username.value = "";
    if (register_phone) register_phone.value = "";
    if (register_password) register_password.value = "";
    if (register_address) register_address.value = "";

    /**
     * @function register_generateSerialNumber
     * @description Generates a unique serial number consisting of 4 random lowercase letters and 4 random digits. The characters are key shuffled to increase randomness.
     * @returns {string} A random 8-character string acting as a user key.
     */
    function register_generateSerialNumber() {
      const letters = "abcdefghijklmnopqrstuvwxyz";
      const digits = "0123456789";
      let chars = [];

      // 1. Add 4 random lowercase letters.
      for (let i = 0; i < 4; i++) {
        chars.push(letters.charAt(Math.floor(Math.random() * letters.length)));
      }

      // 2. Add 4 random digits.
      for (let i = 0; i < 4; i++) {
        chars.push(digits.charAt(Math.floor(Math.random() * digits.length)));
      }

      // 3. Shuffle the array to ensure randomness.
      for (let i = chars.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [chars[i], chars[j]] = [chars[j], chars[i]]; // Swap elements.
      }

      // 4. Join the array to form the final string.
      return chars.join("");
    }

    // Add input event listener to sanitize phone number in real-time.
    if (register_phone) {
      register_phone.addEventListener("input", function (e) {
        try {
          let value = e.target.value;
          // Dictionary to convert Indic digits to Arabic numerals.
          const hindiToArabic = {
            "Ù ": "0",
            "Ù¡": "1",
            "Ù¢": "2",
            "Ù£": "3",
            "Ù¤": "4",
            "Ù¥": "5",
            "Ù¦": "6",
            "Ù§": "7",
            "Ù¨": "8",
            "Ù©": "9",
          };

          // Replace Indic digits with Arabic numerals.
          value = value.replace(/[Ù -Ù©]/g, (d) => hindiToArabic[d]);

          // Remove any non-numeric characters (0-9).
          value = value.replace(/[^0-9]/g, "");

          // Update input value.
          e.target.value = value;
        } catch (error) {
          console.error("[Register] Error handling phone input:", error);
        }
      });
    }

    if (register_form) {
      /**
       * @description Handles the registration form submission. Validates username, phone, and password, performs password confirmation via popup, and creates a new user via API.
       * @event submit
       * @async
       */
      register_form.addEventListener("submit", async function (e) {
        e.preventDefault(); // Prevent form from submitting
        console.log("%c[Register] Form submitted.", "color: blue;");
        let register_isValid = true;

        // --- Validation ---

        // 1. Username validation
        clearError(register_username);
        const register_usernameValue = register_username.value.trim();
        console.log("[Register] Validating username...");
        if (register_usernameValue === "") {
          showError(register_username, "Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨.");
          register_isValid = false;
        } else if (
          register_usernameValue.length < 8 ||
          register_usernameValue.length > 30
        ) {
          showError(register_username, "ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø§Ø³Ù… Ø¨ÙŠÙ† 8 Ùˆ 30 Ø­Ø±ÙÙ‹Ø§.");
          register_isValid = false;
        }

        // 2. Phone validation
        clearError(register_phone);
        const register_phoneValue = register_phone.value.trim();
        console.log("[Register] Validating phone number...");
        if (register_phoneValue === "") {
          showError(register_phone, "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø·Ù„ÙˆØ¨.");
          register_isValid = false;
        } else if (register_phoneValue.length < 11) {
          showError(register_phone, "ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ù† 11 Ø±Ù‚Ù…Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
          register_isValid = false;
        }

        // 3. Password validation
        clearError(register_password);
        const register_passwordValue = register_password.value.trim();
        console.log("[Register] Validating password...");
        if (register_passwordValue === "") {
          showError(register_password, "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©.");
          register_isValid = false;
        } else if (register_passwordValue.length < 4) {
          showError(
            register_password,
            "ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„."
          );
          register_isValid = false;
        }

        if (!register_isValid) {
          console.warn("[Register] Validation failed.");
          return;
        }

        // Password confirmation is now mandatory
        console.log("[Register] Prompting for password confirmation...");
        const { value: register_confirmedPassword } = await Swal.fire({
          title: "ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
          html: `
            <p>ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ØªØ£ÙƒÙŠØ¯</p>
            <div class="register_password-container">
              <input type="password" id="register_swal-confirm-password" class="swal2-input" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
              <i class="fa fa-eye register_toggle-password" id="register_swal-toggle-confirm-password" style="top: 60%;"></i>
            </div>
          `,
          showCancelButton: true,
          confirmButtonText: "ØªØ£ÙƒÙŠØ¯",
          cancelButtonText: "Ø¥Ù„ØºØ§Ø¡",
          didOpen: () => {
            const confirmInput = document.getElementById(
              "register_swal-confirm-password"
            );
            const toggleIcon = document.getElementById(
              "register_swal-toggle-confirm-password"
            );
            confirmInput.focus();
            toggleIcon.addEventListener("click", () => {
              const isPassword = confirmInput.type === "password";
              confirmInput.type = isPassword ? "text" : "password";
              toggleIcon.classList.toggle("fa-eye");
              toggleIcon.classList.toggle("fa-eye-slash");
            });
          },
          preConfirm: () => {
            const confirmValue = document.getElementById(
              "register_swal-confirm-password"
            ).value;
            if (confirmValue !== register_password.value) {
              Swal.showValidationMessage("ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©!");
              return false;
            }
            return confirmValue;
          },
        });

        // If user cancelled, stop registration.
        if (!register_confirmedPassword) {
          console.log("[Register] Password confirmation cancelled by user.");
          return;
        }
        const register_userKey = register_generateSerialNumber(); // ğŸ”‘ Generate unique serial number (user_key)
        console.log(`[Register] Generated new user_key: ${register_userKey}`);
        const register_newUser = {
          username: register_username.value.trim(),
          phone: register_phone.value.trim(),
          user_key: register_userKey, // Add serial number to user data
          password: register_password.value, // Can be empty if allowed
          address: register_address.value.trim(), // Can be empty
        };

        console.log(
          "[Register] Sending new user data to API...",
          register_newUser
        );
        // Show loading message using SweetAlert2
        Swal.fire({
          title: "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨...",
          text: "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø­Ø¸Ø©.",
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          },
        });

        try {
          const register_result = await addUser(register_newUser);
          Swal.close(); // Close waiting message

          if (register_result && register_result.message) {
            console.log(
              "%c[Register] Registration successful.",
              "color: green;",
              register_result
            );
            // Save user data in local storage for login
            // âœ… Fix: Ensure all user-entered data is saved, including address
            const register_loggedInUserData = {
              username: register_newUser.username,
              phone: register_newUser.phone,
              user_key: register_newUser.user_key,
              Address: register_newUser.address, // Add address to saved object
              is_seller: 0, // Default seller status
            };
            localStorage.setItem(
              "loggedInUser",
              JSON.stringify(register_loggedInUserData)
            );

            // Update global session
            userSession = register_loggedInUserData;

            // âœ… New: Initialize notifications for new user as in login page
            console.log(
              "[Register] Initializing notifications for new user..."
            );
            if (userSession.user_key != "guest_user") {
              try {
                if (typeof setupFCM === "function") {
                  await setupFCM();
                }
                if (typeof askForNotificationPermission === "function") {
                  await askForNotificationPermission();
                }
              } catch (notifyErr) {
                console.warn(
                  "[Register] Error initializing notifications:",
                  notifyErr
                );
              }
            }
            console.log(
              "[Register] User data saved to localStorage. Redirecting to index.html..."
            );

            // Show welcome message before redirecting to home
            Swal.fire({
              icon: "success",
              title: "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!",
              html: `
      <p style="font-size: 1.1rem; color: #333;">Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ø¬Ø§Ù‡Ø² Ù„ØªØ¬Ø±Ø¨Ø© Ø´Ø±Ø§Ø¡ ÙØ±ÙŠØ¯Ø©!</p>
      <div style="text-align: right; margin-top: 20px; padding-right: 15px; font-size: 1rem;">
        <p style="margin-bottom: 10px;">ğŸ›ï¸ ØªØµÙØ­ Ø¢Ù„Ø§Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø³Ù‡ÙˆÙ„Ø©.</p>
        <p style="margin-bottom: 10px;">ğŸ’° Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø®ØµÙˆÙ…Ø§Øª ÙˆØ¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©.</p>
        <p>âœ¨ Ø§ÙƒØªØ´Ù Ù…Ø§ Ù‡Ùˆ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆÙŠØ³.</p>
      </div>
    `,
              allowOutsideClick: false, // Prevent closing on click outside
              confirmButtonText: "Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
            }).then((result) => {
              // Redirect user after clicking continue
              if (result.isConfirmed) {
                mainLoader(
                  "./pages/home.html",
                  "index-home-container",
                  0,
                  undefined,
                  "hiddenHomeIcon",
                  true
                );
                setUserNameInIndexBar();
              }
            });
          } else if (register_result && register_result.error) {
            console.warn(
              "[Register] API returned an error:",
              register_result.error
            );
            // If server error (e.g., duplicate phone number)
            showError(register_phone, register_result.error);
          } else {
            console.error("[Register] Unknown API failure.");
            // Unknown server failure
            showError(register_form, "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
          }
        } catch (error) {
          Swal.close(); // Ensure message is closed on error
          console.error(
            "%c[Register] Critical error during registration:",
            "color: red; font-weight: bold;",
            error
          );
          // Connection or code error
          showError(register_form, "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        }
      });
    }

    // Handle navigation to the login page.
    try {
      const register_loginLink = document.getElementById(
        "register_goToLoginLink"
      );
      if (register_loginLink) {
        register_loginLink.addEventListener("click", function (e) {
          e.preventDefault();
          mainLoader(
            "./pages/login.html",
            "index-user-container",
            0,
            undefined,
            "showHomeIcon",
            true
          );
        });
      }
    } catch (error) {
      console.error("[Register] Could not find or bind login link:", error);
    }

    // New: Add password visibility toggle for the main form.
    const register_togglePasswordIcon = document.getElementById(
      "register_toggle-password-icon"
    );
    if (register_togglePasswordIcon && register_password) {
      register_togglePasswordIcon.addEventListener("click", function () {
        // Toggle input type.
        const type =
          register_password.getAttribute("type") === "password"
            ? "text"
            : "password";
        register_password.setAttribute("type", type);

        // Toggle eye icon.
        this.classList.toggle("fa-eye");
        this.classList.toggle("fa-eye-slash");
      });
    }
    // This element is inserted in the way followed in the project (hgh_sec).
    insertUniqueSnapshot("/pages/header.html", "header-container1Xx", 300);
  </script>
</body>