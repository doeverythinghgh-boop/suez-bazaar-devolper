<style>
  /* Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ£Ø«ÙŠØ±Ø§Øª hover ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹. */

  /* === New and Improved Login Page Design === */

  /* 1. Page Background and General Layout */
  @keyframes login_gradient-animation {
    0% {
      background-position: 0% 50%;
    }

    50% {
      background-position: 100% 50%;
    }

    100% {
      background-position: 0% 50%;
    }
  }

  .login_page-wrapper {
    font-family: "Tajawal", sans-serif;
    /* Ø¬Ø¯ÙŠØ¯: Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ø¬Ø°Ø§Ø¨Ø© */
    background-size: 400% 400%;
    animation: login_gradient-animation 15s ease infinite;
    min-height: 100vh;
    display: flex;
    /* âœ… ØªØ¹Ø¯ÙŠÙ„: ØªØºÙŠÙŠØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© */
    align-items: flex-start;
    /* Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
    justify-content: center;
    padding: 20px;
    /* âœ… ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¶Ø§ÙØ© Ø­Ø´Ùˆ Ø¹Ù„ÙˆÙŠ Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ù„Ø£Ø³ÙÙ„ Ù‚Ù„ÙŠÙ„Ù‹Ø§ */
    box-sizing: border-box;
  }

  /* 2. Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©) */
  .login_container {
    background-color: var(--bg-color-white);
    width: 100%;
    /* ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ø«Ø§Ø¨Øª Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 0;
    /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø´Ùˆ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
    background: none;
    /* Ø¬Ø¹Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø´ÙØ§ÙØ© */
  }

  /* 3. Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) */
  .login_container h2 {
    margin-top: 0;
    margin-bottom: 0px;
    /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© */
    color: var(--dark-blue);
    /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ ÙˆØ£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ù‹Ø§ */
    font-size: clamp(28px, 6vw, 36px);
    /* ØªÙƒØ¨ÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
    font-weight: 700;
    text-align: center;
  }

  /* 4. Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù†ÙØ³Ù‡ */
  .login_container form {
    width: 100%;
    max-width: 420px;
    /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚ØµÙ‰ */
    /* Ø¬Ø¯ÙŠØ¯: ØªØ£Ø«ÙŠØ± Ø²Ø¬Ø§Ø¬ÙŠ Ø´ÙØ§Ù */
    background-color: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 40px;
    border-radius: 20px;
    /* Ø­ÙˆØ§Ù Ø£ÙƒØ«Ø± Ø¯Ø§Ø¦Ø±ÙŠØ© */
    /* Ø¬Ø¯ÙŠØ¯: Ø¸Ù„ Ø£ÙƒØ«Ø± Ù†Ø¹ÙˆÙ…Ø© ÙˆØ¹Ù…Ù‚Ù‹Ø§ */
    box-shadow: var(--shadow-soft);
    border: 1px solid var(--border-color-soft);
  }

  /* 5. Ù…Ø¬Ù…ÙˆØ¹Ø© Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø­Ù‚Ù„) */
  .login_form-group {
    margin-bottom: 20px;
    text-align: right;
    /* Align labels to the right */
    position: relative;
    /* Ù…Ù‡Ù… Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø§Ù„Ø¯Ø§Ø®Ù„ */
  }

  .login_form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--dark-blue);
    /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ø¯Ø§ÙƒÙ† */
    font-size: 0.9rem;
  }

  /* 6. Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
  .login_form-group input {
    width: 100%;
    /* ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø­Ø§ÙˆÙŠØ© */
    padding: 14px 45px 14px 15px;
    /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
    border: 1px solid var(--border-color-input);
    /* Ù„ÙˆÙ† Ø¥Ø·Ø§Ø± Ø£ÙØªØ­ */
    border-radius: 10px;
    /* Ø²ÙŠØ§Ø¯Ø© Ø¯Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø­ÙˆØ§Ù */
    box-sizing: border-box;
    font-family: "Tajawal", sans-serif;
    font-size: 16px;
    transition: border-color 0.3s, box-shadow 0.3s;
    background-color: var(--bg-color-white);
    /* ØªØ¹Ø¯ÙŠÙ„: Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ù†Ù‚ÙŠØ© */
  }

  /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¯Ø§Ø®Ù„ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù€ password */
  .login_password-wrapper {
    position: relative;
  }



  /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (ÙÙŠ Ø­Ø§Ù„Ø© Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ) */
  .login_form-group .fa-phone,
  .login_form-group .fa-user {
    /* ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ø³ÙŠÙ† Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
    position: absolute;
    top: 50%;
    right: 15px;
    /* Ù„Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ RTL */
    transform: translateY(calc(-50% + 14px));
    /* Ø¶Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© Ø¨Ø¯Ù‚Ø© */
    color: var(--icon-color);
    cursor: pointer;
  }

  /* Style for input fields with validation errors */
  .login_form-group input.login_input-error {
    border-color: var(--danger-color);
    /* Red border for error */
  }

  .login_form-group input.login_input-error:focus {
    box-shadow: 0 0 0 3px var(--danger-color-light);
    /* Red shadow on focus */
  }

  /* Style for the error message below the input */
  .login_error-message {
    color: var(--danger-color);
    /* Red color for error text */
    font-size: 12px;
    margin-top: 5px;
    min-height: 15px;
    /* Reserve space to prevent layout shifts */
  }

  .login_form-group input:focus {
    outline: none;
    border-color: var(--primary-color);
    /* ØªØ¹Ø¯ÙŠÙ„: Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ù…ØªÙ†Ø§Ø³Ù‚ */
    box-shadow: var(--shadow-focus);
  }

  /* 7. Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
  .login_btn {
    width: 100%;
    padding: 15px;
    font-size: clamp(16px, 4vw, 18px);
    /* Responsive font size */
    margin-top: 10px;
    border: none;
    color: white;
    background-color: var(--primary-color);
    box-shadow: 0 4px 15px var(--primary-color-light),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
    border-radius: 10px;
    /* ÙŠÙØ¶Ù„ Ø¥Ø¶Ø§ÙØ© Ø­ÙˆØ§Ù Ø¯Ø§Ø¦Ø±ÙŠØ© Ù„ÙŠØªÙ†Ø§Ø³Ù‚ Ù…Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ */
  }

  .login_btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 8px var(--primary-color-light);
  }

  /* 8. ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Ø±ÙˆØ§Ø¨Ø· Ø¥Ø¶Ø§ÙÙŠØ©) */
  .login_form-footer {
    margin-top: 25px;
    font-size: 14px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: center;
  }

  /* Ø±Ø§Ø¨Ø· "Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†": ÙŠØ¸Ù‡Ø± ÙƒØ¥Ø¬Ø±Ø§Ø¡ Ø«Ø§Ù†ÙˆÙŠ Ø£Ø³Ø§Ø³ÙŠ */
  .login_form-footer-link {
    color: var(--primary-color);
    /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ ÙˆØ§Ø¶Ø­ */
    font-size: 14px;
    /* ØªØ¹Ø¯ÙŠÙ„: ØªÙˆØ­ÙŠØ¯ Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
    text-decoration: none;
  }

  /* Ø±Ø§Ø¨Ø· "Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ¶ÙŠÙ": ÙŠØ¸Ù‡Ø± ÙƒØ®ÙŠØ§Ø± Ø¨Ø¯ÙŠÙ„ ÙˆØ£Ù‚Ù„ Ø£Ù‡Ù…ÙŠØ© */
  .login_guest-link {
    color: var(--text-color-light);
    /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ù„Ø¬Ø¹Ù„Ù‡ Ø£Ù‚Ù„ Ø¨Ø±ÙˆØ²Ù‹Ø§ */
    font-size: 14px;
    border-top: 1px solid var(--border-color);
    /* Ø®Ø· ÙØ§ØµÙ„ Ø£ØºÙ…Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    padding-top: 15px;
    /* Ù…Ø³Ø§ÙØ© ÙÙˆÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø· */
    width: 100%;
    /* Ø¬Ø¹Ù„Ù‡ ÙŠÙ…ØªØ¯ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
    text-align: center;
    /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Øµ */
    text-decoration: none;
  }

  /* Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØ¨Ø¯ÙŠÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */
  .login_toggle-password {
    position: absolute;
    top: 50%;
    left: 15px;
    /* Ù„Ù„ÙŠØ³Ø§Ø± ÙÙŠ RTL */
    transform: translateY(calc(-50% + 14px));
    /* Ø¶Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© Ø¨Ø¯Ù‚Ø© */
    color: var(--icon-color);
    cursor: pointer;
  }

  /* ØªØ¹Ø¯ÙŠÙ„ Ø­Ù‚Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */
  #login_password {
    padding-left: 45px;
    /* Ù…Ø³Ø§Ø­Ø© Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¹ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */
  }

  .login_form-footer a strong {
    font-weight: 700;
  }

  /* === Back to Home Button (in Header) - ØªÙ… Ø§Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„ÙŠÙ‡ ÙƒÙ…Ø§ Ù‡Ùˆ ÙƒÙˆÙ†Ù‡ Ø¹Ù†ØµØ± Ù‡ÙŠØ¯Ø± ÙˆÙ„ÙŠØ³ Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ === */
  .back-to-home-btn {
    display: flex;
    flex-direction: column;
    /* Ø¬Ø¹Ù„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§Ù„Ù†Øµ Ø¨ØªØ±ØªÙŠØ¨ Ø¹Ù…ÙˆØ¯ÙŠ */
    align-items: center;
    gap: 2px;
    /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§Ù„Ù†Øµ */
    font-family: "Tajawal", sans-serif;
    font-weight: 600;
    color: var(--dark-blue);
    /* âœ… ØªØ¹Ø¯ÙŠÙ„: ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø²Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ù‚ */
    text-decoration: none;
    padding: 8px 12px;
    border-radius: 20px;
    transition: background-color 0.3s, color 0.3s;
  }

  .back-to-home-btn i {
    font-size: 16px;
    margin-bottom: 2px;
    /* Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§ÙØ© ØµØºÙŠØ±Ø© Ø£Ø³ÙÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
  }

  .back-to-home-btn span {
    font-size: 12px;
    /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø®Ø· Ø§Ù„Ù†Øµ */
    white-space: nowrap;
    /* Ù…Ù†Ø¹ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„Ø§Ù†Ù‚Ø³Ø§Ù… Ø¥Ù„Ù‰ Ø³Ø·Ø±ÙŠÙ† */
  }

  /* Media query for very small screens */
  @media (max-width: 480px) {
    .login_container form {
      padding: 30px 25px;
      /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø´Ùˆ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ */
      /* Ø¬Ø¯ÙŠØ¯: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¸Ù„ ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ */
      box-shadow: none;
      border: none;
      background-color: transparent;
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
      /* For Safari compatibility */
    }

    .login_form-group {
      margin-bottom: 15px;
    }
  }
</style>

<div id="header-container1X" style="height: 70px"></div>

<div id="login_form-wrapper" class="login_page-wrapper" style="display: none">
  <div id="login_form-container" class="login_container">
    <h2 id="login_title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <form id="login_form">
      <div id="login_phone-form-group" class="login_form-group">
        <label for="login_phone"><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input type="tel" id="login_phone" name="login_phone" required />
        <div id="login_phone-error" class="login_error-message"></div>
      </div>
      <div id="login_password-form-group" class="login_form-group">
        <label for="login_password"><i class="fas fa-lock"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" id="login_password" name="login_password" required />
        <i class="fas fa-eye login_toggle-password" id="login_togglePassword"></i>
        <div id="login_password-error" class="login_error-message"></div>
      </div>
      <button type="submit" class="button login_btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <div id="login_form-footer" class="login_form-footer">
        <a href="#" id="login_go-to-register-link" class="login_form-footer-link">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <strong>Ø³Ø¬Ù„
            Ø§Ù„Ø¢Ù†</strong></a>
        <a id="login_guest-btn" class="login_guest-link">Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ <strong>Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ¶ÙŠÙ</strong> Ù„ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
      </div>
    </form>
  </div>
</div>
<script>
  /**
   * @file pages/login.html
   * @description Handles user login functionality, including form validation, authentication via API, and guest login access.
   */

  /**
   * @function loadPage
   * @description Main initialization function for the login page. Checks user session status and displays the login form only if the user is not logged in. Binds event handlers.
   * @async
   * @param {object} [params] - Optional parameters passed from the previous page.
   * @returns {Promise<void>}
   */
  async function loadPage(params) {
    try {
      // Refresh userSession from localStorage to ensure we have the latest state.
      // This prevents the code from believing the user is still logged in after logout
      // if the global userSession variable hasn't been updated yet.
      userSession = JSON.parse(localStorage.getItem("loggedInUser")) || null;

      // Check if a user is already logged in.
      if (Number(userSession?.is_seller) >= 1) {
        // Attempt to initialize notifications for the current user if logged in.
        if (typeof initializeNotifications === "function") {
          //  initializeNotifications();
        }
        // Stop execution to allow for redirection (redirection should happen elsewhere)
        return;
      }

      // Show login form only if no user is logged in.
      const loginFormWrapper = document.getElementById("login_form-wrapper");
      if (loginFormWrapper) {
        // Use 'flex' as it matches the CSS.
        loginFormWrapper.style.display = "flex";
      }

      // Setup login form.
      login_setupLoginForm();

    } catch (error) {
      console.error("ğŸš« Error in loadPage function:", error);
      // Show generic error to user using SweetAlert2.

    }
  }

  /**
   * @function login_setupLoginForm
   * @description Sets up all event listeners for the login form.
   * Includes: password visibility toggle, phone number sanitization, and submit event handler.
   * @returns {void}
   */
  function login_setupLoginForm() {
    try {
      // Get form elements
      const loginForm = document.getElementById("login_form");
      if (!loginForm) return;

      const loginPhoneInput = document.getElementById("login_phone");
      const loginPasswordInput = document.getElementById("login_password");
      const loginTogglePassword = document.getElementById("login_togglePassword");
      const loginGuestBtn = document.getElementById("login_guest-btn");

      // 1. Add password visibility toggle functionality
      if (loginTogglePassword && loginPasswordInput) {
        loginTogglePassword.addEventListener("click", function () {
          // Toggle input type
          const type =
            loginPasswordInput.getAttribute("type") === "password" ? "text" : "password";
          loginPasswordInput.setAttribute("type", type);
          // Toggle eye icon
          this.classList.toggle("fa-eye");
          this.classList.toggle("fa-eye-slash");
        });
      }

      // 2. Input event handler for phone number (sanitization)
      if (loginPhoneInput) {
        loginPhoneInput.addEventListener("input", function (e) {
          // Use `normalizeDigits` to convert Indic digits (e.g. 'Ù Ù¡Ù¢') to Arabic numerals ('012').
          const normalized = normalizeDigits(e.target.value);
          // Remove any non-numeric characters.
          e.target.value = normalized.replace(/[^0-9]/g, "");
        });
      }

      // 3. Login form submit handler
      loginForm.addEventListener("submit", login_handleSubmit);

      // 4. Bind "Login as Guest" button event.
      if (loginGuestBtn) {
        loginGuestBtn.addEventListener("click", login_handleGuestLogin);
      }

      // 5. Bind "Register Now" link event.
      const registerLink = document.getElementById("login_go-to-register-link");
      if (registerLink) {
        registerLink.addEventListener("click", login_handleRegisterClick);
      }

    } catch (error) {
      console.error("ğŸš« Error in login_setupLoginForm function:", error);
    }
  }

  /**
   * @function login_handleRegisterClick
   * @description Handles the click event on the "Register Now" link.
   * @param {Event} e - The event object.
   */
  function login_handleRegisterClick(e) {
    e.preventDefault();
    mainLoader("./pages/register.html", "index-user-container", 0, undefined, "hiddenLoginIcon", true);
  }


  /**
   * @function login_handleSubmit
   * @description Handles the login form submission. Validates inputs and communicates with the backend to verify credentials.
   * @async
   * @param {Event} e - The submit event object.
   * @returns {Promise<void>}
   */
  async function login_handleSubmit(e) {
    try {
      console.log(
        "%c[Login Page] Login button clicked.",
        "color: blue; font-weight: bold;"
      );
      // Prevent default form submission.
      e.preventDefault();

      const loginPhoneInput = document.getElementById("login_phone");
      const loginPasswordInput = document.getElementById("login_password");

      // 1. Clear previous errors.
      if (typeof clearError === "function") {
        clearError(loginPhoneInput);
        clearError(loginPasswordInput);
      }

      // 2. Get values and validate inputs.
      const phoneValue = loginPhoneInput.value.trim();
      const passwordValue = loginPasswordInput.value.trim();
      let loginIsValid = true;

      // Validate Phone
      if (phoneValue === "") {
        showError(loginPhoneInput, "Phone number is required.");
        loginIsValid = false;
      } else if (phoneValue.length < 11) {
        showError(loginPhoneInput, "Phone number must be at least 11 digits.");
        loginIsValid = false;
      }

      // Validate Password
      if (passwordValue === "") {
        showError(loginPasswordInput, "Password is required.");
        loginIsValid = false;
      } else if (passwordValue.length < 4) {
        showError(loginPasswordInput, "Password must be at least 4 characters.");
        loginIsValid = false;
      }

      // 3. If all inputs are valid.
      if (loginIsValid) {
        console.log("[Login Page] Form valid, verifying credentials...");

        // Show loading popup.
        Swal.fire({
          title: "Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...",
          text: "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø­Ø¸Ø©.",
          allowOutsideClick: false,
          didOpen: () => {
            // Show loading spinner.
            Swal.showLoading();
          },
          customClass: { popup: 'fullscreen-swal' }, // Apply custom style
        });

        // 4. Verify user credentials with server.
        const verificationResult = await verifyUserPassword(
          phoneValue,
          passwordValue
        );

        // 5. Handle verification result.
        if (verificationResult && !verificationResult.error) {

          login_handleLoginSuccess(verificationResult);
        } else {
          // Verification failed.
          console.error(
            "[Login Page] Login failed:",
            verificationResult?.error || "Unknown error"
          );
          Swal.close();
          const errorMessage =
            "Incorrect password or phone number. please check them.";
          if (typeof showError === "function") {
            showError(loginPasswordInput, errorMessage);
          }
        }
      }
    } catch (error) {
      console.error("ğŸš« Error in login_handleSubmit:", error);
      // Close loading popup and show error.

    }
  }

  /**
   * @function login_handleLoginSuccess
   * @description Handles actions after a successful login.
   * @param {object} user - The logged-in user object.
   * @async
   * @returns {Promise<void>}
   */
  async function login_handleLoginSuccess(user) {
    try {
      console.log(
        "%c[Login Page] Entered login_handleLoginSuccess. User data:",
        "color: green;",
        user
      );

      // 1. Save user data and update session.
      localStorage.setItem("loggedInUser", JSON.stringify(user));
      userSession = user; // Update user session global object.
      setUserNameInIndexBar();
      // 2. Setup FCM notifications if eligible.
      if (userSession.user_key != "guest_user") {
        await setupFCM();
        await askForNotificationPermission();
      } else {
        console.log(
          "[Login Page] User not eligible for notifications, skipping setupFCM()."
        );
      }

      // 3. Show welcome message and redirect to home.
      Swal.fire({
        title: `ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ${userSession.username}! ğŸ‰`,
        html: `
        <p style="font-size: 1.1rem; color: #333;">Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ø¬Ø§Ù‡Ø² Ù„ØªØ¬Ø±Ø¨Ø© ØªØ³ÙˆÙ‚ ÙØ±ÙŠØ¯Ø©!</p>
        <div style="text-align: right; margin-top: 20px; padding-right: 15px; font-size: 1rem;">
          <p style="margin-bottom: 10px;">ğŸ›ï¸ ØªØµÙØ­ Ø¢Ù„Ø§Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø³Ù‡ÙˆÙ„Ø©.</p>
          <p style="margin-bottom: 10px;">ğŸ’° Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø®ØµÙˆÙ…Ø§Øª ÙˆØ¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©.</p>
          <p>âœ¨ Ø§ÙƒØªØ´Ù Ù…Ø§ Ù‡Ùˆ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆÙŠØ³.</p>
        </div>
      `,
        icon: "success",
        allowOutsideClick: false, // Prevent closing on click outside
        confirmButtonText: "Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†!",
        confirmButtonColor: "#3b82f6",
        customClass: { popup: 'fullscreen-swal' }, // Apply custom style
      }).then((result) => {
        // Redirect to home page on button click.
        if (result.isConfirmed) {
          if (typeof mainLoader === "function") {
            mainLoader("./pages/home.html", "index-home-container", 0, undefined, "hiddenHomeIcon", true);
          }
        }
      });

    } catch (error) {
      console.error("ğŸš« Ø®Ø·Ø£ ÙÙŠ Ø¯Ø§Ù„Ø© login_handleLoginSuccess:", error);
    }
  }


  /**
   * @function login_handleGuestLogin
   * @description Handles guest login process. Creates a dummy guest user session.
   * @param {Event} event - The event object to prevent default link behavior.
   * @returns {void}
   */
  function login_handleGuestLogin(event) {
    try {
      event.preventDefault(); // Prevent link from updating page.
      console.log("[Auth] Logging in as a guest.");

      // Create guest user object.
      const guestUser = {
        username: "Guest",
        is_guest: true,
        user_key: "guest_user",
        is_seller: -1,
        notifications_key: null, // Guest has no notifications key.
        notifications_enabled: false, // Notifications disabled for guest.
      };

      // Save guest data in localStorage and update session.
      localStorage.setItem("loggedInUser", JSON.stringify(guestUser));
      userSession = guestUser;
      setUserNameInIndexBar();
      // Reload home page fully to update UI.
      if (typeof mainLoader === "function") {
        mainLoader(
          "./pages/home.html",
          "index-home-container",
          0,
          undefined,
          "hiddenHomeIcon", true
        );
      }
    } catch (error) {
      console.error("ğŸš« Error in login_handleGuestLogin function:", error);
    }
  }



  loadPage();

  // ÙŠØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ØªØ¨Ø¹Ø© ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (hgh_sec)
  insertUniqueSnapshot("/pages/header.html", "header-container1X", 300);
</script>