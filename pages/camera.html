
    <style>
        /* Reset ÙˆØªØ¹Ø±ÙŠÙØ§Øª Ø¹Ø§Ù…Ø© */
    
        /* Ù‡ÙŠÙƒÙ„ Ø§Ù„ØµÙØ­Ø© */
        .app-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
    
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
        .camera-section {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #000;
        }
        
        #camera-view {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Ù„Ù‚Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© */
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            pointer-events: none;
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .controls-section {
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .controls-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin-bottom: 15px;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            pointer-events: auto;
        }
        
        .control-btn:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .capture-btn {
            width: 80px;
            height: 80px;
            background: #f44336;
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(244, 67, 54, 0.5);
        }
        
        .capture-btn:active {
            background: #d32f2f;
            transform: scale(0.9);
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ù„ØªÙ‚Ø·Ø© */
        .gallery-section {
            background: rgba(0, 0, 0, 0.95);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: 15px;
            max-height: 150px;
            overflow-y: hidden;
        }
        
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .gallery-title {
            font-size: 1rem;
            color: #fff;
        }
        
        .image-count {
            background: #2196F3;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.9rem;
        }
        
        .images-container {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 5px 0;
            scrollbar-width: thin;
            scrollbar-color: #2196F3 #000;
        }
        
        .images-container::-webkit-scrollbar {
            height: 6px;
        }
        
        .images-container::-webkit-scrollbar-track {
            background: #000;
        }
        
        .images-container::-webkit-scrollbar-thumb {
            background: #2196F3;
            border-radius: 3px;
        }
        
        .image-item {
            flex: 0 0 auto;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            border: 2px solid transparent;
            transition: border-color 0.2s ease;
        }
        
        .image-item.selected {
            border-color: #4CAF50;
        }
        
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(244, 67, 54, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: auto;
        }
        
        .image-item:hover .remove-btn {
            opacity: 1;
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
        .actions-section {
            background: rgba(0, 0, 0, 0.95);
            padding: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .action-btn:active {
            transform: scale(0.98);
        }
        
        .cancel-btn {
            background: #757575;
            color: white;
        }
        
        .cancel-btn:active {
            background: #616161;
        }
        
        .save-btn {
            background: #4CAF50;
            color: white;
        }
        
        .save-btn:active {
            background: #388E3C;
        }
        
        /* Ø­Ø§Ù„Ø© ÙØ§Ø±ØºØ© */
        .empty-state {
            text-align: center;
            padding: 30px 20px;
            color: rgba(255,255,255,0.5);
            font-style: italic;
        }
        
        /* Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
        .camera-indicators {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 15px;
            border-radius: 20px;
            margin: 0 auto;
            width: fit-content;
            pointer-events: auto;
        }
        
        .camera-type {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .camera-type .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4CAF50;
        }
        
        .photo-count {
            font-size: 0.9rem;
            color: #fff;
        }
        
        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø§Ù„Ø© */
        .status-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1rem;
            text-align: center;
            z-index: 1000;
            display: none;
            max-width: 80%;
        }
        
        /* Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© */
        @media (max-width: 480px) {
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
            
            .capture-btn {
                width: 70px;
                height: 70px;
            }
            
            .image-item {
                width: 70px;
                height: 70px;
            }
            
            .action-btn {
                padding: 12px;
                font-size: 0.9rem;
            }
        }
        
        @media (min-width: 768px) {
            .controls-row {
                gap: 60px;
            }
            
            .control-btn {
                width: 70px;
                height: 70px;
            }
            
            .capture-btn {
                width: 90px;
                height: 90px;
            }
        }
    </style>

<body>
    <div class="app-container">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
        <div class="header">
            <h1>ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h1>
            <div class="subtitle">Ø§Ù„ØªÙ‚Ø· Ø§Ù„ØµÙˆØ± ÙˆØ§Ø¶ØºØ· Ø­ÙØ¸ Ù„Ø¥Ø¶Ø§ÙØªÙ‡Ø§</div>
        </div>
        
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
        <div class="camera-section">
            <video id="camera-view" autoplay playsinline></video>
            
            <div class="camera-overlay">
                <div class="camera-indicators" id="camera-indicators">
                    <div class="camera-type">
                        <span class="dot"></span>
                        <span id="camera-type-text">ÙƒØ§Ù…ÙŠØ±Ø§ Ø®Ù„ÙÙŠØ©</span>
                    </div>
                    <div class="photo-count" id="photo-count">0 ØµÙˆØ±</div>
                </div>
            </div>
        </div>
        
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="controls-section">
            <div class="controls-row">
                <button class="control-btn" id="switch-camera-btn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§">
                    ğŸ”„
                </button>
                <button class="control-btn capture-btn" id="capture-btn" title="Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©">
                    ğŸ“¸
                </button>
                <button class="control-btn" id="flash-btn" title="ÙÙ„Ø§Ø´">
                    âš¡
                </button>
            </div>
        </div>
        
        <!-- Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ù„ØªÙ‚Ø·Ø© -->
        <div class="gallery-section">
            <div class="gallery-header">
                <div class="gallery-title">Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ù„ØªÙ‚Ø·Ø©</div>
                <div class="image-count" id="image-count">0</div>
            </div>
            
            <div class="images-container" id="images-container">
                <div class="empty-state" id="empty-state">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø£ÙŠ ØµÙˆØ± Ø¨Ø¹Ø¯</div>
            </div>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
        <div class="actions-section">
            <div class="action-buttons">
                <button class="action-btn cancel-btn" id="cancel-btn">
                    <span>âœ•</span> Ø¥Ù„ØºØ§Ø¡
                </button>
                <button class="action-btn save-btn" id="save-btn">
                    <span>ğŸ’¾</span> Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±
                </button>
            </div>
        </div>
        
        <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div class="status-message" id="status-message"></div>
    </div>

    <script>
        // ============================================
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ============================================
        var App = {
            // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            state: {
                currentStream: null,
                facingMode: 'environment', // 'environment' Ù„Ù„Ø®Ù„ÙÙŠØ©, 'user' Ù„Ù„Ø£Ù…Ø§Ù…ÙŠØ©
                capturedImages: [], // [{id, url, blob, dataUrl, timestamp}]
                isProcessing: false,
                flashMode: 'off' // 'off', 'on', 'auto'
            },
            
            // Ø¹Ù†Ø§ØµØ± DOM
            elements: {
                cameraView: document.getElementById('camera-view'),
                switchCameraBtn: document.getElementById('switch-camera-btn'),
                captureBtn: document.getElementById('capture-btn'),
                flashBtn: document.getElementById('flash-btn'),
                cancelBtn: document.getElementById('cancel-btn'),
                saveBtn: document.getElementById('save-btn'),
                imagesContainer: document.getElementById('images-container'),
                emptyState: document.getElementById('empty-state'),
                cameraTypeText: document.getElementById('camera-type-text'),
                photoCount: document.getElementById('photo-count'),
                imageCount: document.getElementById('image-count'),
                statusMessage: document.getElementById('status-message'),
                cameraIndicators: document.getElementById('camera-indicators')
            },
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            init() {
                console.log('Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...');
                
                // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                this.bindEvents();
                
                // Ø¨Ø¯Ø¡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                this.startCamera();
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ WebView
                this.testWebViewConnection();
            },
            
            // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            bindEvents() {
                // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                this.elements.switchCameraBtn.addEventListener('click', () => {
                    this.switchCamera();
                });
                
                // Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©
                this.elements.captureBtn.addEventListener('click', () => {
                    this.captureImage();
                });
                
                // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙÙ„Ø§Ø´
                this.elements.flashBtn.addEventListener('click', () => {
                    this.toggleFlash();
                });
                
                // Ø¥Ù„ØºØ§Ø¡
                this.elements.cancelBtn.addEventListener('click', () => {
                    this.cancelOperation();
                });
                
                // Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±
                this.elements.saveBtn.addEventListener('click', () => {
                    this.saveImages();
                });
                
                // Ø­Ø¯Ø« Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚/ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
                window.addEventListener('beforeunload', () => {
                    this.cleanup();
                });
                
                // Ø­Ø¯Ø« Ø¹Ù†Ø¯ ØªÙˆÙ‚Ù Ø§Ù„ØµÙØ­Ø© (Ù„Ù€ WebView)
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        this.pauseCamera();
                    } else {
                        this.resumeCamera();
                    }
                });
            },
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ WebView
            testWebViewConnection() {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Android WebView Interface
                setTimeout(() => {
                    if (window.Android && typeof window.Android.appLoaded === 'function') {
                        console.log('ØªÙ… Ø§ÙƒØªØ´Ø§Ù Android WebView Interface');
                        window.Android.appLoaded('ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²Ø©');
                    } else {
                        console.log('ØªØ¹Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¹Ø§Ø¯ÙŠ');
                        this.showStatus('ÙˆØ¶Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¹Ø§Ø¯ÙŠ', 2000);
                    }
                }, 1000);
            },
            
            // Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            async startCamera() {
                if (this.state.isProcessing) return;
                
                this.state.isProcessing = true;
                this.showStatus('Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...', 2000);
                
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¥Ù† ÙˆØ¬Ø¯Øª
                if (this.state.currentStream) {
                    this.stopCamera();
                }
                
                // Ù‚ÙŠÙˆØ¯ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                const constraints = {
                    video: {
                        facingMode: this.state.facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                };
                
                try {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… API
                    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                        throw new Error('ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
                    }
                    
                    // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    
                    // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                    this.state.currentStream = stream;
                    this.elements.cameraView.srcObject = stream;
                    
                    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    this.updateCameraUI();
                    
                    console.log('Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø¯Ø£Øª Ø¨Ù†Ø¬Ø§Ø­');
                    this.showStatus('Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬Ø§Ù‡Ø²Ø©', 1500);
                    
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:', error);
                    
                    let errorMessage = 'ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
                    
                    if (error.name === 'NotAllowedError') {
                        errorMessage = 'ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªÙØ¹ÙŠÙ„Ù‡ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚';
                    } else if (error.name === 'NotFoundError') {
                        errorMessage = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²';
                    } else if (error.name === 'NotSupportedError') {
                        errorMessage = 'Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
                    } else if (error.name === 'NotReadableError') {
                        errorMessage = 'Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù† Ù‚Ø¨Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø¢Ø®Ø±';
                    }
                    
                    this.showStatus(errorMessage, 4000, true);
                    
                    // Ø¥Ø¹Ù„Ø§Ù… WebView Ø¨Ø§Ù„Ø®Ø·Ø£
                    if (window.Android && typeof window.Android.onCameraError === 'function') {
                        window.Android.onCameraError(errorMessage);
                    }
                } finally {
                    this.state.isProcessing = false;
                }
            },
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            stopCamera() {
                if (this.state.currentStream) {
                    this.state.currentStream.getTracks().forEach(track => {
                        track.stop();
                    });
                    this.state.currentStream = null;
                    this.elements.cameraView.srcObject = null;
                }
            },
            
            // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            pauseCamera() {
                if (this.state.currentStream) {
                    this.state.currentStream.getTracks().forEach(track => {
                        track.enabled = false;
                    });
                }
            },
            
            // Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            resumeCamera() {
                if (this.state.currentStream) {
                    this.state.currentStream.getTracks().forEach(track => {
                        track.enabled = true;
                    });
                }
            },
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            switchCamera() {
                if (this.state.isProcessing) return;
                
                this.state.facingMode = this.state.facingMode === 'environment' ? 'user' : 'environment';
                this.startCamera();
            },
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙÙ„Ø§Ø´
            toggleFlash() {
                const modes = ['off', 'on', 'auto'];
                const currentIndex = modes.indexOf(this.state.flashMode);
                this.state.flashMode = modes[(currentIndex + 1) % modes.length];
                
                // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ÙÙ„Ø§Ø´
                const icons = ['âš¡', 'ğŸ”¦', 'ğŸ”„'];
                this.elements.flashBtn.textContent = icons[(currentIndex + 1) % modes.length];
                
                this.showStatus(`Ø§Ù„ÙÙ„Ø§Ø´: ${this.state.flashMode === 'on' ? 'ØªØ´ØºÙŠÙ„' : 
                    this.state.flashMode === 'off' ? 'Ø¥ÙŠÙ‚Ø§Ù' : 'ØªÙ„Ù‚Ø§Ø¦ÙŠ'}`, 1500);
            },
            
            // Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©
            captureImage() {
                if (this.state.isProcessing || !this.state.currentStream) {
                    this.showStatus('Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø©', 1500, true);
                    return;
                }
                
                this.state.isProcessing = true;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± canvas Ù…Ø¤Ù‚Øª
                const canvas = document.createElement('canvas');
                const video = this.elements.cameraView;
                
                // Ø¶Ø¨Ø· Ø£Ø¨Ø¹Ø§Ø¯ Canvas Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ÙØ¹Ù„ÙŠØ©
                canvas.width = video.videoWidth || 1280;
                canvas.height = video.videoHeight || 720;
                
                // Ø§Ù„Ø±Ø³Ù… Ø¹Ù„Ù‰ Canvas
                const context = canvas.getContext('2d');
                
                // Ù‚Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ù…Ø§Ù…ÙŠØ©
                if (this.state.facingMode === 'user') {
                    context.translate(canvas.width, 0);
                    context.scale(-1, 1);
                }
                
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Data URL
                const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Blob
                canvas.toBlob((blob) => {
                    const imageData = {
                        id: Date.now() + Math.random(),
                        url: URL.createObjectURL(blob),
                        dataUrl: dataUrl,
                        blob: blob,
                        timestamp: new Date().toLocaleTimeString('ar-EG'),
                        cameraType: this.state.facingMode === 'environment' ? 'Ø®Ù„ÙÙŠØ©' : 'Ø£Ù…Ø§Ù…ÙŠØ©'
                    };
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø©
                    this.state.capturedImages.push(imageData);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    this.updateGallery();
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                    this.showStatus('ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©!', 1500);
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                    this.state.isProcessing = false;
                    
                    // ØªØ­Ø±ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                    canvas.width = 0;
                    canvas.height = 0;
                    
                }, 'image/jpeg', 0.85);
            },
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø±Ø¶
            updateGallery() {
                const images = this.state.capturedImages;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
                this.elements.photoCount.textContent = `${images.length} ØµÙˆØ±`;
                this.elements.imageCount.textContent = images.length;
                
                // Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØµÙˆØ±
                this.elements.emptyState.style.display = images.length > 0 ? 'none' : 'block';
                
                // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ
                this.elements.imagesContainer.innerHTML = '';
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±
                images.forEach((image, index) => {
                    const imageItem = this.createImageElement(image, index);
                    this.elements.imagesContainer.appendChild(imageItem);
                });
                
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ø¢Ø®Ø± ØµÙˆØ±Ø©
                if (images.length > 0) {
                    this.elements.imagesContainer.scrollLeft = this.elements.imagesContainer.scrollWidth;
                }
            },
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± ØµÙˆØ±Ø©
            createImageElement(image, index) {
                const div = document.createElement('div');
                div.className = 'image-item';
                div.dataset.id = image.id;
                
                div.innerHTML = `
                    <img src="${image.url}" alt="ØµÙˆØ±Ø© ${index + 1}">
                    <button class="remove-btn" data-index="${index}">Ã—</button>
                `;
                
                // Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
                div.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('remove-btn')) {
                        div.classList.toggle('selected');
                    }
                });
                
                // Ø­Ø¯Ø« Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©
                const removeBtn = div.querySelector('.remove-btn');
                removeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.removeImage(index);
                });
                
                return div;
            },
            
            // Ø­Ø°Ù ØµÙˆØ±Ø©
            removeImage(index) {
                if (index >= 0 && index < this.state.capturedImages.length) {
                    const image = this.state.capturedImages[index];
                    
                    // ØªØ­Ø±ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                    URL.revokeObjectURL(image.url);
                    
                    // Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
                    this.state.capturedImages.splice(index, 1);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    this.updateGallery();
                    
                    this.showStatus('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©', 1500);
                }
            },
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            updateCameraUI() {
                // Ù†Øµ Ù†ÙˆØ¹ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                this.elements.cameraTypeText.textContent = 
                    this.state.facingMode === 'environment' ? 'ÙƒØ§Ù…ÙŠØ±Ø§ Ø®Ù„ÙÙŠØ©' : 'ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ù…Ø§Ù…ÙŠØ©';
                
                // Ù„ÙˆÙ† Ø§Ù„Ù…Ø¤Ø´Ø±
                const dot = this.elements.cameraIndicators.querySelector('.dot');
                dot.style.background = this.state.facingMode === 'environment' ? '#4CAF50' : '#2196F3';
            },
            
            // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
            cancelOperation() {
                if (this.state.capturedImages.length > 0) {
                    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ù„ØªÙ‚Ø·Ø©ØŸ')) {
                        this.clearImages();
                        this.closeApp();
                    }
                } else {
                    this.closeApp();
                }
            },
            
            // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ±
            clearImages() {
                // ØªØ­Ø±ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ±
                this.state.capturedImages.forEach(image => {
                    URL.revokeObjectURL(image.url);
                });
                
                // ØªÙØ±ÙŠØº Ø§Ù„Ù…ØµÙÙˆÙØ©
                this.state.capturedImages = [];
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                this.updateGallery();
            },
            
            // Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±
            saveImages() {
                if (this.state.capturedImages.length === 0) {
                    this.showStatus('Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø£ÙŠ ØµÙˆØ± Ù„Ù„Ø­ÙØ¸', 2000, true);
                    return;
                }
                
                this.showStatus('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±...', 3000);
                
                // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„
                const imagesData = this.state.capturedImages.map(img => ({
                    id: img.id,
                    dataUrl: img.dataUrl,
                    timestamp: img.timestamp,
                    cameraType: img.cameraType
                }));
                
                // 1. Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ WebView Ø£ÙˆÙ„Ø§Ù‹
                if (window.Android && typeof window.Android.onImagesCaptured === 'function') {
                    console.log('Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ Android WebView...');
                    
                    // Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ…Ø³ØªÙ†Ø¯ JSON
                    const jsonData = JSON.stringify({
                        count: imagesData.length,
                        images: imagesData,
                        timestamp: new Date().toISOString()
                    });
                    
                    window.Android.onImagesCaptured(jsonData);
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                    this.showStatus(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${imagesData.length} ØµÙˆØ±Ø©`, 2000);
                    
                    // ØªÙ†Ø¸ÙŠÙ ÙˆØ§Ù†ØªØ¸Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
                    setTimeout(() => {
                        this.clearImages();
                        this.closeApp();
                    }, 2000);
                    
                } else if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.ios) {
                    // 2. iOS WebView
                    console.log('Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ iOS WebView...');
                    window.webkit.messageHandlers.ios.postMessage({
                        action: 'imagesCaptured',
                        data: imagesData
                    });
                    
                    this.showStatus(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${imagesData.length} ØµÙˆØ±Ø© Ø¥Ù„Ù‰ iOS`, 2000);
                    
                    setTimeout(() => {
                        this.clearImages();
                        this.closeApp();
                    }, 2000);
                    
                } else {
                    // 3. ÙˆØ¶Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¹Ø§Ø¯ÙŠ - Ø­ÙØ¸ ÙÙŠ localStorage
                    console.log('Ø­ÙØ¸ Ø§Ù„ØµÙˆØ± ÙÙŠ localStorage...');
                    
                    try {
                        localStorage.setItem('app_captured_images', JSON.stringify(imagesData));
                        this.showStatus(`ØªÙ… Ø­ÙØ¸ ${imagesData.length} ØµÙˆØ±Ø© ÙÙŠ localStorage`, 2000);
                        
                        // ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        alert(`ØªÙ… Ø­ÙØ¸ ${imagesData.length} ØµÙˆØ±Ø©.\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ….`);
                        
                        this.clearImages();
                        
                    } catch (e) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±:', e);
                        this.showStatus('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±', 2000, true);
                    }
                }
            },
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            closeApp() {
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
                this.cleanup();
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙÙŠ WebView)
                if (window.Android && typeof window.Android.closeApp === 'function') {
                    window.Android.closeApp();
                } else if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.ios) {
                    window.webkit.messageHandlers.ios.postMessage({action: 'closeApp'});
                } else {
                    // ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                    this.showStatus('ÙŠÙ…ÙƒÙ†Ùƒ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¢Ù†', 2000);
                }
            },
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
            cleanup() {
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                this.stopCamera();
                
                // ØªØ­Ø±ÙŠØ± Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ±
                this.clearImages();
            },
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø­Ø§Ù„Ø©
            showStatus(message, duration = 2000, isError = false) {
                const statusEl = this.elements.statusMessage;
                
                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ù„ÙˆÙ†
                statusEl.textContent = message;
                statusEl.style.background = isError ? 
                    'rgba(244, 67, 54, 0.9)' : 'rgba(33, 150, 243, 0.9)';
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                statusEl.style.display = 'block';
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, duration);
                
                // ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„
                console.log(`[Status] ${message}`);
            }
        };
        
        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        // ============================================
        
            App.init();
    
        
        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø¹Ø§Ù…Ø© Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ WebView
        // ============================================
        
        // Ø¯Ø§Ù„Ø© ÙŠÙ…ÙƒÙ† Ù„Ù€ WebView Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§
        window.receiveImages = function(imagesJson) {
            console.log('Received images from WebView');
            // ÙŠÙ…ÙƒÙ† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø£Ø±Ø³Ù„Ù‡Ø§ WebView
        };
        
        // Ø¯Ø§Ù„Ø© Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø£ÙˆØ§Ù…Ø± Ù…Ù† WebView
        window.appCommand = function(command, data) {
            console.log(`WebView command: ${command}`, data);
            
            switch(command) {
                case 'startCamera':
                    App.startCamera();
                    break;
                case 'stopCamera':
                    App.stopCamera();
                    break;
                case 'captureImage':
                    App.captureImage();
                    break;
                case 'getImages':
                    const imagesData = App.state.capturedImages.map(img => ({
                        id: img.id,
                        dataUrl: img.dataUrl
                    }));
                    return JSON.stringify(imagesData);
                case 'clearImages':
                    App.clearImages();
                    break;
                default:
                    console.warn(`Unknown command: ${command}`);
            }
        };
        
        // Ø¬Ø¹Ù„ App Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
        window.CameraApp = App;
        
        console.log('ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ WebView');
    </script>
</body>
