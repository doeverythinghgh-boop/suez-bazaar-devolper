
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans',Arial;direction:rtl;padding:18px}
    .wrap{max-width:720px;margin:0 auto}
    button{padding:10px 14px;border-radius:8px;border:1px solid #ccc;background:#fff;cursor:pointer}
    img.preview{display:block;max-width:100%;height:auto;margin-top:12px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    pre{white-space:pre-wrap;background:#f7f7f7;border-radius:8px;padding:12px;overflow:auto}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  </style>

<body>
  <div class="wrap">
    <h1>اختبار التقاط الصورة (Camera)</h1>
    <p>زر أدناه يفتح الكاميرا أو نافذة اختيار ملف. بعد التقاط الصورة ستُعرض هنا وتخزن في المتغير العام <code>window.suzeBazaarCapturedImage</code>.</p>

    <div class="row">
      <button id="openBtn">فتح الكاميرا / اختيار صورة</button>
      <button id="showVarBtn">إظهار محتوى المتغير العام</button>
      <button id="downloadBtn" disabled>تحميل الصورة</button>
    </div>

    <div id="previewArea">
      <p id="status">لم تُلتقط صورة بعد.</p>
    </div>

    <h3>معاينة الصورة</h3>
    <img id="previewImg" class="preview" alt="معاينة الصورة" src="" style="display:none">

    <h3>محتوى المتغير العام (مُلخّص)</h3>
    <pre id="dataSummary">-</pre>

    <p style="margin-top:18px;color:#666;font-size:14px">ملاحظة: احتفظ بملف <code>cameraCapture.js</code> في نفس المجلد أو عدّل مسار الاستيراد أدناه.</p>
  </div>

  <!-- استدعاء ملف الكاميرا (يفترض أنه في نفس المجلد) -->
  <script src="/js/cameraCapture.js"></script>
  <script>
    // عناصر DOM
    const openBtn = document.getElementById('openBtn');
    const showVarBtn = document.getElementById('showVarBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const previewImg = document.getElementById('previewImg');
    const status = document.getElementById('status');
    const dataSummary = document.getElementById('dataSummary');

    function updateUIWithDataUrl(dataUrl) {
      if (!dataUrl) {
        status.textContent = 'المستخدم ألغى أو حدث خطأ.';
        previewImg.style.display = 'none';
        dataSummary.textContent = '-';
        downloadBtn.disabled = true;
        return;
      }

      status.textContent = 'تم التقاط الصورة وحفظها في window.suzeBazaarCapturedImage';
      previewImg.src = dataUrl;
      previewImg.style.display = '';

      // ملخّص: نوع الصورة وطول السلسلة (لا نعرض كامل الـ DataURL لكونه طويل)
      const head = dataUrl.substring(0, 80);
      dataSummary.textContent = `${head}...\n(طول السلسلة: ${dataUrl.length} رمز)`;

      downloadBtn.disabled = false;
    }

    // زر فتح الكاميرا
    openBtn.addEventListener('click', function () {
      // استخدم الدالة العامة المُعرّفة في cameraCapture.js
      if (typeof openCameraAndCapture !== 'function') {
        alert('cameraCapture.js غير محمّل أو الدالة openCameraAndCapture غير معرفة. تأكد من مسار الملف.');
        return;
      }

      openCameraAndCapture().then(function (dataUrl) {
        // سيتم حفظها أيضاً في window.suzeBazaarCapturedImage بحسب ملف الكاميرا
        updateUIWithDataUrl(dataUrl);
      });
    });

    // زر إظهار محتوى المتغير العام
    showVarBtn.addEventListener('click', function () {
      const val = window.suzeBazaarCapturedImage || null;
      if (!val) {
        alert('المتغير window.suzeBazaarCapturedImage فارغ. التقط صورة أولاً.');
        return;
      }
      updateUIWithDataUrl(val);
    });

    // زر تحميل الصورة
    downloadBtn.addEventListener('click', function () {
      const dataUrl = window.suzeBazaarCapturedImage;
      if (!dataUrl) return;

      // تحويل DataURL إلى رابط تحميل
      const a = document.createElement('a');
      a.href = dataUrl;
      a.download = 'suze-image.jpg';
      document.body.appendChild(a);
      a.click();
      a.remove();
    });

    // عند تحميل الصفحة لو كان المتغير معبأ مسبقاً
    window.addEventListener('load', function () {
      if (window.suzeBazaarCapturedImage) {
        updateUIWithDataUrl(window.suzeBazaarCapturedImage);
      }
    });
  </script>
</body>
