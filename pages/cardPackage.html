<style>
    .cartPage_container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }



    /* Cart Layout */
    .cartPage_cart-layout {
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 30px;
    }

    @media (max-width: 992px) {
        .cartPage_cart-layout {
            grid-template-columns: 1fr;
        }
    }

    /* Cart Items */
    .cartPage_cart-items {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    /* Modify cart item to be a table */
    .cartPage_cart-item {
        background: var(--bg-color-white);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-interactive);
        display: table;
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-bottom: 20px;
        overflow: hidden;
        transition: var(--transition);
        border: 2px solid transparent;
    }

    .cartPage_cart-item:hover {
        border-color: var(--primary-color);
        transform: translateY(-3px);
    }

    .cartPage_cart-item td {
        padding: 15px;
        vertical-align: middle;
        border-bottom: 1px solid var(--border-color);
    }

    .cartPage_cart-item tr:last-child td {
        border-bottom: none;
    }

    .cartPage_cart-item-image {
        width: 120px;
        height: 120px;
        border-radius: 10px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--border-color);
    }

    .cartPage_cart-item-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .cartPage_cart-item-info {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .cartPage_cart-item-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-color-dark);
        margin-bottom: 5px;
    }

    .cartPage_cart-item-price {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .cartPage_current-price {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    .cartPage_original-price {
        font-size: 1.1rem;
        color: var(--secondary-color);
        text-decoration: line-through;
    }

    .cartPage_discount-badge {
        background-color: var(--danger-color);
        color: var(--bg-color-white);
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .cartPage_quantity-controls {
        display: flex;
        align-items: center;
        gap: 10px;
        background-color: var(--border-color);
        padding: 8px 15px;
        border-radius: 30px;
        width: fit-content;
    }

    .cartPage_quantity-btn {
        background: none;
        border: none;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background-color: var(--bg-color-white);
        color: var(--primary-color);
        font-size: 1.2rem;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
    }

    .cartPage_quantity-btn:hover {
        background-color: var(--primary-color);
        color: var(--bg-color-white);
    }

    .cartPage_quantity-input {
        width: 50px;
        text-align: center;
        font-size: 1.1rem;
        font-weight: 600;
        border: none;
        background: transparent;
        color: var(--text-color-dark);
    }

    .cartPage_remove-btn {
        background-color: transparent;
        color: var(--danger-color);
        border: 2px solid var(--danger-color);
        padding: 8px 20px;
        border-radius: 30px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
        width: fit-content;
    }

    .cartPage_remove-btn:hover {
        background-color: var(--danger-color);
        color: var(--bg-color-white);
    }

    /* Product Notes */
    .cartPage_cart-item-note {
        margin-top: 5px;
        padding-top: 5px;
        width: 100%;
    }

    .cartPage_note-label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        color: var(--secondary-color);
        margin-bottom: 8px;
    }

    .cartPage_note-text {
        background-color: var(--border-color);
        padding: 10px 15px;
        border-radius: 8px;
        min-height: 50px;
        display: flex;
        align-items: center;
        position: relative;
    }

    .cartPage_note-text.empty {
        color: var(--secondary-color);
        font-style: italic;
    }

    .cartPage_edit-note-btn {
        position: absolute;
        left: 10px;
        top: 10px;
        background: var(--primary-color);
        color: var(--bg-color-white);
        border: none;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
    }

    .cartPage_edit-note-btn:hover {
        background: var(--dark-blue);
    }

    /* Cart Summary */
    .cartPage_cart-summary {
        background: var(--bg-color-white);
        border-radius: var(--border-radius);
        padding: 25px;
        box-shadow: var(--shadow-interactive);
        height: fit-content;
        position: sticky;
        top: 30px;
    }

    .cartPage_cart-summary h2 {
        font-size: 1.5rem;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .cartPage_summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px dashed var(--border-color);
    }

    .cartPage_summary-row.total {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--primary-color);
        border-bottom: none;
        padding-top: 10px;
        margin-top: 10px;
        border-top: 2px solid var(--border-color);
    }

    .cartPage_summary-row.savings {
        color: var(--danger-color);
    }

    .cartPage_summary-value {
        font-weight: 600;
    }

    .cartPage_checkout-btn {
        width: 100%;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: var(--bg-color-white);
        border: none;
        padding: 16px;
        border-radius: 30px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        margin-top: 20px;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .cartPage_checkout-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
    }

    .cartPage_clear-cart-btn {
        width: 100%;
        background-color: transparent;
        color: var(--danger-color);
        border: 2px solid var(--danger-color);
        padding: 14px;
        border-radius: 30px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 15px;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .cartPage_clear-cart-btn:hover {
        background-color: var(--danger-color);
        color: var(--bg-color-white);
    }

    /* Empty Cart State */
    .cartPage_empty-cart {
        text-align: center;
        padding: 60px 20px;
        background: var(--bg-color-white);
        border-radius: var(--border-radius);
        grid-column: 1 / span 2;
    }

    .cartPage_empty-cart-icon {
        font-size: 5rem;
        color: var(--border-color);
        margin-bottom: 20px;
    }

    .cartPage_empty-cart h2 {
        font-size: 1.8rem;
        margin-bottom: 15px;
        color: var(--secondary-color);
    }

    .cartPage_empty-cart p {
        color: var(--secondary-color);
        margin-bottom: 30px;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }

    .cartPage_continue-shopping {
        display: inline-block;
        background: var(--primary-color);
        color: var(--bg-color-white);
        text-decoration: none;
        padding: 12px 30px;
        border-radius: 30px;
        font-weight: 600;
        transition: var(--transition);
    }

    .cartPage_continue-shopping:hover {
        background: var(--dark-blue);
        transform: translateY(-3px);
    }

    /* Back Button */
    .cartPage_back-button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 600;
        margin-bottom: 20px;
        transition: var(--transition);
    }

    .cartPage_back-button:hover {
        gap: 12px;
    }

    /* Loading */
    .cartPage_loading {
        text-align: center;
        padding: 40px;
        color: var(--secondary-color);
    }

    .cartPage_loading i {
        font-size: 2rem;
        margin-bottom: 15px;
        color: var(--primary-color);
    }

    /* Edit Note Modal */
    .cartPage_note-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .cartPage_note-modal-content {
        background: var(--bg-color-white);
        width: 90%;
        max-width: 500px;
        border-radius: var(--border-radius);
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .cartPage_note-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .cartPage_note-modal-header h3 {
        font-size: 1.3rem;
        color: var(--text-color-dark);
    }

    .cartPage_close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--secondary-color);
    }

    .cartPage_note-modal-body textarea {
        width: 100%;
        min-height: 150px;
        padding: 15px;
        border: 2px solid var(--border-color);
        border-radius: 10px;
        font-size: 1rem;
        resize: vertical;
        margin-bottom: 20px;
    }

    .cartPage_note-modal-body textarea:focus {
        outline: none;
        border-color: var(--primary-color);
    }

    .cartPage_note-modal-actions {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
    }

    .cartPage_save-note-btn {
        background: var(--primary-color);
        color: var(--bg-color-white);
        border: none;
        padding: 10px 25px;
        border-radius: 30px;
        font-weight: 600;
        cursor: pointer;
    }

    .cartPage_cancel-note-btn {
        background: var(--border-color);
        color: var(--text-color-dark);
        border: none;
        padding: 10px 25px;
        border-radius: 30px;
        font-weight: 600;
        cursor: pointer;
    }

    /* Additional Responsive Design */
    @media (max-width: 576px) {


        .cartPage_cart-item td {
            padding: 10px;
        }

        .cartPage_cart-summary {
            padding: 20px;
        }
    }
</style>



<body>
    <div id="header-container10" style="height: 70px;margin-left: 20px;margin-right: 20px;"></div>
    <div class="cartPage_container" id="cartPage_mainContainer">

        <!-- Cart Content -->
        <div class="cartPage_cart-layout" id="cartPage_cartLayout">
            <!-- Cart Items (Populated by JavaScript) -->
            <div class="cartPage_cart-items" id="cartPage_cartItemsContainer">
                <div class="cartPage_loading" id="cartPage_loadingIndicator">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª...</p>
                </div>
            </div>

            <!-- Cart Summary -->
            <div class="cartPage_cart-summary" id="cartPage_cartSummary">
                <h2 id="cartPage_summaryTitle"><i class="fas fa-receipt"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h2>
                <div class="cartPage_summary-row" id="cartPage_summaryRowCount">
                    <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span>
                    <span class="cartPage_summary-value" id="cartPage_itemCount">0</span>
                </div>
                <div class="cartPage_summary-row" id="cartPage_summaryRowSubtotal">
                    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ:</span>
                    <span class="cartPage_summary-value" id="cartPage_subtotal">0.00 Ø¬.Ù…</span>
                </div>
                <div class="cartPage_summary-row savings" id="cartPage_summaryRowSavings">
                    <span>Ø§Ù„ØªÙˆÙÙŠØ±:</span>
                    <span class="cartPage_summary-value" id="cartPage_savings">0.00 Ø¬.Ù…</span>
                </div>
                <div class="cartPage_summary-row total" id="cartPage_summaryRowTotal">
                    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</span>
                    <span class="cartPage_summary-value" id="cartPage_total">0.00 Ø¬.Ù…</span>
                </div>

                <button class="cartPage_checkout-btn" id="cartPage_checkoutBtn">
                    <i class="fas fa-lock"></i> Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡
                </button>

                <button class="cartPage_clear-cart-btn" id="cartPage_clearCartBtn">
                    <i class="fas fa-trash"></i> ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©
                </button>
            </div>
        </div>

        <!-- Empty Cart State (Hidden by default) -->
        <div class="cartPage_empty-cart" id="cartPage_emptyCart" style="display: none;">
            <div class="cartPage_empty-cart-icon" id="cartPage_emptyCartIcon">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <h2 id="cartPage_emptyCartTitle">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙØ§Ø±ØºØ©</h2>
            <p id="cartPage_emptyCartMessage">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù† Ù„Ø¥Ø¶Ø§ÙØ©
                Ù…Ù†ØªØ¬Ø§Øª Ø±Ø§Ø¦Ø¹Ø©!</p>
            <a href="#" class="cartPage_continue-shopping" id="cartPage_continueShoppingBtn"
                onclick="mainLoader('./pages/home.html', 'index-home-container', 0, undefined, 'hiddenHomeIcon',false); return false;">
                <i class="fas fa-store"></i> Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚
            </a>
        </div>
    </div>

    </div>

    <!-- Edit Note Modal -->
    <div class="cartPage_note-modal" id="cartPage_noteModal">
        <div class="cartPage_note-modal-content" id="cartPage_noteModalContent">
            <div class="cartPage_note-modal-header" id="cartPage_noteModalHeader">
                <h3 id="cartPage_noteModalTitle">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</h3>
                <button class="cartPage_close-modal" id="cartPage_closeNoteModal">&times;</button>
            </div>
            <div class="cartPage_note-modal-body" id="cartPage_noteModalBody">
                <textarea id="cartPage_noteTextarea" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø© Ø®Ø§ØµØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
                <div class="cartPage_note-modal-actions" id="cartPage_noteModalActions">
                    <button class="cartPage_cancel-note-btn" id="cartPage_cancelNoteBtn">Ø¥Ù„ØºØ§Ø¡</button>
                    <button class="cartPage_save-note-btn" id="cartPage_saveNoteBtn">Ø­ÙØ¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- âœ… New: Photo Order Success Message -->
    <div id="cartPage_photoOrderMessage"
        style="display:none; background:#d4edda; color:#155724; padding:15px; border-radius:8px; margin:20px; border:1px solid #c3e6cb; position:relative; text-align:right;">
        <strong><i class="fas fa-check-circle"></i> ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ØµÙˆØ±!</strong>
        <p style="margin:5px 0 0 0;">Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØµÙˆØ± ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§Øª. Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ù‚Ø±ÙŠØ¨Ø§Ù‹.</p>
        <button onclick="this.parentElement.style.display='none'; localStorage.removeItem('showOrderPhotoMessage');"
            style="position:absolute; top:10px; left:10px; background:none; border:none; cursor:pointer; color:#155724; font-size:1.2rem;">&times;</button>
    </div>


    <script>

        /**
         * @description Creates a new order in the database via the API.
         * @function createOrder
         * @param {object} orderData - An object containing all the data for the order to be created.
         * @param {string} orderData.order_key - The unique key generated for the order.
         * @param {string} orderData.user_key - The key of the user who placed the order.
         * @param {number} orderData.total_amount - The total amount of the order.
         * @param {Array<object>} orderData.items - An array of products included in the order.
         * @returns {Promise<Object>} - A Promise that resolves with the created order data object, or an error object if it fails.
         * @see apiFetch
         */
        async function createOrder(orderData) {
            return await apiFetch('/api/orders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(orderData),
            });
        }

        /**
         * @description Sends the order to execution.
         * @function sendOrder2Excution
         * @returns {Promise<Object>} - A Promise that resolves with the created order data object, or an error object if it fails.
         * @see createOrder
         */
        async function sendOrder2Excution() {

            // 1. Check Session (Fix inverted condition)
            if (showLoginAlert()) {
                // 2. Fetch Data
                const cart = getCart();
                // 3. Check Cart
                if (cart.length === 0) {
                    Swal.fire("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©", "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø© Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡.", "info");
                    return;
                }

                // 4. Calculate Total Amount and Generate Order Key
                const totalAmount = cart.reduce(
                    (sum, item) => sum + item.price * item.quantity,
                    0
                );
                const orderKey = generateSerial();

                // 5. Build Order Data (Remove Duplication)
                const orderData = {
                    order_key: orderKey,
                    user_key: userSession.user_key,
                    total_amount: totalAmount,
                    items: cart.map((item) => ({
                        product_key: item.product_key,
                        quantity: item.quantity,
                        seller_key: item.seller_key,
                        note: item.note || "",
                    })),
                };
                console.log("[Checkout] Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨:", orderData);

                // 6. Show Confirmation Message
                const result = await Swal.fire({
                    title: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨",
                    text: `Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‡Ùˆ ${totalAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`,
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonText: "Ù†Ø¹Ù…ØŒ Ø£Ø±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨!",
                    cancelButtonText: "Ø¥Ù„ØºØ§Ø¡",
                    showLoaderOnConfirm: true,
                    preConfirm: async () => {
                        try {
                            const response = await createOrder(orderData);
                            console.log("[Checkout] Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…:", response);
                            return response;
                        } catch (error) {
                            Swal.showValidationMessage(`ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨: ${error.message || error}`);
                            return null;
                        }
                    },
                    allowOutsideClick: () => !Swal.isLoading(),
                });

                // 7. Process Result
                if (result.isConfirmed && result.value && !result.value.error) {
                    const createdOrderKey = result.value.order_key;
                    console.log(`[Checkout] ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­: ${createdOrderKey}`);

                    // 8. Send Notifications using the new function
                    if (typeof handlePurchaseNotifications === 'function') {
                        const finalOrderForNotify = { ...orderData, id: createdOrderKey };
                        handlePurchaseNotifications(finalOrderForNotify)
                            .catch(err => console.error('[Checkout] Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:', err));
                    } else {
                        console.warn('[Checkout] Ø¯Ø§Ù„Ø© handlePurchaseNotifications ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
                    }

                    // 9. Clear Cart and Show Success Message
                    clearCart();
                    await Swal.fire({
                        title: "ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰",
                        text: `Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: #${createdOrderKey}`,
                        icon: "success",
                        confirmButtonText: "Ø­Ø³Ù†Ø§Ù‹"
                    });

                } else if (result.value && result.value.error) {
                    console.error("Ø­Ø¯Ø« Ø®Ø·Ø£", `ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: ${result.value.error}`, "error");
                }
            }
        }

        // Global Variables
        let cartPage_currentProductKeyForNote = '';

        // Page Initialization
        try {
            cartPage_loadCart();
            cartPage_setupEventListeners();
        } catch (error) {
            console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©:', error);
        }

        /**
         * @description Loads the cart items from local storage and renders them in the cart page.
         *   Updates the cart summary and handles empty cart state.
         * @function cartPage_loadCart
         * @returns {void}
         */
        function cartPage_loadCart() {
            try {
                const cartPage_cart = getCart();
                const cartPage_cartItemsContainer = document.getElementById('cartPage_cartItemsContainer');
                const cartPage_emptyCart = document.getElementById('cartPage_emptyCart');
                const cartPage_cartSummary = document.getElementById('cartPage_cartSummary');

                if (cartPage_cart.length === 0) {
                    cartPage_cartItemsContainer.innerHTML = '';
                    cartPage_emptyCart.style.display = 'block';
                    cartPage_cartSummary.style.display = 'none';
                    return;
                }

                cartPage_emptyCart.style.display = 'none';
                cartPage_cartSummary.style.display = 'block';

                let cartPage_cartItemsHTML = '';

                cartPage_cart.forEach(cartPage_item => {
                    const cartPage_discount = cartPage_item.original_price && cartPage_item.original_price > cartPage_item.price
                        ? Math.round(((cartPage_item.original_price - cartPage_item.price) / cartPage_item.original_price) * 100)
                        : 0;

                    const cartPage_savings = cartPage_item.original_price && cartPage_item.original_price > cartPage_item.price
                        ? (cartPage_item.original_price - cartPage_item.price) * cartPage_item.quantity
                        : 0;

                    cartPage_cartItemsHTML += `
                        <table class="cartPage_cart-item" id="cartPage_cartItem-${cartPage_item.product_key}" data-product-key="${cartPage_item.product_key}">
                            <tbody>
                                <tr>
                                    <td style="width: 120px;" id="cartPage_cartItemImage-${cartPage_item.product_key}">
                                        <div class="cartPage_cart-item-image">
                                            <img id="cartPage_cartItemImg-${cartPage_item.product_key}" src="${cartPage_item.image || 'https://via.placeholder.com/120x120?text=No+Image'}" 
                                                 alt="${cartPage_item.productName}">
                                        </div>
                                    </td>
                                    <td id="cartPage_cartItemInfo-${cartPage_item.product_key}">
                                        <div class="cartPage_cart-item-info">
                                            <h3 class="cartPage_cart-item-title" id="cartPage_cartItemTitle-${cartPage_item.product_key}">${cartPage_item.productName}</h3>
                                            <div class="cartPage_cart-item-price" id="cartPage_cartItemPriceContainer-${cartPage_item.product_key}">
                                                <span class="cartPage_current-price" id="cartPage_currentPrice-${cartPage_item.product_key}">${cartPage_item.price.toFixed(2)} Ø¬.Ù…</span>
                                                ${cartPage_item.original_price && cartPage_item.original_price > cartPage_item.price ?
                            `<span class="cartPage_original-price" id="cartPage_originalPrice-${cartPage_item.product_key}">${cartPage_item.original_price.toFixed(2)} Ø¬.Ù…</span>` : ''}
                                                ${cartPage_discount > 0 ?
                            `<span class="cartPage_discount-badge" id="cartPage_discountBadge-${cartPage_item.product_key}">ØªÙˆÙÙŠØ± ${cartPage_discount}%</span>` : ''}
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" id="cartPage_cartItemNoteContainer-${cartPage_item.product_key}">
                                        <div class="cartPage_cart-item-note">
                                            <div class="cartPage_note-label" id="cartPage_noteLabel-${cartPage_item.product_key}">
                                                <i class="fas fa-sticky-note"></i>
                                                <span>Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ:</span>
                                            </div>
                                            <div class="cartPage_note-text ${cartPage_item.note ? '' : 'empty'}" id="cartPage_noteText-${cartPage_item.product_key}">
                                                ${cartPage_item.note || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª'}
                                                <button class="cartPage_edit-note-btn" id="cartPage_editNoteBtn-${cartPage_item.product_key}" data-product-key="${cartPage_item.product_key}">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td id="cartPage_quantityControls-${cartPage_item.product_key}">
                                        <div class="cartPage_quantity-controls">
                                            <button class="cartPage_quantity-btn cartPage_minus" id="cartPage_decreaseQtyBtn-${cartPage_item.product_key}" data-product-key="${cartPage_item.product_key}">-</button>
                                            <input type="number" class="cartPage_quantity-input" id="cartPage_quantityInput-${cartPage_item.product_key}"
                                                   value="${cartPage_item.quantity}" min="1" 
                                                   data-product-key="${cartPage_item.product_key}">
                                            <button class="cartPage_quantity-btn cartPage_plus" id="cartPage_increaseQtyBtn-${cartPage_item.product_key}" data-product-key="${cartPage_item.product_key}">+</button>
                                        </div>
                                    </td>
                                    <td id="cartPage_removeBtn-${cartPage_item.product_key}">
                                        <button class="cartPage_remove-btn" data-product-key="${cartPage_item.product_key}">
                                            <i class="fas fa-trash"></i> Ø­Ø°Ù
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                });

                cartPage_cartItemsContainer.innerHTML = cartPage_cartItemsHTML;
                cartPage_updateCartSummary();
            } catch (error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø©:', error);
            }
        }

        /**
         * @description Updates the cart summary section with the total item count, subtotal, savings, and final total.
         * @function cartPage_updateCartSummary
         * @returns {void}
         */
        function cartPage_updateCartSummary() {
            try {
                const cartPage_itemCount = getCartItemCount();
                const cartPage_subtotal = getCartTotalPrice();
                const cartPage_savings = getCartTotalSavings();
                const cartPage_total = cartPage_subtotal;

                document.getElementById('cartPage_itemCount').textContent = cartPage_itemCount;
                document.getElementById('cartPage_subtotal').textContent = cartPage_subtotal.toFixed(2) + ' Ø¬.Ù…';
                document.getElementById('cartPage_savings').textContent = cartPage_savings.toFixed(2) + ' Ø¬.Ù…';
                document.getElementById('cartPage_total').textContent = cartPage_total.toFixed(2) + ' Ø¬.Ù…';
            } catch (error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ù„Ø©:', error);
            }
        }

        /**
         * @description Sets up all event listeners for the cart page, including cart updates, 
         *   quantity changes, item removal, and checkout actions.
         * @function cartPage_setupEventListeners
         * @returns {void}
         */
        function cartPage_setupEventListeners() {
            try {
                // Cart Updated Event
                window.addEventListener('cartUpdated', function () {
                    try {
                        cartPage_loadCart();
                    } catch (error) {
                        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø¯Ø« ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù„Ø©:', error);
                    }
                });

                // Event Listener for Dynamic Elements
                document.addEventListener('click', function (e) {
                    try {
                        const cartPage_target = e.target;

                        // Increase Quantity
                        if (cartPage_target.classList.contains('cartPage_plus')) {
                            const cartPage_productKey = cartPage_target.dataset.productKey;
                            const cartPage_cart = getCart();
                            const cartPage_product = cartPage_cart.find(item => item.product_key === cartPage_productKey);

                            if (cartPage_product) {
                                updateCartQuantity(cartPage_productKey, cartPage_product.quantity + 1);
                            }
                        }

                        // Decrease Quantity
                        if (cartPage_target.classList.contains('cartPage_minus')) {
                            const cartPage_productKey = cartPage_target.dataset.productKey;
                            const cartPage_cart = getCart();
                            const cartPage_product = cartPage_cart.find(item => item.product_key === cartPage_productKey);

                            if (cartPage_product && cartPage_product.quantity > 1) {
                                updateCartQuantity(cartPage_productKey, cartPage_product.quantity - 1);
                            }
                        }

                        // Remove Product
                        if (cartPage_target.classList.contains('cartPage_remove-btn') || cartPage_target.closest('.cartPage_remove-btn')) {
                            const cartPage_productKey = (cartPage_target.closest('.cartPage_remove-btn') || cartPage_target).dataset.productKey;
                            const cartPage_cart = getCart();
                            const cartPage_product = cartPage_cart.find(item => item.product_key === cartPage_productKey);

                            if (cartPage_product) {
                                Swal.fire({
                                    title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
                                    text: `Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ "${cartPage_product.productName}" Ù…Ù† Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª.`,
                                    icon: 'warning',
                                    showCancelButton: true,
                                    confirmButtonColor: '#d33',
                                    cancelButtonColor: '#3085d6',
                                    confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°ÙÙ‡!',
                                    cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        removeFromCart(cartPage_productKey);
                                        Swal.fire('ØªÙ… Ø§Ù„Ø­Ø°Ù!', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­.', 'success');
                                    }
                                });
                            }
                        }

                        // Edit Note
                        if (cartPage_target.classList.contains('cartPage_edit-note-btn') || cartPage_target.closest('.cartPage_edit-note-btn')) {
                            const cartPage_productKey = (cartPage_target.closest('.cartPage_edit-note-btn') || cartPage_target).dataset.productKey;
                            const cartPage_cart = getCart();
                            const cartPage_product = cartPage_cart.find(item => item.product_key === cartPage_productKey);

                            if (cartPage_product) {
                                cartPage_openNoteModal(cartPage_productKey, cartPage_product.note || '');
                            }
                        }
                    } catch (error) {
                        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù‚Ø±:', error);
                    }
                });

                // Update Quantity on Input Change
                document.addEventListener('blur', function (e) {
                    try {
                        if (e.target.classList.contains('cartPage_quantity-input')) {
                            const cartPage_productKey = e.target.dataset.productKey;
                            const cartPage_newQuantity = parseInt(e.target.value);

                            if (cartPage_newQuantity > 0) {
                                updateCartQuantity(cartPage_productKey, cartPage_newQuantity);
                            } else if (cartPage_newQuantity <= 0) {
                                const cartPage_cart = getCart();
                                const cartPage_product = cartPage_cart.find(item => item.product_key === cartPage_productKey);

                                if (cartPage_product && confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù "${cartPage_product.productName}" Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ`)) {
                                    removeFromCart(cartPage_productKey);
                                } else {
                                    // Reset value to 1
                                    e.target.value = 1;
                                    updateCartQuantity(cartPage_productKey, 1);
                                }
                            }
                        }
                    } catch (error) {
                        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©:', error);
                    }
                }, true); // Use true to enable "event capturing"

                // Clear Cart
                document.getElementById('cartPage_clearCartBtn').addEventListener('click', function () {
                    Swal.fire({
                        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
                        text: "Ø³ÙŠØªÙ… ØªÙØ±ÙŠØº Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ù‚Ù… Ø¨Ø§Ù„ØªÙØ±ÙŠØº!',
                        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            clearCart();
                            // Show success message after clearing
                            Swal.fire('ØªÙ… Ø§Ù„ØªÙØ±ÙŠØº!', 'ØªÙ… ØªÙØ±ÙŠØº Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª .', 'success');
                        }
                    });
                });

                // Checkout
                document.getElementById('cartPage_checkoutBtn').addEventListener('click', async function () {
                    try {
                        const cartPage_cart = getCart();
                        if (cartPage_cart.length === 0) {
                            return;
                        }
                        // Checkout Logic Here
                        await sendOrder2Excution();
                    } catch (error) {
                        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡:', error);
                    }
                });

                // Manage Note Modal
                document.getElementById('cartPage_closeNoteModal').addEventListener('click', cartPage_closeNoteModal);
                document.getElementById('cartPage_cancelNoteBtn').addEventListener('click', cartPage_closeNoteModal);
                document.getElementById('cartPage_saveNoteBtn').addEventListener('click', cartPage_saveNote);

                // Close Note Modal on Click Outside
                document.getElementById('cartPage_noteModal').addEventListener('click', function (e) {
                    try {
                        if (e.target === this) {
                            cartPage_closeNoteModal();
                        }
                    } catch (error) {
                        console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©:', error);
                    }
                });
            } catch (error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:', error);
            }
        }

        /**
         * @description Opens the modal to add or edit a note for a specific cart item.
         * @function cartPage_openNoteModal
         * @param {string} cartPage_productKey - The unique key of the product to edit the note for.
         * @param {string} cartPage_currentNote - The current note content (if any).
         * @returns {void}
         */
        function cartPage_openNoteModal(cartPage_productKey, cartPage_currentNote) {
            try {
                cartPage_currentProductKeyForNote = cartPage_productKey;
                document.getElementById('cartPage_noteTextarea').value = cartPage_currentNote;
                document.getElementById('cartPage_noteModal').style.display = 'flex';
            } catch (error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:', error);
            }
        }

        /**
         * @description Closes the note editing modal and resets the current product key.
         * @function cartPage_closeNoteModal
         * @returns {void}
         */
        function cartPage_closeNoteModal() {
            try {
                document.getElementById('cartPage_noteModal').style.display = 'none';
                cartPage_currentProductKeyForNote = '';
            } catch (error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:', error);
            }
        }

        /**
         * @description Saves the note entered in the modal to the corresponding cart item and updates the cart.
         * @function cartPage_saveNote
         * @returns {void}
         */
        function cartPage_saveNote() {
            try {
                const cartPage_note = document.getElementById('cartPage_noteTextarea').value.trim();
                updateCartItemNote(cartPage_currentProductKeyForNote, cartPage_note);
                cartPage_closeNoteModal();
            } catch (error) {
                console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:', error);
            }
        }
        insertUniqueSnapshot("../pages/header.html", "header-container10", 100);

    </script>
</body>