<div style="background-color: var(--bg-color-light);">
  <div id="loader-container" class="loader"></div>
  <div id="advertisement" style="background-color: var(--bg-color-light);"></div>
  <div id="categories00" style="background-color: var(--bg-color-light);"></div>
</div>
<script>
  /**
   * @file pages/home.html
   * @description Main Home Page. Loads advertisements and categories dynamically.
   */

  // This code is executed after the full page content is loaded to ensure all DOM elements are available.
  async function main() {
    // Determine key elements on the page: leading indicator and content containers.
    const loaderElement = document.getElementById("loader-container");
    const contentElements = [
      document.getElementById("advertisement"),
      document.getElementById("categories00"),
    ];
    // To store the original display state of elements before hiding them.
    const originalDisplays = new Map();

    // Step 1: Hide main content and show loading indicator to improve user experience.
    contentElements.forEach((el) => {
      originalDisplays.set(el, el.style.display || ""); // Save original display state.
      el.style.display = "none";
    });
    loaderElement.style.display = "block";

    // Step 2: Load content of different parts (ads and categories) synchronously.
    // Promise.all is used to ensure all parts are loaded before proceeding.
    await Promise.all([
      loader("pages/advertisement/advertisement.html", "advertisement", 0),
      loader("pages/categories/categories.html", "categories00", 300),
    ]);

    // Step 3: After content loading, initialize modules responsible for each part's functionality.
    // Initialize Advertisement Module.
    initAdverModule(document.getElementById("advertisement-section"));
    // Load and display categories.
    categories_loadCategoriesAsTable(); // Assume this function appends content to hidden elements.

    // Step 4: After loading and initialization are complete, show content and hide loading indicator.
    contentElements.forEach(
      (el) => (el.style.display = originalDisplays.get(el))
    );
    loaderElement.style.display = "none";

    // Step 5: Fetch and display application version
    try {
      // Remove existing footer if any to avoid duplicates
      const existingFooter = document.getElementById('app-footer');
      if (existingFooter) {
        existingFooter.remove();
      }

      const versionResponse = await fetch('version.json');
      if (versionResponse.ok) {
        const versionData = await versionResponse.json();
        const footer = document.createElement('div');
        footer.id = 'app-footer';
        footer.style.cssText = 'text-align: center; padding: 10px; font-size: 0.7rem; color: #888; width: 100%; border-top: 1px solid #eee; margin-top: 10px; background-color: #fafafa; font-family: sans-serif;';

        // Creating a clean, professional display
        const versionText = document.createElement('span');
        versionText.innerHTML = `&copy; 2025 Suez Bazaar <span style="margin: 0 8px;">â€¢</span> v${versionData.version}`;
        versionText.style.fontWeight = '400';

        footer.appendChild(versionText);

        // Append to the main container wrapper if possible, otherwise body
        // Trying to find a main content wrapper to keep it contained
        const mainWrapper = document.getElementById('loader-container')?.parentNode || document.body;
        mainWrapper.appendChild(footer);
      }
    } catch (error) {
      console.error('Failed to load version info:', error);
    }

  } main();
</script>