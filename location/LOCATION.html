<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>تحديد الموقع - BidStory</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Font Awesome (Local) -->
    <!-- Font Awesome (Local) -->
    <link rel="stylesheet" href="/assets/fontawesome/css/all.css" />

    <!-- Shared Project Styles -->
    <link rel="stylesheet" href="../style/variables.css" />
    <link rel="stylesheet" href="../style/modals-and-dialogs.css" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="location_styles.css" />

    <script id="embedded-detector">
        // Immediate detection and suppression of unwanted buttons to prevent any UI flicker
        (function () {
            var search = window.location.search;
            var isEmbedded = search.indexOf('embedded=true') !== -1;
            var isHideSave = search.indexOf('hideSave=true') !== -1;

            if (isEmbedded || isHideSave) {
                var css = '';
                if (isEmbedded) {
                    css += '#location_closeBtn, .location_btn-close { display: none !important; visibility: hidden !important; } ';
                    document.documentElement.classList.add('is-embedded');
                }
                if (isHideSave) {
                    css += '#location_saveBtn, .location_btn-save { display: none !important; visibility: hidden !important; } ';
                    document.documentElement.classList.add('is-hidesave');
                }
                if (css) {
                    var style = document.createElement('style');
                    style.innerHTML = css;
                    document.head.appendChild(style);
                }
            }
        })();

        // Bridge for translation system
        window.langu = function (key) {
            if (window.parent && typeof window.parent.langu === 'function') {
                return window.parent.langu(key);
            }
            return key;
        };

        // Function to apply translations to elements with data-lkey
        window.applyLocationTranslations = function () {
            document.querySelectorAll('[data-lkey]').forEach(el => {
                const key = el.getAttribute('data-lkey');
                el.textContent = window.langu(key);
            });
            document.querySelectorAll('[data-lkey-title]').forEach(el => {
                const key = el.getAttribute('data-lkey-title');
                el.setAttribute('title', window.langu(key));
            });
        };
    </script>
</head>

<body>
    <!-- Close Button (Modern) -->
    <button id="location_closeBtn" class="location_btn-close" onclick="location_app.closeLocationApp()">
        <i class="fas fa-times"></i>
    </button>

    <!-- Loading overlay -->
    <div id="location_loadingOverlay" class="location_loading-overlay">
        <div id="location_spinner" class="location_spinner"></div>
        <p id="location_loadingText" class="location_loading-text" data-lkey="location_loading_map">جاري تحميل
            الخريطة...</p>
    </div>

    <!-- Main map container -->
    <div id="location_map"></div>

    <!-- Controls panel -->
    <div class="location_controls">
        <button id="location_saveBtn" class="location_btn location_btn-save"
            onclick="location_app.saveSelectedLocation()">
            <i class="fas fa-save"></i>
            <span class="location_btn-text" data-lkey="location_btn_save">حفظ</span>
        </button>
        <button id="location_gpsBtn" class="location_btn location_btn-gps" onclick="location_app.getLocationByGPS()">
            <i id="location_gpsIcon" class="fas fa-map-marker-alt"></i>
            <span id="location_gpsText" class="location_btn-text" data-lkey="location_btn_my_location">موقعي</span>
        </button>
        <button id="location_shareBtn" class="location_btn location_btn-share"
            onclick="location_app.shareCoordinates()">
            <i id="location_shareIcon" class="fas fa-share-alt"></i>
            <span id="location_shareText" class="location_btn-text" data-lkey="location_btn_share">مشاركة</span>
        </button>
        <button id="location_resetBtn" class="location_btn location_btn-reset" onclick="location_app.resetLocation()">
            <i id="location_resetIcon" class="fas fa-trash-alt"></i>
            <span id="location_resetText" class="location_btn-text" data-lkey="location_btn_reset">إعادة ضبط</span>
        </button>
    </div>

    <!-- External libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/assets/libs/sweetalert2/sweetalert2.all.min.js"></script>

    <!-- Main application modules with cache busting -->
    <script src="js/location/config.js"></script>
    <script src="js/location/ui.js"></script>
    <script src="js/location/storage.js"></script>
    <script src="js/location/map.js"></script>
    <script src="js/location/gps.js"></script>
    <script src="js/location/utils.js"></script>
    <script src="js/location/core.js"></script>
    <script src="location_app.js"></script>
    <script>
        // Apply translations on load
        window.addEventListener('load', () => {
            window.applyLocationTranslations();
        });
    </script>
</body>

</html>